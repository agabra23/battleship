(()=>{"use strict";const e=function(e){let t=0;const o=()=>{let t=0;return e.forEach((e=>{t++})),t};return{getLength:o,isSunk:()=>t>=o(),hit:()=>{t++},getHits:()=>t,getPath:()=>e,resetHits:()=>{t=0},hits:t}},t=e=>{const t=[],o=function(e){const t=[...Array(10)].map((e=>Array(10).fill("none"))),o=[],r=[];let n=[];const a=e=>{n.push(e)};return{placeShip:e=>{e.getPath().forEach((o=>{const[r,n]=o;t[r][n]=e})),a(e)},boardArray:t,receiveAttack:e=>{const[n,a]=e;let s,l=!1;s=o.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),l=r.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),"none"!==t[n][a]&&!1===s?(t[n][a].hit(),o.push(e)):"none"===t[n][a]&&!1===l&&r.push(e)},hits:o,misses:r,addShip:a,resetGameboard:()=>{o=[],r=[],n=[]},isShip:e=>{const[o,r]=e;return"none"!==t[o][r]},getShip:e=>{const[o,r]=e;return t[o][r]},ships:n,type:e}}(e),r=e=>{t.push(e)};return{attempt:r,board:o,type:e,generateMove:()=>{const e=e=>Math.floor(Math.random()*e),o=e=>t.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]}));let n=[e(9),e(9)];for(;o(n);)n=[e(9),e(9)];return r(n),n},generateRandomPath:e=>{const t=Math.random()<.5;let o,r;t?(o=Math.floor(Math.random()*(10-e+1)),r=Math.floor(10*Math.random())):(o=Math.floor(10*Math.random()),r=Math.floor(Math.random()*(10-e+1)));const n=[];for(let a=0;a<e;a++)t?n.push([o+a,r]):n.push([o,r+a]);return n}}},o=(()=>{const t=(e,t)=>{const[o,r]=e,n=document.getElementById(`${t.type} - ${o},${r}`),a=t.isShip(e);n.innerHTML=a?"Hit":"Miss"};let o=!0;const r=[2,3,4,5];let n=5;const s=()=>{const e=document.getElementById("chooseShip");r.find((e=>e===n-1))?(n--,e.textContent=`Choose ${n} Coordinates`):(document.querySelectorAll(".selectCell").forEach((e=>{e.style.pointerEvents="none"})),e.textContent='Click "Start Game" to Begin.')},l=e=>{const[t,o]=e,r=document.querySelectorAll(".selectCell");for(const e of r)if(parseInt(e.dataset.x)===t&&parseInt(e.dataset.y)===o)return e},c=()=>{o=!o};return{renderBoard:e=>{const o=document.getElementById("board");o.innerHTML='<div id="overlay"></div>';const r=document.createElement("h3");console.log(e),r.innerHTML=`${e.type}'s Turn`,o.appendChild(r),e.boardArray.forEach(((t,r)=>{const n=document.createElement("div");n.classList.add("rowDiv"),t.forEach(((t,o)=>{const s=document.createElement("div");s.classList.add("boardCell"),s.id=`${e.type} - ${r},${o}`,s.dataset.board=e.type,s.dataset.x=r,s.dataset.y=o,e===a.computerPlayer.board&&"none"!==t&&s.classList.add("selected"),"none"!==t&&(s.classList.add("shipCell"),t.isSunk()&&(s.style.backgroundColor="red")),s.addEventListener("click",(e=>{e.stopPropagation(),""===s.textContent&&a.moveEvent(s)})),n.appendChild(s)})),o.appendChild(n)})),e.misses.forEach((o=>{t(o,e)})),e.hits.forEach((o=>{t(o,e)}))},attempt:t,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"},styleSunk:e=>{document.querySelectorAll(".rowDiv").forEach((t=>{document.querySelectorAll(".boardCell").forEach((t=>{const[o,r]=[t.dataset.x,t.dataset.y];"User"===e?a.userPlayer.board.isShip([o,r])&&a.userPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red"):a.computerPlayer.board.isShip([o,r])&&a.computerPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red")}))}))},renderStart:()=>{document.getElementById("startScreen").style.display="flex",document.getElementById("board").style.display="none",document.getElementById("switchTurnBtn").style.display="none",(()=>{const t=document.getElementById("startScreen");t.style.display="flex";const r=document.createElement("button");r.textContent="Flip Ship Direction",r.id="flipBtn";const d=document.createElement("button");d.id="startBtn",d.textContent="Start Game";const i=document.createElement("h3");i.textContent=`Choose ${n} Coordinates`,i.id="chooseShip";for(let u=0;u<10;u++){const p=document.createElement("div");p.classList.add("rowDiv");for(let t=0;t<10;t++){const r=document.createElement("div");r.classList.add("selectCell"),p.appendChild(r),r.dataset.x=u,r.dataset.y=t;const c=e=>a.computerPlayer.board.isShip([e.dataset.x,e.dataset.y]);r.onmouseenter=e=>{r.style.backgroundColor="yellow",c(r)&&(r.style.backgroundColor="black");for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="yellow"),c(r)&&(r.style.backgroundColor="black")}},r.onmouseout=e=>{r.style.backgroundColor="";for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="")}},r.onclick=c=>{let d=[[parseInt(r.dataset.x),parseInt(r.dataset.y)]];r.classList.add("selected");for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),r.classList.add("selected"),console.log(r.style.backgroundColor),d.push([parseInt(r.dataset.x),parseInt(r.dataset.y)])}a.computerPlayer.board.placeShip(e(d)),console.log("placed"),s()}}t.appendChild(p),t.appendChild(i),t.appendChild(r),t.appendChild(d),d.onclick=()=>{t.style.display="",document.getElementById("board").style.display="",document.getElementById("switchTurnBtn").style.display="",d.style.display="none"},r.onclick=c}})()},toggleTurnBtn:()=>{const e=document.getElementById("switchTurnBtn");e.disabled=!e.disabled}}})(),r=o,n=(()=>{const o=t("Computer"),a=t("User");let s=a;const l=e=>{e.board.ships.length>0&&e.board.ships.every((e=>e.isSunk()))&&alert(`${s.type} wins`)};return{initGame:()=>{a.board,o.board},switchTurn:()=>{console.log("start switch",n.currentPlayer.type),n.currentPlayer===a?n.currentPlayer=o:n.currentPlayer=a,console.log("end switch",n.currentPlayer.type)},computerPlayer:o,userPlayer:a,currentPlayer:s,checkLoss:l,moveEvent:e=>{r.stopClicks();const t="Computer"===e.dataset.board?o.board:a.board;t.receiveAttack([e.dataset.x,e.dataset.y]),r.attempt([e.dataset.x,e.dataset.y],t),r.styleSunk(t.type),l(s),n.switchTurn(),r.toggleTurnBtn()},computerMoveEvent:async()=>{r.stopClicks(),await(750,new Promise((e=>{setTimeout(e,750)}))),console.log("after 1 sec");const e=n.computerPlayer.generateMove(),t=n.computerPlayer.board;t.receiveAttack(e),r.attempt(e,t),r.styleSunk(t.type),n.checkLoss(n.currentPlayer),n.switchTurn(),r.toggleTurnBtn()},setComputerShips:()=>{n.userPlayer.board.placeShip(e(o.generateRandomPath(2))),n.userPlayer.board.placeShip(e(o.generateRandomPath(3))),n.userPlayer.board.placeShip(e(o.generateRandomPath(4))),n.userPlayer.board.placeShip(e(o.generateRandomPath(5)))}}})(),a=n;a.initGame();const s=document.getElementById("switchTurnBtn");r.renderBoard(a.currentPlayer.board),r.renderStart(),a.setComputerShips(),s.onclick=()=>{r.toggleTurnBtn(),r.renderBoard(a.currentPlayer.board),a.currentPlayer===a.computerPlayer?a.computerMoveEvent():r.startClicks()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RWxDd0YsRUFBWVIsRUFBSzdCLGVBQWU5RSxNQUN0Q21ILEVBQVVuRyxjQUFjSCxHQUN4QixFQUFHYSxRQUFRYixFQUFhc0csR0FDeEIsRUFBRzlCLFVBQVU4QixFQUFVckgsTUFDdkI2RyxFQUFLRSxVQUFVRixFQUFLQyxlQUNwQkQsRUFBS08sYUFDTCxFQUFHVixlQUFlLEVBbUJsQmlCLGlCQWhCdUIsS0FDdkJkLEVBQUtwQixXQUFXdkYsTUFBTVcsVUFBVSxFQUFLbUUsRUFBZTFDLG1CQUFtQixLQUN2RXVFLEVBQUtwQixXQUFXdkYsTUFBTVcsVUFBVSxFQUFLbUUsRUFBZTFDLG1CQUFtQixLQUN2RXVFLEVBQUtwQixXQUFXdkYsTUFBTVcsVUFBVSxFQUFLbUUsRUFBZTFDLG1CQUFtQixLQUN2RXVFLEVBQUtwQixXQUFXdkYsTUFBTVcsVUFBVSxFQUFLbUUsRUFBZTFDLG1CQUFtQixJQUFJLEVBYzlFLEVBMUZZLEdBNEZiLElDNUZBLEVBQUs2RSxXQUNMLE1BQU1SLEVBQWdCOUQsU0FBU0MsZUFBZSxpQkFDOUMsRUFBR29CLFlBQVksRUFBSzRDLGNBQWM1RyxPQUNsQyxFQUFHd0YsY0FDSCxFQUFLaUMsbUJBRUxoQixFQUFjSixRQUFVLEtBQ3RCLEVBQUdHLGdCQUVILEVBQUd4QyxZQUFZLEVBQUs0QyxjQUFjNUcsT0FFOUIsRUFBSzRHLGdCQUFrQixFQUFLOUIsZUFDOUIsRUFBS3NDLG9CQUVMLEVBQUdoQyxhQUNMLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1VJLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gIGxldCBoaXRzID0gMDtcblxuICBjb25zdCBnZXRIaXRzID0gKCkgPT4ge1xuICAgIHJldHVybiBoaXRzO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzKys7XG4gIH07XG5cbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgcGF0aC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBjb3VudCsrO1xuICAgIH0pO1xuICAgIHJldHVybiBjb3VudDtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGhpdHMgPj0gZ2V0TGVuZ3RoKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGF0aCA9ICgpID0+IHtcbiAgICByZXR1cm4gcGF0aDtcbiAgfTtcblxuICBjb25zdCByZXNldEhpdHMgPSAoKSA9PiB7XG4gICAgaGl0cyA9IDA7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TGVuZ3RoLCBpc1N1bmssIGhpdCwgZ2V0SGl0cywgZ2V0UGF0aCwgcmVzZXRIaXRzLCBoaXRzIH07XG59O1xuZXhwb3J0IGRlZmF1bHQgU2hpcDtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5cbmNvbnN0IFBsYXllciA9ICh0eXBlKSA9PiB7XG4gIGNvbnN0IGF0dGVtcHRzID0gW107XG4gIGNvbnN0IHR1cm4gPSBmYWxzZTtcbiAgY29uc3QgYm9hcmQgPSBHYW1lYm9hcmQodHlwZSk7XG5cbiAgY29uc3QgYXR0ZW1wdCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGF0dGVtcHRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlTW92ZSA9ICgpID0+IHtcbiAgICBjb25zdCBnZXRSYW5kb21JbnQgPSAobWF4KSA9PiB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KTtcbiAgICB9O1xuXG4gICAgY29uc3QgY2hlY2tBdHRlbXB0ZWQgPSAoYXR0ZW1wdCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXR0ZW1wdHMuc29tZSgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlO1xuXG4gICAgICAgIHJldHVybiB4ID09PSBhdHRlbXB0WzBdICYmIHkgPT09IGF0dGVtcHRbMV07XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgbGV0IG1vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuXG4gICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG1vdmUpKSB7XG4gICAgICBtb3ZlID0gW2dldFJhbmRvbUludCg5KSwgZ2V0UmFuZG9tSW50KDkpXTtcbiAgICB9XG5cbiAgICBhdHRlbXB0KG1vdmUpO1xuXG4gICAgcmV0dXJuIG1vdmU7XG4gIH07XG5cbiAgY29uc3QgZ2VuZXJhdGVSYW5kb21QYXRoID0gKHNoaXBMZW5ndGgpID0+IHtcbiAgICBjb25zdCBob3Jpem9udGFsID0gTWF0aC5yYW5kb20oKSA8IDAuNTsgLy8gUmFuZG9tbHkgY2hvb3NlIGhvcml6b250YWwgb3IgdmVydGljYWwgcGxhY2VtZW50XG4gICAgbGV0IHgsIHk7XG5cbiAgICBpZiAoaG9yaXpvbnRhbCkge1xuICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMCAtIHNoaXBMZW5ndGggKyAxKSk7XG4gICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIH0gZWxzZSB7XG4gICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMCAtIHNoaXBMZW5ndGggKyAxKSk7XG4gICAgfVxuXG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGhvcml6b250YWwpIHtcbiAgICAgICAgY29vcmRpbmF0ZXMucHVzaChbeCArIGksIHldKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvb3JkaW5hdGVzLnB1c2goW3gsIHkgKyBpXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7IGF0dGVtcHQsIGJvYXJkLCB0eXBlLCBnZW5lcmF0ZU1vdmUsIGdlbmVyYXRlUmFuZG9tUGF0aCB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyO1xuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcC5qc1wiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSBmdW5jdGlvbiAodHlwZSkge1xuICBjb25zdCBib2FyZEFycmF5ID0gWy4uLkFycmF5KDEwKV0ubWFwKChlKSA9PiBBcnJheSgxMCkuZmlsbChcIm5vbmVcIikpO1xuICBjb25zdCBoaXRzID0gW107XG4gIGNvbnN0IG1pc3NlcyA9IFtdO1xuICBsZXQgc2hpcHMgPSBbXTtcblxuICAvLyBjb25zdCBpbml0Qm9hcmQgPSAoKSA9PiB7XG4gIC8vICAgcGxhY2VTaGlwKFxuICAvLyAgICAgU2hpcChbXG4gIC8vICAgICAgIFsxLCA0XSxcbiAgLy8gICAgICAgWzEsIDVdLFxuICAvLyAgICAgXSlcbiAgLy8gICApO1xuICAvLyAgIHBsYWNlU2hpcChcbiAgLy8gICAgIFNoaXAoW1xuICAvLyAgICAgICBbNiwgNF0sXG4gIC8vICAgICAgIFs2LCA1XSxcbiAgLy8gICAgICAgWzYsIDZdLFxuICAvLyAgICAgXSlcbiAgLy8gICApO1xuICAvLyAgIHBsYWNlU2hpcChcbiAgLy8gICAgIFNoaXAoW1xuICAvLyAgICAgICBbNCwgMl0sXG4gIC8vICAgICAgIFs1LCAyXSxcbiAgLy8gICAgICAgWzYsIDJdLFxuICAvLyAgICAgICBbNywgMl0sXG4gIC8vICAgICBdKVxuICAvLyAgICk7XG5cbiAgLy8gICBwbGFjZVNoaXAoXG4gIC8vICAgICBTaGlwKFtcbiAgLy8gICAgICAgWzgsIDNdLFxuICAvLyAgICAgICBbOCwgNF0sXG4gIC8vICAgICAgIFs4LCA1XSxcbiAgLy8gICAgICAgWzgsIDZdLFxuICAvLyAgICAgICBbOCwgN10sXG4gIC8vICAgICBdKVxuICAvLyAgICk7XG4gIC8vIH07XG5cbiAgY29uc3QgcmVzZXRHYW1lYm9hcmQgPSAoKSA9PiB7XG4gICAgaGl0cyA9IFtdO1xuICAgIG1pc3NlcyA9IFtdO1xuICAgIHNoaXBzID0gW107XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXBPYmplY3QpID0+IHtcbiAgICBjb25zdCBwYXRoID0gc2hpcE9iamVjdC5nZXRQYXRoKCk7XG4gICAgcGF0aC5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG4gICAgICBib2FyZEFycmF5W3hdW3ldID0gc2hpcE9iamVjdDtcbiAgICB9KTtcbiAgICBhZGRTaGlwKHNoaXBPYmplY3QpO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIGxldCBhbHJlYWR5SGl0LFxuICAgICAgYWxyZWFkeU1pc3MgPSBmYWxzZTtcblxuICAgIGFscmVhZHlIaXQgPSBoaXRzLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IFt4SXRlbSwgeUl0ZW1dID0gaXRlbTtcbiAgICAgIHJldHVybiB4SXRlbSA9PT0gY29vcmRpbmF0ZXNbMF0gJiYgeUl0ZW0gPT09IGNvb3JkaW5hdGVzWzFdO1xuICAgIH0pO1xuICAgIGFscmVhZHlNaXNzID0gbWlzc2VzLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IFt4SXRlbSwgeUl0ZW1dID0gaXRlbTtcbiAgICAgIHJldHVybiB4SXRlbSA9PT0gY29vcmRpbmF0ZXNbMF0gJiYgeUl0ZW0gPT09IGNvb3JkaW5hdGVzWzFdO1xuICAgIH0pO1xuXG4gICAgaWYgKGJvYXJkQXJyYXlbeF1beV0gIT09IFwibm9uZVwiICYmIGFscmVhZHlIaXQgPT09IGZhbHNlKSB7XG4gICAgICBib2FyZEFycmF5W3hdW3ldLmhpdCgpO1xuICAgICAgaGl0cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICB9IGVsc2UgaWYgKGJvYXJkQXJyYXlbeF1beV0gPT09IFwibm9uZVwiICYmIGFscmVhZHlNaXNzID09PSBmYWxzZSkge1xuICAgICAgbWlzc2VzLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBhZGRTaGlwID0gKHNoaXApID0+IHtcbiAgICBzaGlwcy5wdXNoKHNoaXApO1xuICB9O1xuXG4gIGNvbnN0IGlzU2hpcCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgcmV0dXJuIGJvYXJkQXJyYXlbeF1beV0gIT09IFwibm9uZVwiO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXAgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIHJldHVybiBib2FyZEFycmF5W3hdW3ldO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcGxhY2VTaGlwLFxuICAgIGJvYXJkQXJyYXksXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBoaXRzLFxuICAgIG1pc3NlcyxcbiAgICBhZGRTaGlwLFxuICAgIHJlc2V0R2FtZWJvYXJkLFxuICAgIC8vIGluaXRCb2FyZCxcbiAgICBpc1NoaXAsXG4gICAgZ2V0U2hpcCxcbiAgICBzaGlwcyxcbiAgICB0eXBlLFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgR2FtZWJvYXJkO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vUGxheWVyXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5cbmNvbnN0IFVJID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyU3RhcnQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcbiAgICBib2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBuZXh0VHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcbiAgICBuZXh0VHVybkJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBnZW5lcmF0ZUdyaWQoKTtcbiAgfTtcblxuICBjb25zdCBzdGFydEV2ZW50ID0gKGVsZW1lbnQpID0+IHtcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgbmV4dFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgbmV4dFR1cm5CdG4uc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyQm9hcmQpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XG4gICAgYm9hcmQuaW5uZXJIVE1MID0gYDxkaXYgaWQ9XCJvdmVybGF5XCI+PC9kaXY+YDtcblxuICAgIGNvbnN0IHBsYXllclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIGNvbnNvbGUubG9nKHBsYXllckJvYXJkKTtcbiAgICBwbGF5ZXJUaXRsZS5pbm5lckhUTUwgPSBgJHtwbGF5ZXJCb2FyZC50eXBlfSdzIFR1cm5gO1xuXG4gICAgYm9hcmQuYXBwZW5kQ2hpbGQocGxheWVyVGl0bGUpO1xuXG4gICAgcGxheWVyQm9hcmQuYm9hcmRBcnJheS5mb3JFYWNoKChyb3csIHJvd0luZGV4KSA9PiB7XG4gICAgICBjb25zdCByb3dEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcm93RGl2LmNsYXNzTGlzdC5hZGQoXCJyb3dEaXZcIik7XG5cbiAgICAgIHJvdy5mb3JFYWNoKChpdGVtLCBjZWxsSW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImJvYXJkQ2VsbFwiKTtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllckJvYXJkLnR5cGV9IC0gJHtyb3dJbmRleH0sJHtjZWxsSW5kZXh9YDtcbiAgICAgICAgY2VsbC5kYXRhc2V0LmJvYXJkID0gcGxheWVyQm9hcmQudHlwZTtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnggPSByb3dJbmRleDtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnkgPSBjZWxsSW5kZXg7XG5cbiAgICAgICAgaWYgKHBsYXllckJvYXJkID09PSBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkICYmIGl0ZW0gIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXRlbSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJzaGlwQ2VsbFwiKTtcblxuICAgICAgICAgIGlmIChpdGVtLmlzU3VuaygpKSB7XG4gICAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIGlmIChjZWxsLnRleHRDb250ZW50ID09PSBcIlwiKSBnYW1lLm1vdmVFdmVudChjZWxsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcm93RGl2LmFwcGVuZENoaWxkKGNlbGwpO1xuICAgICAgfSk7XG5cbiAgICAgIGJvYXJkLmFwcGVuZENoaWxkKHJvd0Rpdik7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5taXNzZXMuZm9yRWFjaCgoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGF0dGVtcHQoY29vcmRpbmF0ZXMsIHBsYXllckJvYXJkKTtcbiAgICB9KTtcbiAgICBwbGF5ZXJCb2FyZC5oaXRzLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBhdHRlbXB0KGNvb3JkaW5hdGVzLCBwbGF5ZXJCb2FyZCk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgYXR0ZW1wdCA9IChjb29yZGluYXRlcywgZ2FtZWJvYXJkKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2dhbWVib2FyZC50eXBlfSAtICR7eH0sJHt5fWApO1xuICAgIGNvbnN0IGlzU2hpcCA9IGdhbWVib2FyZC5pc1NoaXAoY29vcmRpbmF0ZXMpO1xuXG4gICAgaWYgKGlzU2hpcCkge1xuICAgICAgdGFyZ2V0Q2VsbC5pbm5lckhUTUwgPSBcIkhpdFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0YXJnZXRDZWxsLmlubmVySFRNTCA9IFwiTWlzc1wiO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzdG9wQ2xpY2tzID0gKCkgPT4ge1xuICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm92ZXJsYXlcIik7XG5cbiAgICBvdmVybGF5LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImFsbFwiO1xuICB9O1xuXG4gIGNvbnN0IHN0YXJ0Q2xpY2tzID0gKCkgPT4ge1xuICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm92ZXJsYXlcIik7XG5cbiAgICBvdmVybGF5LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgfTtcblxuICBjb25zdCBzdHlsZVN1bmsgPSAoYm9hcmRUeXBlKSA9PiB7XG4gICAgY29uc3Qgcm93cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucm93RGl2XCIpO1xuICAgIHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG4gICAgICBjb25zdCBjZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYm9hcmRDZWxsXCIpO1xuICAgICAgY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICBjb25zdCBbeCwgeV0gPSBbY2VsbC5kYXRhc2V0LngsIGNlbGwuZGF0YXNldC55XTtcblxuICAgICAgICBpZiAoYm9hcmRUeXBlID09PSBcIlVzZXJcIikge1xuICAgICAgICAgIGlmIChnYW1lLnVzZXJQbGF5ZXIuYm9hcmQuaXNTaGlwKFt4LCB5XSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXAgPSBnYW1lLnVzZXJQbGF5ZXIuYm9hcmQuZ2V0U2hpcChbeCwgeV0pO1xuICAgICAgICAgICAgaWYgKHNoaXAuaXNTdW5rKCkpIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQuaXNTaGlwKFt4LCB5XSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXAgPSBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLmdldFNoaXAoW3gsIHldKTtcbiAgICAgICAgICAgIGlmIChzaGlwLmlzU3VuaygpKSBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCB0b2dnbGVUdXJuQnRuID0gKCkgPT4ge1xuICAgIGNvbnN0IHN3aXRjaFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgc3dpdGNoVHVybkJ0bi5kaXNhYmxlZCA9ICFzd2l0Y2hUdXJuQnRuLmRpc2FibGVkO1xuICB9O1xuXG4gIC8vIENob29zZSBTaGlwIExvY2F0aW9uc1xuXG4gIGxldCBpc1ZlcnRpY2FsID0gdHJ1ZTtcbiAgY29uc3Qgc2hpcExlbmd0aHMgPSBbMiwgMywgNCwgNV07XG4gIGxldCBjdXJyZW50U2hpcExlbmd0aCA9IDU7XG5cbiAgY29uc3QgZ2VuZXJhdGVHcmlkID0gKCkgPT4ge1xuICAgIGNvbnN0IHN0YXJ0U2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGFydFNjcmVlblwiKTtcbiAgICBzdGFydFNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cbiAgICBjb25zdCBmbGlwQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBmbGlwQnV0dG9uLnRleHRDb250ZW50ID0gXCJGbGlwIFNoaXAgRGlyZWN0aW9uXCI7XG4gICAgZmxpcEJ1dHRvbi5pZCA9IFwiZmxpcEJ0blwiO1xuXG4gICAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIHN0YXJ0QnV0dG9uLmlkID0gXCJzdGFydEJ0blwiO1xuICAgIHN0YXJ0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTdGFydCBHYW1lXCI7XG5cbiAgICBjb25zdCBjaG9vc2VTaGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIGNob29zZVNoaXAudGV4dENvbnRlbnQgPSBgQ2hvb3NlICR7Y3VycmVudFNoaXBMZW5ndGh9IENvb3JkaW5hdGVzYDtcbiAgICBjaG9vc2VTaGlwLmlkID0gXCJjaG9vc2VTaGlwXCI7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGNvbnN0IHJvd0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICByb3dEaXYuY2xhc3NMaXN0LmFkZChcInJvd0RpdlwiKTtcblxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaisrKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RDZWxsXCIpO1xuICAgICAgICByb3dEaXYuYXBwZW5kQ2hpbGQoY2VsbCk7XG5cbiAgICAgICAgY2VsbC5kYXRhc2V0LnggPSBpO1xuICAgICAgICBjZWxsLmRhdGFzZXQueSA9IGo7XG5cbiAgICAgICAgLy8gY29uc3QgY29uZmxpY3RpbmcgPSAoY2hlY2tDZWxsKSA9PiB7XG4gICAgICAgIC8vICAgZm9yIChzaGlwIG9mIGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQuc2hpcHMpIHtcbiAgICAgICAgLy8gICAgIGZvciAoY29vcmRpbmF0ZXMgb2Ygc2hpcC5wYXRoKSB7XG4gICAgICAgIC8vICAgICAgIGlmIChcbiAgICAgICAgLy8gICAgICAgICBjb29yZGluYXRlc1swXSA9PT0gcGFyc2VJbnQoY2hlY2tDZWxsLmRhdGFzZXQueCkgJiZcbiAgICAgICAgLy8gICAgICAgICBjb29yZGluYXRlc1sxXSA9PT0gcGFyc2VJbnQoY2hlY2tDZWxsLmRhdGFzZXQueSlcbiAgICAgICAgLy8gICAgICAgKSB7XG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIC8vICAgICAgIH1cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gICB9XG4gICAgICAgIC8vICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAvLyB9O1xuXG4gICAgICAgIGNvbnN0IGNvbmZsaWN0aW5nID0gKGNoZWNrQ2VsbCkgPT4ge1xuICAgICAgICAgIHJldHVybiBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLmlzU2hpcChbXG4gICAgICAgICAgICBjaGVja0NlbGwuZGF0YXNldC54LFxuICAgICAgICAgICAgY2hlY2tDZWxsLmRhdGFzZXQueSxcbiAgICAgICAgICBdKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjZWxsLm9ubW91c2VlbnRlciA9IChlKSA9PiB7XG4gICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInllbGxvd1wiO1xuICAgICAgICAgIGlmIChjb25mbGljdGluZyhjZWxsKSkgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImJsYWNrXCI7XG4gICAgICAgICAgZm9yIChsZXQgayA9IDE7IGsgPCBjdXJyZW50U2hpcExlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICBsZXQgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2ksIGogKyBrXSk7XG5cbiAgICAgICAgICAgIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgIG5ld0NlbGwgPSBnZXRTZWxlY3RDZWxsKFtpICsgaywgal0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgICAgICAgICBpZiAoY29uZmxpY3RpbmcobmV3Q2VsbCkpIG5ld0NlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJibGFja1wiO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjZWxsLm9ubW91c2VvdXQgPSAoZSkgPT4ge1xuICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJcIjtcbiAgICAgICAgICBmb3IgKGxldCBrID0gMTsgayA8IGN1cnJlbnRTaGlwTGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGxldCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSwgaiArIGtdKTtcblxuICAgICAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXdDZWxsICE9PSB1bmRlZmluZWQpIG5ld0NlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY2VsbC5vbmNsaWNrID0gKGUpID0+IHtcbiAgICAgICAgICBsZXQgc2hpcENvb3JkaW5hdGVzID0gW1xuICAgICAgICAgICAgW3BhcnNlSW50KGNlbGwuZGF0YXNldC54KSwgcGFyc2VJbnQoY2VsbC5kYXRhc2V0LnkpXSxcbiAgICAgICAgICBdO1xuXG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG5cbiAgICAgICAgICBmb3IgKGxldCBrID0gMTsgayA8IGN1cnJlbnRTaGlwTGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGxldCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSwgaiArIGtdKTtcblxuICAgICAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5ld0NlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cobmV3Q2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpO1xuICAgICAgICAgICAgc2hpcENvb3JkaW5hdGVzLnB1c2goW1xuICAgICAgICAgICAgICBwYXJzZUludChuZXdDZWxsLmRhdGFzZXQueCksXG4gICAgICAgICAgICAgIHBhcnNlSW50KG5ld0NlbGwuZGF0YXNldC55KSxcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQucGxhY2VTaGlwKFNoaXAoc2hpcENvb3JkaW5hdGVzKSk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhcInBsYWNlZFwiKTtcbiAgICAgICAgICBuZXh0U2hpcCgpO1xuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChyb3dEaXYpO1xuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQoY2hvb3NlU2hpcCk7XG4gICAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChmbGlwQnV0dG9uKTtcbiAgICAgIHN0YXJ0U2NyZWVuLmFwcGVuZENoaWxkKHN0YXJ0QnV0dG9uKTtcblxuICAgICAgc3RhcnRCdXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgc3RhcnRFdmVudChzdGFydFNjcmVlbik7XG4gICAgICAgIHN0YXJ0QnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIH07XG5cbiAgICAgIGZsaXBCdXR0b24ub25jbGljayA9IGZsaXA7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IG5leHRTaGlwID0gKCkgPT4ge1xuICAgIGNvbnN0IGNob29zZVNoaXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNob29zZVNoaXBcIik7XG5cbiAgICBpZiAoXG4gICAgICBzaGlwTGVuZ3Rocy5maW5kKChsZW5ndGgpID0+IHtcbiAgICAgICAgcmV0dXJuIGxlbmd0aCA9PT0gY3VycmVudFNoaXBMZW5ndGggLSAxO1xuICAgICAgfSlcbiAgICApIHtcbiAgICAgIGN1cnJlbnRTaGlwTGVuZ3RoLS07XG4gICAgICBjaG9vc2VTaGlwLnRleHRDb250ZW50ID0gYENob29zZSAke2N1cnJlbnRTaGlwTGVuZ3RofSBDb29yZGluYXRlc2A7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zZWxlY3RDZWxsXCIpO1xuICAgICAgY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICBjZWxsLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgICAgIH0pO1xuICAgICAgY2hvb3NlU2hpcC50ZXh0Q29udGVudCA9IGBDbGljayBcIlN0YXJ0IEdhbWVcIiB0byBCZWdpbi5gO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBnZXRTZWxlY3RDZWxsID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICBjb25zdCBzZWxlY3RDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2VsZWN0Q2VsbFwiKTtcbiAgICBmb3IgKGNvbnN0IHNlbGVjdENlbGwgb2Ygc2VsZWN0Q2VsbHMpIHtcbiAgICAgIGlmIChcbiAgICAgICAgcGFyc2VJbnQoc2VsZWN0Q2VsbC5kYXRhc2V0LngpID09PSB4ICYmXG4gICAgICAgIHBhcnNlSW50KHNlbGVjdENlbGwuZGF0YXNldC55KSA9PT0geVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBzZWxlY3RDZWxsO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBmbGlwID0gKCkgPT4ge1xuICAgIGlzVmVydGljYWwgPSAhaXNWZXJ0aWNhbDtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckJvYXJkLFxuICAgIGF0dGVtcHQsXG4gICAgc3RvcENsaWNrcyxcbiAgICBzdGFydENsaWNrcyxcbiAgICBzdHlsZVN1bmssXG4gICAgcmVuZGVyU3RhcnQsXG4gICAgdG9nZ2xlVHVybkJ0bixcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFVJO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuL1NoaXBcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vUGxheWVyXCI7XG5pbXBvcnQgVUkgZnJvbSBcIi4vVUlcIjtcblxuY29uc3QgZ2FtZSA9ICgoKSA9PiB7XG4gIGNvbnN0IGNvbXB1dGVyUGxheWVyID0gUGxheWVyKFwiQ29tcHV0ZXJcIik7XG4gIGNvbnN0IHVzZXJQbGF5ZXIgPSBQbGF5ZXIoXCJVc2VyXCIpO1xuXG4gIGxldCBjdXJyZW50UGxheWVyID0gdXNlclBsYXllcjtcblxuICBjb25zdCBpbml0R2FtZSA9ICgpID0+IHtcbiAgICBjb25zdCB1c2VyQm9hcmQgPSB1c2VyUGxheWVyLmJvYXJkO1xuICAgIGNvbnN0IGNvbXB1dGVyQm9hcmQgPSBjb21wdXRlclBsYXllci5ib2FyZDtcbiAgICAvLyBjb21wdXRlckJvYXJkLmluaXRCb2FyZCgpO1xuICAgIC8vIHVzZXJCb2FyZC5pbml0Qm9hcmQoKTtcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hUdXJuID0gKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwic3RhcnQgc3dpdGNoXCIsIGdhbWUuY3VycmVudFBsYXllci50eXBlKTtcbiAgICBpZiAoZ2FtZS5jdXJyZW50UGxheWVyID09PSB1c2VyUGxheWVyKSB7XG4gICAgICBnYW1lLmN1cnJlbnRQbGF5ZXIgPSBjb21wdXRlclBsYXllcjtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2FtZS5jdXJyZW50UGxheWVyID0gdXNlclBsYXllcjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcImVuZCBzd2l0Y2hcIiwgZ2FtZS5jdXJyZW50UGxheWVyLnR5cGUpO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrTG9zcyA9IChwbGF5ZXIpID0+IHtcbiAgICBjb25zdCBhbGxTdW5rID1cbiAgICAgIHBsYXllci5ib2FyZC5zaGlwcy5sZW5ndGggPiAwICYmXG4gICAgICBwbGF5ZXIuYm9hcmQuc2hpcHMuZXZlcnkoKHNoaXApID0+IHtcbiAgICAgICAgcmV0dXJuIHNoaXAuaXNTdW5rKCk7XG4gICAgICB9KTtcblxuICAgIGlmIChhbGxTdW5rKSBhbGVydChgJHtjdXJyZW50UGxheWVyLnR5cGV9IHdpbnNgKTtcbiAgfTtcblxuICBjb25zdCBtb3ZlRXZlbnQgPSAoY2VsbCkgPT4ge1xuICAgIFVJLnN0b3BDbGlja3MoKTtcbiAgICBjb25zdCBjZWxsQm9hcmQgPVxuICAgICAgY2VsbC5kYXRhc2V0LmJvYXJkID09PSBcIkNvbXB1dGVyXCJcbiAgICAgICAgPyBjb21wdXRlclBsYXllci5ib2FyZFxuICAgICAgICA6IHVzZXJQbGF5ZXIuYm9hcmQ7XG5cbiAgICBjZWxsQm9hcmQucmVjZWl2ZUF0dGFjayhbY2VsbC5kYXRhc2V0LngsIGNlbGwuZGF0YXNldC55XSk7XG4gICAgVUkuYXR0ZW1wdChbY2VsbC5kYXRhc2V0LngsIGNlbGwuZGF0YXNldC55XSwgY2VsbEJvYXJkKTtcbiAgICBVSS5zdHlsZVN1bmsoY2VsbEJvYXJkLnR5cGUpO1xuICAgIGNoZWNrTG9zcyhjdXJyZW50UGxheWVyKTtcbiAgICBnYW1lLnN3aXRjaFR1cm4oKTtcbiAgICBVSS50b2dnbGVUdXJuQnRuKCk7XG4gIH07XG5cbiAgY29uc3QgY29tcHV0ZXJNb3ZlRXZlbnQgPSBhc3luYyAoKSA9PiB7XG4gICAgVUkuc3RvcENsaWNrcygpO1xuXG4gICAgY29uc3QgZGVsYXkgPSAobWlsbGlzZWNvbmRzKSA9PiB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCBtaWxsaXNlY29uZHMpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGF3YWl0IGRlbGF5KDc1MCk7XG5cbiAgICBjb25zb2xlLmxvZyhcImFmdGVyIDEgc2VjXCIpO1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gZ2FtZS5jb21wdXRlclBsYXllci5nZW5lcmF0ZU1vdmUoKTtcblxuICAgIGNvbnN0IGNlbGxCb2FyZCA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQ7XG4gICAgY2VsbEJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMpO1xuICAgIFVJLmF0dGVtcHQoY29vcmRpbmF0ZXMsIGNlbGxCb2FyZCk7XG4gICAgVUkuc3R5bGVTdW5rKGNlbGxCb2FyZC50eXBlKTtcbiAgICBnYW1lLmNoZWNrTG9zcyhnYW1lLmN1cnJlbnRQbGF5ZXIpO1xuICAgIGdhbWUuc3dpdGNoVHVybigpO1xuICAgIFVJLnRvZ2dsZVR1cm5CdG4oKTtcbiAgfTtcblxuICBjb25zdCBzZXRDb21wdXRlclNoaXBzID0gKCkgPT4ge1xuICAgIGdhbWUudXNlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChjb21wdXRlclBsYXllci5nZW5lcmF0ZVJhbmRvbVBhdGgoMikpKTtcbiAgICBnYW1lLnVzZXJQbGF5ZXIuYm9hcmQucGxhY2VTaGlwKFNoaXAoY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVSYW5kb21QYXRoKDMpKSk7XG4gICAgZ2FtZS51c2VyUGxheWVyLmJvYXJkLnBsYWNlU2hpcChTaGlwKGNvbXB1dGVyUGxheWVyLmdlbmVyYXRlUmFuZG9tUGF0aCg0KSkpO1xuICAgIGdhbWUudXNlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChjb21wdXRlclBsYXllci5nZW5lcmF0ZVJhbmRvbVBhdGgoNSkpKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXRHYW1lLFxuICAgIHN3aXRjaFR1cm4sXG4gICAgY29tcHV0ZXJQbGF5ZXIsXG4gICAgdXNlclBsYXllcixcbiAgICBjdXJyZW50UGxheWVyLFxuICAgIGNoZWNrTG9zcyxcbiAgICBtb3ZlRXZlbnQsXG4gICAgY29tcHV0ZXJNb3ZlRXZlbnQsXG4gICAgc2V0Q29tcHV0ZXJTaGlwcyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWU7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL21vZHVsZXMvR2FtZWJvYXJkLmpzXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9tb2R1bGVzL1NoaXAuanNcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL21vZHVsZXMvZ2FtZS5qc1wiO1xuaW1wb3J0IFVJIGZyb20gXCIuL21vZHVsZXMvVUkuanNcIjtcblxuZ2FtZS5pbml0R2FtZSgpO1xuY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcblVJLnJlbmRlckJvYXJkKGdhbWUuY3VycmVudFBsYXllci5ib2FyZCk7XG5VSS5yZW5kZXJTdGFydCgpO1xuZ2FtZS5zZXRDb21wdXRlclNoaXBzKCk7XG5cbnN3aXRjaFR1cm5CdG4ub25jbGljayA9ICgpID0+IHtcbiAgVUkudG9nZ2xlVHVybkJ0bigpO1xuXG4gIFVJLnJlbmRlckJvYXJkKGdhbWUuY3VycmVudFBsYXllci5ib2FyZCk7XG5cbiAgaWYgKGdhbWUuY3VycmVudFBsYXllciA9PT0gZ2FtZS5jb21wdXRlclBsYXllcikge1xuICAgIGdhbWUuY29tcHV0ZXJNb3ZlRXZlbnQoKTtcbiAgfSBlbHNlIHtcbiAgICBVSS5zdGFydENsaWNrcygpO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbInBhdGgiLCJoaXRzIiwiZ2V0TGVuZ3RoIiwiY291bnQiLCJmb3JFYWNoIiwiZWxlbWVudCIsImlzU3VuayIsImhpdCIsImdldEhpdHMiLCJnZXRQYXRoIiwicmVzZXRIaXRzIiwidHlwZSIsImF0dGVtcHRzIiwiYm9hcmQiLCJib2FyZEFycmF5IiwiQXJyYXkiLCJtYXAiLCJlIiwiZmlsbCIsIm1pc3NlcyIsInNoaXBzIiwiYWRkU2hpcCIsInNoaXAiLCJwdXNoIiwicGxhY2VTaGlwIiwic2hpcE9iamVjdCIsImNvb3JkaW5hdGVzIiwieCIsInkiLCJyZWNlaXZlQXR0YWNrIiwiYWxyZWFkeUhpdCIsImFscmVhZHlNaXNzIiwic29tZSIsIml0ZW0iLCJ4SXRlbSIsInlJdGVtIiwicmVzZXRHYW1lYm9hcmQiLCJpc1NoaXAiLCJnZXRTaGlwIiwiYXR0ZW1wdCIsImdlbmVyYXRlTW92ZSIsImdldFJhbmRvbUludCIsIm1heCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNoZWNrQXR0ZW1wdGVkIiwiY29vcmRpbmF0ZSIsIm1vdmUiLCJnZW5lcmF0ZVJhbmRvbVBhdGgiLCJzaGlwTGVuZ3RoIiwiaG9yaXpvbnRhbCIsImkiLCJVSSIsImdhbWVib2FyZCIsInRhcmdldENlbGwiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiaXNWZXJ0aWNhbCIsInNoaXBMZW5ndGhzIiwiY3VycmVudFNoaXBMZW5ndGgiLCJuZXh0U2hpcCIsImNob29zZVNoaXAiLCJmaW5kIiwibGVuZ3RoIiwidGV4dENvbnRlbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiY2VsbCIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsImdldFNlbGVjdENlbGwiLCJzZWxlY3RDZWxscyIsInNlbGVjdENlbGwiLCJwYXJzZUludCIsImRhdGFzZXQiLCJmbGlwIiwicmVuZGVyQm9hcmQiLCJwbGF5ZXJCb2FyZCIsInBsYXllclRpdGxlIiwiY3JlYXRlRWxlbWVudCIsImNvbnNvbGUiLCJsb2ciLCJhcHBlbmRDaGlsZCIsInJvdyIsInJvd0luZGV4Iiwicm93RGl2IiwiY2xhc3NMaXN0IiwiYWRkIiwiY2VsbEluZGV4IiwiaWQiLCJjb21wdXRlclBsYXllciIsImJhY2tncm91bmRDb2xvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdG9wUHJvcGFnYXRpb24iLCJtb3ZlRXZlbnQiLCJzdG9wQ2xpY2tzIiwic3RhcnRDbGlja3MiLCJzdHlsZVN1bmsiLCJib2FyZFR5cGUiLCJ1c2VyUGxheWVyIiwicmVuZGVyU3RhcnQiLCJkaXNwbGF5Iiwic3RhcnRTY3JlZW4iLCJmbGlwQnV0dG9uIiwic3RhcnRCdXR0b24iLCJqIiwiY29uZmxpY3RpbmciLCJjaGVja0NlbGwiLCJvbm1vdXNlZW50ZXIiLCJrIiwibmV3Q2VsbCIsInVuZGVmaW5lZCIsIm9ubW91c2VvdXQiLCJvbmNsaWNrIiwic2hpcENvb3JkaW5hdGVzIiwiZ2VuZXJhdGVHcmlkIiwidG9nZ2xlVHVybkJ0biIsInN3aXRjaFR1cm5CdG4iLCJkaXNhYmxlZCIsImdhbWUiLCJjdXJyZW50UGxheWVyIiwiY2hlY2tMb3NzIiwicGxheWVyIiwiZXZlcnkiLCJhbGVydCIsImluaXRHYW1lIiwic3dpdGNoVHVybiIsImNlbGxCb2FyZCIsImNvbXB1dGVyTW92ZUV2ZW50IiwiYXN5bmMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJzZXRDb21wdXRlclNoaXBzIl0sInNvdXJjZVJvb3QiOiIifQ==