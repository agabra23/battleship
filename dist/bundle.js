(()=>{"use strict";const e=function(e){let t=0;const r=()=>{let t=0;return e.forEach((e=>{t++})),t};return{getLength:r,isSunk:()=>t>=r(),hit:()=>{t++},getHits:()=>t,getPath:()=>e,resetHits:()=>{t=0},hits:t}},t=function(t){const r=[...Array(10)].map((e=>Array(10).fill("none"))),n=[],o=[];let s=[];const a=e=>{e.getPath().forEach((t=>{const[n,o]=t;r[n][o]=e})),l(e)},l=e=>{s.push(e)};return{placeShip:a,boardArray:r,receiveAttack:e=>{const[t,s]=e;let a,l=!1;a=n.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]})),l=o.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]})),"none"!==r[t][s]&&!1===a?(r[t][s].hit(),n.push(e)):"none"===r[t][s]&&!1===l&&o.push(e)},hits:n,misses:o,addShip:l,resetGameboard:()=>{n=[],o=[],s=[]},initBoard:()=>{a(e([[1,4],[1,5]])),a(e([[6,4],[6,5],[6,6]])),a(e([[4,2],[5,2],[6,2],[7,2]])),a(e([[8,3],[8,4],[8,5],[8,6],[8,7]])),a(e([[2,3],[2,4],[2,5],[2,6],[2,7]]))},isShip:e=>{const[t,n]=e;return"none"!==r[t][n]},getShip:e=>{const[t,n]=e;return r[t][n]},ships:s,type:t}},r=e=>{const r=[];return{attempt:e=>{r.push(e)},board:t(e),type:e,generateMove:()=>{const e=e=>Math.floor(Math.random()*e),t=e=>r.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]}));let n=[e(9),e(9)];for(;t(n);)n=[e(9),e(9)];return n}}},n=(()=>{const e=(e,t)=>{const[r,n]=e,o=document.getElementById(`${t.type} - ${r},${n}`),s=t.isShip(e);o.innerHTML=s?"Hit":"Miss"},t=e=>{const[t,r]=e,n=document.querySelectorAll(".selectCell");for(const e of n)if(parseInt(e.dataset.x)===t&&parseInt(e.dataset.y)===r)return e};return{renderBoard:t=>{const r=document.getElementById("board");r.innerHTML='<div id="overlay"></div>';const n=document.createElement("h3");console.log(t),n.innerHTML=`${t.type}'s Turn`,r.appendChild(n),t.boardArray.forEach(((e,n)=>{const o=document.createElement("div");o.classList.add("rowDiv"),e.forEach(((e,r)=>{const s=document.createElement("div");s.classList.add("boardCell"),s.id=`${t.type} - ${n},${r}`,s.dataset.board=t.type,s.dataset.x=n,s.dataset.y=r,"none"!==e&&(s.classList.add("shipCell"),e.isSunk()&&(s.style.backgroundColor="red")),s.addEventListener("click",(e=>{e.stopPropagation(),""===s.textContent&&a.moveEvent(s)})),o.appendChild(s)})),r.appendChild(o)})),t.misses.forEach((r=>{e(r,t)})),t.hits.forEach((r=>{e(r,t)}))},attempt:e,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"},styleSunk:e=>{document.querySelectorAll(".rowDiv").forEach((t=>{document.querySelectorAll(".boardCell").forEach((t=>{const[r,n]=[t.dataset.x,t.dataset.y];"User"===e?a.userPlayer.board.isShip([r,n])&&a.userPlayer.board.getShip([r,n]).isSunk()&&(t.style.backgroundColor="red"):a.computerPlayer.board.isShip([r,n])&&a.computerPlayer.board.getShip([r,n]).isSunk()&&(t.style.backgroundColor="red")}))}))},renderStart:()=>{const e=document.getElementById("startScreen");e.style.display="flex";const r=document.createElement("button");r.id="startBtn",r.textContent="Start Game",e.appendChild(r),document.getElementById("board").style.display="none",document.getElementById("switchTurnBtn").style.display="none",(()=>{const e=document.getElementById("startScreen");e.style.display="flex";for(let r=0;r<10;r++){const n=document.createElement("div");n.classList.add("rowDiv");for(let e=0;e<10;e++){const o=document.createElement("div");o.classList.add("selectCell"),n.appendChild(o),o.dataset.x=r,o.dataset.y=e,o.onmouseenter=n=>{n.target.style.backgroundColor="yellow";const o=t([r+1,e]);void 0!==o&&(o.style.backgroundColor="yellow")},o.onmouseout=n=>{n.target.style.backgroundColor="";const o=t([r+1,e]);void 0!==o&&(o.style.backgroundColor="")}}e.appendChild(n)}})(),r.onclick=()=>{e.style.display="",document.getElementById("board").style.display="",document.getElementById("switchTurnBtn").style.display="",r.style.display="none"}},toggleTurnBtn:()=>{const e=document.getElementById("switchTurnBtn");e.disabled=!e.disabled}}})(),o=n,s=(()=>{const e=r("Computer"),t=r("User");let n=t;const a=e=>{e.board.ships.every((e=>e.isSunk()))&&alert("win")};return{initGame:()=>{const r=t.board;e.board.initBoard(),r.initBoard()},switchTurn:()=>{console.log("start switch",s.currentPlayer.type),s.currentPlayer===t?s.currentPlayer=e:s.currentPlayer=t,console.log("end switch",s.currentPlayer.type)},computerPlayer:e,userPlayer:t,currentPlayer:n,checkLoss:a,moveEvent:r=>{o.stopClicks();const l="Computer"===r.dataset.board?e.board:t.board;l.receiveAttack([r.dataset.x,r.dataset.y]),o.attempt([r.dataset.x,r.dataset.y],l),o.styleSunk(l.type),a(n),s.switchTurn(),o.toggleTurnBtn()},computerMoveEvent:async()=>{o.stopClicks(),await(750,new Promise((e=>{setTimeout(e,750)}))),console.log("after 1 sec");const e=s.computerPlayer.generateMove(),t=s.computerPlayer.board;t.receiveAttack(e),o.attempt(e,t),o.styleSunk(t.type),s.checkLoss(s.currentPlayer),s.switchTurn(),o.toggleTurnBtn()}}})(),a=s;a.initGame();const l=document.getElementById("switchTurnBtn");o.renderBoard(a.currentPlayer.board),o.renderStart(),l.onclick=()=>{o.toggleTurnBtn(),o.renderBoard(a.currentPlayer.board),a.currentPlayer===a.computerPlayer?a.computerMoveEvent():o.startClicks()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QjJFLEVBQVV4RixjQUFjLENBQUNnRCxFQUFLZCxRQUFRdkMsRUFBR3FELEVBQUtkLFFBQVF0QyxJQUN0RCxFQUFHZ0IsUUFBUSxDQUFDb0MsRUFBS2QsUUFBUXZDLEVBQUdxRCxFQUFLZCxRQUFRdEMsR0FBSTRGLEdBQzdDLEVBQUc3QixVQUFVNkIsRUFBVXhHLE1BQ3ZCaUcsRUFBVUQsR0FDVkQsRUFBS1EsYUFDTCxFQUFHWCxlQUFlLEVBa0NsQmEsa0JBL0J3QkMsVUFDeEIsRUFBR2xDLG1CQVFTLElBTEgsSUFBSW1DLFNBQVNDLElBQ2xCQyxXQUFXRCxFQUlILElBSnlCLEtBTXJDckQsUUFBUUMsSUFBSSxlQUNaLE1BQU05QyxFQUFjcUYsRUFBS2pCLGVBQWVoRCxlQUVsQzBFLEVBQVlULEVBQUtqQixlQUFlakQsTUFDdEMyRSxFQUFVeEYsY0FBY04sR0FDeEIsRUFBR2tCLFFBQVFsQixFQUFhOEYsR0FDeEIsRUFBRzdCLFVBQVU2QixFQUFVeEcsTUFDdkIrRixFQUFLRSxVQUFVRixFQUFLQyxlQUNwQkQsRUFBS1EsYUFDTCxFQUFHWCxlQUFlLEVBYXJCLEVBaEZZLEdBa0ZiLElDbEZBLEVBQUtTLFdBQ0wsTUFBTVIsRUFBZ0JuRCxTQUFTQyxlQUFlLGlCQUM5QyxFQUFHUSxZQUFZLEVBQUs2QyxjQUFjbkUsT0FDbEMsRUFBR2tELGNBRUhjLEVBQWNGLFFBQVUsS0FDdEIsRUFBR0MsZ0JBRUgsRUFBR3pDLFlBQVksRUFBSzZDLGNBQWNuRSxPQUU5QixFQUFLbUUsZ0JBQWtCLEVBQUtsQixlQUM5QixFQUFLMkIsb0JBRUwsRUFBRy9CLGFBQ0wsQyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9TaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvVUkuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2dhbWUuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTaGlwID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgbGV0IGhpdHMgPSAwO1xuXG4gIGNvbnN0IGdldEhpdHMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGhpdHM7XG4gIH07XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdHMrKztcbiAgfTtcblxuICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiB7XG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICBwYXRoLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGNvdW50Kys7XG4gICAgfSk7XG4gICAgcmV0dXJuIGNvdW50O1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHtcbiAgICByZXR1cm4gaGl0cyA+PSBnZXRMZW5ndGgoKTtcbiAgfTtcblxuICBjb25zdCBnZXRQYXRoID0gKCkgPT4ge1xuICAgIHJldHVybiBwYXRoO1xuICB9O1xuXG4gIGNvbnN0IHJlc2V0SGl0cyA9ICgpID0+IHtcbiAgICBoaXRzID0gMDtcbiAgfTtcblxuICByZXR1cm4geyBnZXRMZW5ndGgsIGlzU3VuaywgaGl0LCBnZXRIaXRzLCBnZXRQYXRoLCByZXNldEhpdHMsIGhpdHMgfTtcbn07XG5leHBvcnQgZGVmYXVsdCBTaGlwO1xuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcC5qc1wiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSBmdW5jdGlvbiAodHlwZSkge1xuICBjb25zdCBib2FyZEFycmF5ID0gWy4uLkFycmF5KDEwKV0ubWFwKChlKSA9PiBBcnJheSgxMCkuZmlsbChcIm5vbmVcIikpO1xuICBjb25zdCBoaXRzID0gW107XG4gIGNvbnN0IG1pc3NlcyA9IFtdO1xuICBsZXQgc2hpcHMgPSBbXTtcblxuICBjb25zdCBpbml0Qm9hcmQgPSAoKSA9PiB7XG4gICAgcGxhY2VTaGlwKFxuICAgICAgU2hpcChbXG4gICAgICAgIFsxLCA0XSxcbiAgICAgICAgWzEsIDVdLFxuICAgICAgXSlcbiAgICApO1xuICAgIHBsYWNlU2hpcChcbiAgICAgIFNoaXAoW1xuICAgICAgICBbNiwgNF0sXG4gICAgICAgIFs2LCA1XSxcbiAgICAgICAgWzYsIDZdLFxuICAgICAgXSlcbiAgICApO1xuICAgIHBsYWNlU2hpcChcbiAgICAgIFNoaXAoW1xuICAgICAgICBbNCwgMl0sXG4gICAgICAgIFs1LCAyXSxcbiAgICAgICAgWzYsIDJdLFxuICAgICAgICBbNywgMl0sXG4gICAgICBdKVxuICAgICk7XG5cbiAgICBwbGFjZVNoaXAoXG4gICAgICBTaGlwKFtcbiAgICAgICAgWzgsIDNdLFxuICAgICAgICBbOCwgNF0sXG4gICAgICAgIFs4LCA1XSxcbiAgICAgICAgWzgsIDZdLFxuICAgICAgICBbOCwgN10sXG4gICAgICBdKVxuICAgICk7XG4gICAgcGxhY2VTaGlwKFxuICAgICAgU2hpcChbXG4gICAgICAgIFsyLCAzXSxcbiAgICAgICAgWzIsIDRdLFxuICAgICAgICBbMiwgNV0sXG4gICAgICAgIFsyLCA2XSxcbiAgICAgICAgWzIsIDddLFxuICAgICAgXSlcbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IHJlc2V0R2FtZWJvYXJkID0gKCkgPT4ge1xuICAgIGhpdHMgPSBbXTtcbiAgICBtaXNzZXMgPSBbXTtcbiAgICBzaGlwcyA9IFtdO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwT2JqZWN0KSA9PiB7XG4gICAgY29uc3QgcGF0aCA9IHNoaXBPYmplY3QuZ2V0UGF0aCgpO1xuICAgIHBhdGguZm9yRWFjaCgoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuICAgICAgYm9hcmRBcnJheVt4XVt5XSA9IHNoaXBPYmplY3Q7XG4gICAgfSk7XG4gICAgYWRkU2hpcChzaGlwT2JqZWN0KTtcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICBsZXQgYWxyZWFkeUhpdCxcbiAgICAgIGFscmVhZHlNaXNzID0gZmFsc2U7XG5cbiAgICBhbHJlYWR5SGl0ID0gaGl0cy5zb21lKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBbeEl0ZW0sIHlJdGVtXSA9IGl0ZW07XG4gICAgICByZXR1cm4geEl0ZW0gPT09IGNvb3JkaW5hdGVzWzBdICYmIHlJdGVtID09PSBjb29yZGluYXRlc1sxXTtcbiAgICB9KTtcbiAgICBhbHJlYWR5TWlzcyA9IG1pc3Nlcy5zb21lKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBbeEl0ZW0sIHlJdGVtXSA9IGl0ZW07XG4gICAgICByZXR1cm4geEl0ZW0gPT09IGNvb3JkaW5hdGVzWzBdICYmIHlJdGVtID09PSBjb29yZGluYXRlc1sxXTtcbiAgICB9KTtcblxuICAgIGlmIChib2FyZEFycmF5W3hdW3ldICE9PSBcIm5vbmVcIiAmJiBhbHJlYWR5SGl0ID09PSBmYWxzZSkge1xuICAgICAgYm9hcmRBcnJheVt4XVt5XS5oaXQoKTtcbiAgICAgIGhpdHMucHVzaChjb29yZGluYXRlcyk7XG4gICAgfSBlbHNlIGlmIChib2FyZEFycmF5W3hdW3ldID09PSBcIm5vbmVcIiAmJiBhbHJlYWR5TWlzcyA9PT0gZmFsc2UpIHtcbiAgICAgIG1pc3Nlcy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYWRkU2hpcCA9IChzaGlwKSA9PiB7XG4gICAgc2hpcHMucHVzaChzaGlwKTtcbiAgfTtcblxuICBjb25zdCBpc1NoaXAgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIHJldHVybiBib2FyZEFycmF5W3hdW3ldICE9PSBcIm5vbmVcIjtcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICByZXR1cm4gYm9hcmRBcnJheVt4XVt5XTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHBsYWNlU2hpcCxcbiAgICBib2FyZEFycmF5LFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgaGl0cyxcbiAgICBtaXNzZXMsXG4gICAgYWRkU2hpcCxcbiAgICByZXNldEdhbWVib2FyZCxcbiAgICBpbml0Qm9hcmQsXG4gICAgaXNTaGlwLFxuICAgIGdldFNoaXAsXG4gICAgc2hpcHMsXG4gICAgdHlwZSxcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZDtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5cbmNvbnN0IFBsYXllciA9ICh0eXBlKSA9PiB7XG4gIGNvbnN0IGF0dGVtcHRzID0gW107XG4gIGNvbnN0IHR1cm4gPSBmYWxzZTtcbiAgY29uc3QgYm9hcmQgPSBHYW1lYm9hcmQodHlwZSk7XG5cbiAgY29uc3QgYXR0ZW1wdCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGF0dGVtcHRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlTW92ZSA9ICgpID0+IHtcbiAgICBjb25zdCBnZXRSYW5kb21JbnQgPSAobWF4KSA9PiB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KTtcbiAgICB9O1xuXG4gICAgY29uc3QgY2hlY2tBdHRlbXB0ZWQgPSAoYXR0ZW1wdCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXR0ZW1wdHMuc29tZSgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlO1xuXG4gICAgICAgIHJldHVybiB4ID09PSBhdHRlbXB0WzBdICYmIHkgPT09IGF0dGVtcHRbMV07XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgbGV0IG1vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuXG4gICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG1vdmUpKSB7XG4gICAgICBtb3ZlID0gW2dldFJhbmRvbUludCg5KSwgZ2V0UmFuZG9tSW50KDkpXTtcbiAgICB9XG5cbiAgICByZXR1cm4gbW92ZTtcbiAgfTtcblxuICByZXR1cm4geyBhdHRlbXB0LCBib2FyZCwgdHlwZSwgZ2VuZXJhdGVNb3ZlIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXI7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL0dhbWVib2FyZFwiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi9QbGF5ZXJcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuL1NoaXBcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL2dhbWVcIjtcblxuY29uc3QgVUkgPSAoKCkgPT4ge1xuICBjb25zdCByZW5kZXJTdGFydCA9ICgpID0+IHtcbiAgICBjb25zdCBzdGFydFNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RhcnRTY3JlZW5cIik7XG4gICAgc3RhcnRTY3JlZW4uc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuXG4gICAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIHN0YXJ0QnV0dG9uLmlkID0gXCJzdGFydEJ0blwiO1xuICAgIHN0YXJ0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTdGFydCBHYW1lXCI7XG5cbiAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChzdGFydEJ1dHRvbik7XG5cbiAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XG4gICAgYm9hcmQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgY29uc3QgbmV4dFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgbmV4dFR1cm5CdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgZ2VuZXJhdGVHcmlkKCk7XG5cbiAgICBzdGFydEJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgc3RhcnRFdmVudChzdGFydFNjcmVlbik7XG4gICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfTtcbiAgfTtcblxuICBjb25zdCBzdGFydEV2ZW50ID0gKGVsZW1lbnQpID0+IHtcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgbmV4dFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgbmV4dFR1cm5CdG4uc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyQm9hcmQpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XG4gICAgYm9hcmQuaW5uZXJIVE1MID0gYDxkaXYgaWQ9XCJvdmVybGF5XCI+PC9kaXY+YDtcblxuICAgIGNvbnN0IHBsYXllclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIGNvbnNvbGUubG9nKHBsYXllckJvYXJkKTtcbiAgICBwbGF5ZXJUaXRsZS5pbm5lckhUTUwgPSBgJHtwbGF5ZXJCb2FyZC50eXBlfSdzIFR1cm5gO1xuXG4gICAgYm9hcmQuYXBwZW5kQ2hpbGQocGxheWVyVGl0bGUpO1xuXG4gICAgcGxheWVyQm9hcmQuYm9hcmRBcnJheS5mb3JFYWNoKChyb3csIHJvd0luZGV4KSA9PiB7XG4gICAgICBjb25zdCByb3dEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcm93RGl2LmNsYXNzTGlzdC5hZGQoXCJyb3dEaXZcIik7XG5cbiAgICAgIHJvdy5mb3JFYWNoKChpdGVtLCBjZWxsSW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImJvYXJkQ2VsbFwiKTtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllckJvYXJkLnR5cGV9IC0gJHtyb3dJbmRleH0sJHtjZWxsSW5kZXh9YDtcbiAgICAgICAgY2VsbC5kYXRhc2V0LmJvYXJkID0gcGxheWVyQm9hcmQudHlwZTtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnggPSByb3dJbmRleDtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnkgPSBjZWxsSW5kZXg7XG4gICAgICAgIGlmIChpdGVtICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNoaXBDZWxsXCIpO1xuXG4gICAgICAgICAgaWYgKGl0ZW0uaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICAgIC8vIGFkanVzdCB0aGlzLiBNYXliZSBtYWtlIGl0IGEgcGxheVJvdW5kIHRoaW5nIHRvIGtpY2sgb2ZmIGEgcm91bmQgYW5kIGVuZCBpdCB3aXRoIGEgdHVybiBzd2l0Y2guXG4gICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBpZiAoY2VsbC50ZXh0Q29udGVudCA9PT0gXCJcIikgZ2FtZS5tb3ZlRXZlbnQoY2VsbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICAgIH0pO1xuXG4gICAgICBib2FyZC5hcHBlbmRDaGlsZChyb3dEaXYpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmQubWlzc2VzLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBhdHRlbXB0KGNvb3JkaW5hdGVzLCBwbGF5ZXJCb2FyZCk7XG4gICAgfSk7XG4gICAgcGxheWVyQm9hcmQuaGl0cy5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgYXR0ZW1wdChjb29yZGluYXRlcywgcGxheWVyQm9hcmQpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGF0dGVtcHQgPSAoY29vcmRpbmF0ZXMsIGdhbWVib2FyZCkgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuICAgIGNvbnN0IHRhcmdldENlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtnYW1lYm9hcmQudHlwZX0gLSAke3h9LCR7eX1gKTtcbiAgICBjb25zdCBpc1NoaXAgPSBnYW1lYm9hcmQuaXNTaGlwKGNvb3JkaW5hdGVzKTtcblxuICAgIGlmIChpc1NoaXApIHtcbiAgICAgIHRhcmdldENlbGwuaW5uZXJIVE1MID0gXCJIaXRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFyZ2V0Q2VsbC5pbm5lckhUTUwgPSBcIk1pc3NcIjtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgc3RvcENsaWNrcyA9ICgpID0+IHtcbiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdmVybGF5XCIpO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJhbGxcIjtcbiAgfTtcblxuICBjb25zdCBzdGFydENsaWNrcyA9ICgpID0+IHtcbiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdmVybGF5XCIpO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gIH07XG5cbiAgY29uc3Qgc3R5bGVTdW5rID0gKGJvYXJkVHlwZSkgPT4ge1xuICAgIGNvbnN0IHJvd3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJvd0RpdlwiKTtcbiAgICByb3dzLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgY29uc3QgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJvYXJkQ2VsbFwiKTtcbiAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY29uc3QgW3gsIHldID0gW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV07XG5cbiAgICAgICAgaWYgKGJvYXJkVHlwZSA9PT0gXCJVc2VyXCIpIHtcbiAgICAgICAgICBpZiAoZ2FtZS51c2VyUGxheWVyLmJvYXJkLmlzU2hpcChbeCwgeV0pKSB7XG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZ2FtZS51c2VyUGxheWVyLmJvYXJkLmdldFNoaXAoW3gsIHldKTtcbiAgICAgICAgICAgIGlmIChzaGlwLmlzU3VuaygpKSBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLmlzU2hpcChbeCwgeV0pKSB7XG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5nZXRTaGlwKFt4LCB5XSk7XG4gICAgICAgICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgdG9nZ2xlVHVybkJ0biA9ICgpID0+IHtcbiAgICBjb25zdCBzd2l0Y2hUdXJuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hUdXJuQnRuXCIpO1xuICAgIHN3aXRjaFR1cm5CdG4uZGlzYWJsZWQgPSAhc3dpdGNoVHVybkJ0bi5kaXNhYmxlZDtcbiAgfTtcblxuICAvLyBDaG9vc2UgU2hpcCBMb2NhdGlvbnNcblxuICBjb25zdCBnZW5lcmF0ZUdyaWQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdENlbGxcIik7XG4gICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcblxuICAgICAgICBjZWxsLmRhdGFzZXQueCA9IGk7XG4gICAgICAgIGNlbGwuZGF0YXNldC55ID0gajtcblxuICAgICAgICBjZWxsLm9ubW91c2VlbnRlciA9IChlKSA9PiB7XG4gICAgICAgICAgZS50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ5ZWxsb3dcIjtcbiAgICAgICAgICBjb25zdCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSArIDEsIGpdKTtcbiAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgICAgIH07XG4gICAgICAgIGNlbGwub25tb3VzZW91dCA9IChlKSA9PiB7XG4gICAgICAgICAgZS50YXJnZXQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJcIjtcbiAgICAgICAgICBjb25zdCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSArIDEsIGpdKTtcbiAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiXCI7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHN0YXJ0U2NyZWVuLmFwcGVuZENoaWxkKHJvd0Rpdik7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdldFNlbGVjdENlbGwgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIGNvbnN0IHNlbGVjdENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zZWxlY3RDZWxsXCIpO1xuICAgIGZvciAoY29uc3Qgc2VsZWN0Q2VsbCBvZiBzZWxlY3RDZWxscykge1xuICAgICAgaWYgKFxuICAgICAgICBwYXJzZUludChzZWxlY3RDZWxsLmRhdGFzZXQueCkgPT09IHggJiZcbiAgICAgICAgcGFyc2VJbnQoc2VsZWN0Q2VsbC5kYXRhc2V0LnkpID09PSB5XG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHNlbGVjdENlbGw7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyQm9hcmQsXG4gICAgYXR0ZW1wdCxcbiAgICBzdG9wQ2xpY2tzLFxuICAgIHN0YXJ0Q2xpY2tzLFxuICAgIHN0eWxlU3VuayxcbiAgICByZW5kZXJTdGFydCxcbiAgICB0b2dnbGVUdXJuQnRuLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgVUk7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL0dhbWVib2FyZFwiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcFwiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi9QbGF5ZXJcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9VSVwiO1xuXG5jb25zdCBnYW1lID0gKCgpID0+IHtcbiAgY29uc3QgY29tcHV0ZXJQbGF5ZXIgPSBQbGF5ZXIoXCJDb21wdXRlclwiKTtcbiAgY29uc3QgdXNlclBsYXllciA9IFBsYXllcihcIlVzZXJcIik7XG5cbiAgbGV0IGN1cnJlbnRQbGF5ZXIgPSB1c2VyUGxheWVyO1xuXG4gIGNvbnN0IGluaXRHYW1lID0gKCkgPT4ge1xuICAgIGNvbnN0IHVzZXJCb2FyZCA9IHVzZXJQbGF5ZXIuYm9hcmQ7XG4gICAgY29uc3QgY29tcHV0ZXJCb2FyZCA9IGNvbXB1dGVyUGxheWVyLmJvYXJkO1xuICAgIGNvbXB1dGVyQm9hcmQuaW5pdEJvYXJkKCk7XG4gICAgdXNlckJvYXJkLmluaXRCb2FyZCgpO1xuICB9O1xuXG4gIGNvbnN0IHN3aXRjaFR1cm4gPSAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJzdGFydCBzd2l0Y2hcIiwgZ2FtZS5jdXJyZW50UGxheWVyLnR5cGUpO1xuICAgIGlmIChnYW1lLmN1cnJlbnRQbGF5ZXIgPT09IHVzZXJQbGF5ZXIpIHtcbiAgICAgIGdhbWUuY3VycmVudFBsYXllciA9IGNvbXB1dGVyUGxheWVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBnYW1lLmN1cnJlbnRQbGF5ZXIgPSB1c2VyUGxheWVyO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwiZW5kIHN3aXRjaFwiLCBnYW1lLmN1cnJlbnRQbGF5ZXIudHlwZSk7XG4gIH07XG5cbiAgY29uc3QgY2hlY2tMb3NzID0gKHBsYXllcikgPT4ge1xuICAgIGNvbnN0IGFsbFN1bmsgPSBwbGF5ZXIuYm9hcmQuc2hpcHMuZXZlcnkoKHNoaXApID0+IHtcbiAgICAgIHJldHVybiBzaGlwLmlzU3VuaygpO1xuICAgIH0pO1xuXG4gICAgaWYgKGFsbFN1bmspIGFsZXJ0KFwid2luXCIpO1xuICB9O1xuXG4gIGNvbnN0IG1vdmVFdmVudCA9IChjZWxsKSA9PiB7XG4gICAgVUkuc3RvcENsaWNrcygpO1xuICAgIGNvbnN0IGNlbGxCb2FyZCA9XG4gICAgICBjZWxsLmRhdGFzZXQuYm9hcmQgPT09IFwiQ29tcHV0ZXJcIlxuICAgICAgICA/IGNvbXB1dGVyUGxheWVyLmJvYXJkXG4gICAgICAgIDogdXNlclBsYXllci5ib2FyZDtcblxuICAgIGNlbGxCb2FyZC5yZWNlaXZlQXR0YWNrKFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldKTtcbiAgICBVSS5hdHRlbXB0KFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldLCBjZWxsQm9hcmQpO1xuICAgIFVJLnN0eWxlU3VuayhjZWxsQm9hcmQudHlwZSk7XG4gICAgY2hlY2tMb3NzKGN1cnJlbnRQbGF5ZXIpO1xuICAgIGdhbWUuc3dpdGNoVHVybigpO1xuICAgIFVJLnRvZ2dsZVR1cm5CdG4oKTtcbiAgfTtcblxuICBjb25zdCBjb21wdXRlck1vdmVFdmVudCA9IGFzeW5jICgpID0+IHtcbiAgICBVSS5zdG9wQ2xpY2tzKCk7XG5cbiAgICBjb25zdCBkZWxheSA9IChtaWxsaXNlY29uZHMpID0+IHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KHJlc29sdmUsIG1pbGxpc2Vjb25kcyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgYXdhaXQgZGVsYXkoNzUwKTtcblxuICAgIGNvbnNvbGUubG9nKFwiYWZ0ZXIgMSBzZWNcIik7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBnYW1lLmNvbXB1dGVyUGxheWVyLmdlbmVyYXRlTW92ZSgpO1xuXG4gICAgY29uc3QgY2VsbEJvYXJkID0gZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZDtcbiAgICBjZWxsQm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlcyk7XG4gICAgVUkuYXR0ZW1wdChjb29yZGluYXRlcywgY2VsbEJvYXJkKTtcbiAgICBVSS5zdHlsZVN1bmsoY2VsbEJvYXJkLnR5cGUpO1xuICAgIGdhbWUuY2hlY2tMb3NzKGdhbWUuY3VycmVudFBsYXllcik7XG4gICAgZ2FtZS5zd2l0Y2hUdXJuKCk7XG4gICAgVUkudG9nZ2xlVHVybkJ0bigpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdEdhbWUsXG4gICAgc3dpdGNoVHVybixcbiAgICBjb21wdXRlclBsYXllcixcbiAgICB1c2VyUGxheWVyLFxuICAgIGN1cnJlbnRQbGF5ZXIsXG4gICAgY2hlY2tMb3NzLFxuICAgIG1vdmVFdmVudCxcbiAgICBjb21wdXRlck1vdmVFdmVudCxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWU7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL21vZHVsZXMvR2FtZWJvYXJkLmpzXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9tb2R1bGVzL1NoaXAuanNcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL21vZHVsZXMvZ2FtZS5qc1wiO1xuaW1wb3J0IFVJIGZyb20gXCIuL21vZHVsZXMvVUkuanNcIjtcblxuZ2FtZS5pbml0R2FtZSgpO1xuY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcblVJLnJlbmRlckJvYXJkKGdhbWUuY3VycmVudFBsYXllci5ib2FyZCk7XG5VSS5yZW5kZXJTdGFydCgpO1xuXG5zd2l0Y2hUdXJuQnRuLm9uY2xpY2sgPSAoKSA9PiB7XG4gIFVJLnRvZ2dsZVR1cm5CdG4oKTtcblxuICBVSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xuXG4gIGlmIChnYW1lLmN1cnJlbnRQbGF5ZXIgPT09IGdhbWUuY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICBnYW1lLmNvbXB1dGVyTW92ZUV2ZW50KCk7XG4gIH0gZWxzZSB7XG4gICAgVUkuc3RhcnRDbGlja3MoKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6WyJwYXRoIiwiaGl0cyIsImdldExlbmd0aCIsImNvdW50IiwiZm9yRWFjaCIsImVsZW1lbnQiLCJpc1N1bmsiLCJoaXQiLCJnZXRIaXRzIiwiZ2V0UGF0aCIsInJlc2V0SGl0cyIsInR5cGUiLCJib2FyZEFycmF5IiwiQXJyYXkiLCJtYXAiLCJlIiwiZmlsbCIsIm1pc3NlcyIsInNoaXBzIiwicGxhY2VTaGlwIiwic2hpcE9iamVjdCIsImNvb3JkaW5hdGVzIiwieCIsInkiLCJhZGRTaGlwIiwic2hpcCIsInB1c2giLCJyZWNlaXZlQXR0YWNrIiwiYWxyZWFkeUhpdCIsImFscmVhZHlNaXNzIiwic29tZSIsIml0ZW0iLCJ4SXRlbSIsInlJdGVtIiwicmVzZXRHYW1lYm9hcmQiLCJpbml0Qm9hcmQiLCJpc1NoaXAiLCJnZXRTaGlwIiwiYXR0ZW1wdHMiLCJhdHRlbXB0IiwiYm9hcmQiLCJnZW5lcmF0ZU1vdmUiLCJnZXRSYW5kb21JbnQiLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjaGVja0F0dGVtcHRlZCIsImNvb3JkaW5hdGUiLCJtb3ZlIiwiVUkiLCJnYW1lYm9hcmQiLCJ0YXJnZXRDZWxsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImdldFNlbGVjdENlbGwiLCJzZWxlY3RDZWxscyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzZWxlY3RDZWxsIiwicGFyc2VJbnQiLCJkYXRhc2V0IiwicmVuZGVyQm9hcmQiLCJwbGF5ZXJCb2FyZCIsInBsYXllclRpdGxlIiwiY3JlYXRlRWxlbWVudCIsImNvbnNvbGUiLCJsb2ciLCJhcHBlbmRDaGlsZCIsInJvdyIsInJvd0luZGV4Iiwicm93RGl2IiwiY2xhc3NMaXN0IiwiYWRkIiwiY2VsbEluZGV4IiwiY2VsbCIsImlkIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcFByb3BhZ2F0aW9uIiwidGV4dENvbnRlbnQiLCJtb3ZlRXZlbnQiLCJzdG9wQ2xpY2tzIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q2xpY2tzIiwic3R5bGVTdW5rIiwiYm9hcmRUeXBlIiwidXNlclBsYXllciIsImNvbXB1dGVyUGxheWVyIiwicmVuZGVyU3RhcnQiLCJzdGFydFNjcmVlbiIsImRpc3BsYXkiLCJzdGFydEJ1dHRvbiIsImkiLCJqIiwib25tb3VzZWVudGVyIiwidGFyZ2V0IiwibmV3Q2VsbCIsInVuZGVmaW5lZCIsIm9ubW91c2VvdXQiLCJnZW5lcmF0ZUdyaWQiLCJvbmNsaWNrIiwidG9nZ2xlVHVybkJ0biIsInN3aXRjaFR1cm5CdG4iLCJkaXNhYmxlZCIsImdhbWUiLCJjdXJyZW50UGxheWVyIiwiY2hlY2tMb3NzIiwicGxheWVyIiwiZXZlcnkiLCJhbGVydCIsImluaXRHYW1lIiwidXNlckJvYXJkIiwic3dpdGNoVHVybiIsImNlbGxCb2FyZCIsImNvbXB1dGVyTW92ZUV2ZW50IiwiYXN5bmMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiXSwic291cmNlUm9vdCI6IiJ9