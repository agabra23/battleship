(()=>{"use strict";const e=function(e){let t=0;const o=()=>{let t=0;return e.forEach((e=>{t++})),t};return{getLength:o,isSunk:()=>t>=o(),hit:()=>{t++},getHits:()=>t,getPath:()=>e,resetHits:()=>{t=0},hits:t}},t=e=>{const t=[],o=function(e){const t=[...Array(10)].map((e=>Array(10).fill("none"))),o=[],r=[];let n=[];const a=e=>{n.push(e)};return{placeShip:e=>{e.getPath().forEach((o=>{const[r,n]=o;t[r][n]=e})),a(e)},boardArray:t,receiveAttack:e=>{const[n,a]=e;let s,l=!1;s=o.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),l=r.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),"none"!==t[n][a]&&!1===s?(t[n][a].hit(),o.push(e)):"none"===t[n][a]&&!1===l&&r.push(e)},hits:o,misses:r,addShip:a,resetGameboard:()=>{o=[],r=[],n=[]},isShip:e=>{const[o,r]=e;return"none"!==t[o][r]},getShip:e=>{const[o,r]=e;return t[o][r]},ships:n,type:e}}(e),r=e=>{t.push(e)};return{attempt:r,board:o,type:e,generateMove:()=>{const e=e=>Math.floor(Math.random()*e),o=e=>t.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]}));let n=[e(9),e(9)];for(;o(n);)n=[e(9),e(9)];return r(n),n},generateRandomPath:e=>{const t=Math.random()<.5;let o,r;t?(o=Math.floor(Math.random()*(10-e+1)),r=Math.floor(10*Math.random())):(o=Math.floor(10*Math.random()),r=Math.floor(Math.random()*(10-e+1)));const n=[];for(let a=0;a<e;a++)t?n.push([o+a,r]):n.push([o,r+a]);return n}}},o=(()=>{const t=(e,t)=>{const[o,r]=e,n=document.getElementById(`${t.type} - ${o},${r}`),a=t.isShip(e);n.innerHTML=a?"Hit":"Miss"};let o=!0;const r=[2,3,4,5];let n=5;const s=()=>{const e=document.getElementById("chooseShip");r.find((e=>e===n-1))?(n--,e.textContent=`Choose ${n} Coordinates`):(document.querySelectorAll(".selectCell").forEach((e=>{e.style.pointerEvents="none"})),e.textContent='Click "Start Game" to Begin.')},l=e=>{const[t,o]=e,r=document.querySelectorAll(".selectCell");for(const e of r)if(parseInt(e.dataset.x)===t&&parseInt(e.dataset.y)===o)return e},d=()=>{o=!o};return{renderBoard:e=>{const o=document.getElementById("board");o.innerHTML='<div id="overlay"></div>';const r=document.createElement("h3");console.log(e),r.innerHTML=`${e.type}'s Turn`,o.appendChild(r),e.boardArray.forEach(((t,r)=>{const n=document.createElement("div");n.classList.add("rowDiv"),t.forEach(((t,o)=>{const s=document.createElement("div");s.classList.add("boardCell"),s.id=`${e.type} - ${r},${o}`,s.dataset.board=e.type,s.dataset.x=r,s.dataset.y=o,e===a.computerPlayer.board&&"none"!==t&&s.classList.add("selected"),"none"!==t&&(s.classList.add("shipCell"),t.isSunk()&&(s.style.backgroundColor="red")),s.addEventListener("click",(e=>{e.stopPropagation(),""===s.textContent&&a.moveEvent(s)})),n.appendChild(s)})),o.appendChild(n)})),e.misses.forEach((o=>{t(o,e)})),e.hits.forEach((o=>{t(o,e)}))},attempt:t,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"},styleSunk:e=>{document.querySelectorAll(".rowDiv").forEach((t=>{document.querySelectorAll(".boardCell").forEach((t=>{const[o,r]=[t.dataset.x,t.dataset.y];"User"===e?a.userPlayer.board.isShip([o,r])&&a.userPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red"):a.computerPlayer.board.isShip([o,r])&&a.computerPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red")}))}))},renderStart:()=>{document.getElementById("startScreen").style.display="flex",document.getElementById("board").style.display="none",document.getElementById("switchTurnBtn").style.display="none",(()=>{const t=document.getElementById("startScreen");t.style.display="flex";const r=document.createElement("button");r.textContent="Flip Ship Direction",r.id="flipBtn";const c=document.createElement("button");c.id="startBtn",c.textContent="Start Game";const i=document.createElement("h3");i.textContent=`Choose ${n} Coordinates`,i.id="chooseShip";for(let u=0;u<10;u++){const p=document.createElement("div");p.classList.add("rowDiv");for(let t=0;t<10;t++){const r=document.createElement("div");r.classList.add("selectCell"),p.appendChild(r),r.dataset.x=u,r.dataset.y=t;let d=!1;const c=e=>void 0===e||a.computerPlayer.board.isShip([e.dataset.x,e.dataset.y]);r.onmouseenter=e=>{r.style.backgroundColor="yellow",c(r)&&void 0!==r&&(r.style.backgroundColor="black",d=!0);for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="yellow"),c(r)&&void 0!==r?(r.style.backgroundColor="black",d=!0):void 0===r&&(d=!0)}},r.onmouseout=e=>{d=!1,r.style.backgroundColor="";for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="")}},r.onclick=c=>{if(!d){let d=[[parseInt(r.dataset.x),parseInt(r.dataset.y)]];void 0!==r&&r.classList.add("selected");for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.classList.add("selected"),d.push([parseInt(r.dataset.x),parseInt(r.dataset.y)]))}a.computerPlayer.board.placeShip(e(d)),console.log("placed"),s()}}}t.appendChild(p),t.appendChild(i),t.appendChild(r),t.appendChild(c),c.onclick=()=>{t.style.display="",document.getElementById("board").style.display="",document.getElementById("switchTurnBtn").style.display="",c.style.display="none"},r.onclick=d}})()},toggleTurnBtn:()=>{const e=document.getElementById("switchTurnBtn");e.disabled=!e.disabled}}})(),r=o,n=(()=>{const o=t("Computer"),a=t("User");let s=a;const l=e=>{e.board.ships.length>0&&e.board.ships.every((e=>e.isSunk()))&&alert(`${s.type} wins`)};return{initGame:()=>{a.board,o.board},switchTurn:()=>{console.log("start switch",n.currentPlayer.type),n.currentPlayer===a?n.currentPlayer=o:n.currentPlayer=a,console.log("end switch",n.currentPlayer.type)},computerPlayer:o,userPlayer:a,currentPlayer:s,checkLoss:l,moveEvent:e=>{r.stopClicks();const t="Computer"===e.dataset.board?o.board:a.board;t.receiveAttack([e.dataset.x,e.dataset.y]),r.attempt([e.dataset.x,e.dataset.y],t),r.styleSunk(t.type),l(s),n.switchTurn(),r.toggleTurnBtn()},computerMoveEvent:async()=>{r.stopClicks(),await(750,new Promise((e=>{setTimeout(e,750)}))),console.log("after 1 sec");const e=n.computerPlayer.generateMove(),t=n.computerPlayer.board;t.receiveAttack(e),r.attempt(e,t),r.styleSunk(t.type),n.checkLoss(n.currentPlayer),n.switchTurn(),r.toggleTurnBtn()},setComputerShips:()=>{n.userPlayer.board.placeShip(e(o.generateRandomPath(2))),n.userPlayer.board.placeShip(e(o.generateRandomPath(3))),n.userPlayer.board.placeShip(e(o.generateRandomPath(4))),n.userPlayer.board.placeShip(e(o.generateRandomPath(5)))}}})(),a=n;a.initGame();const s=document.getElementById("switchTurnBtn");r.renderBoard(a.currentPlayer.board),r.renderStart(),a.setComputerShips(),s.onclick=()=>{r.toggleTurnBtn(),r.renderBoard(a.currentPlayer.board),a.currentPlayer===a.computerPlayer?a.computerMoveEvent():r.startClicks()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Qlksa0JBdEN3QkMsVUFDeEIsRUFBR25DLG1CQVFTLElBTEgsSUFBSW9DLFNBQVNDLElBQ2xCQyxXQUFXRCxFQUlILElBSnlCLEtBTXJDcEQsUUFBUUMsSUFBSSxlQUNaLE1BQU14RCxFQUFjK0YsRUFBSzlCLGVBQWVuRCxlQUVsQ3lGLEVBQVlSLEVBQUs5QixlQUFlOUUsTUFDdENvSCxFQUFVcEcsY0FBY0gsR0FDeEIsRUFBR2EsUUFBUWIsRUFBYXVHLEdBQ3hCLEVBQUcvQixVQUFVK0IsRUFBVXRILE1BQ3ZCOEcsRUFBS0UsVUFBVUYsRUFBS0MsZUFDcEJELEVBQUtPLGFBQ0wsRUFBR1YsZUFBZSxFQW1CbEJpQixpQkFoQnVCLEtBQ3ZCZCxFQUFLckIsV0FBV3ZGLE1BQU1XLFVBQVUsRUFBS21FLEVBQWUxQyxtQkFBbUIsS0FDdkV3RSxFQUFLckIsV0FBV3ZGLE1BQU1XLFVBQVUsRUFBS21FLEVBQWUxQyxtQkFBbUIsS0FDdkV3RSxFQUFLckIsV0FBV3ZGLE1BQU1XLFVBQVUsRUFBS21FLEVBQWUxQyxtQkFBbUIsS0FDdkV3RSxFQUFLckIsV0FBV3ZGLE1BQU1XLFVBQVUsRUFBS21FLEVBQWUxQyxtQkFBbUIsSUFBSSxFQWM5RSxFQTFGWSxHQTRGYixJQzVGQSxFQUFLOEUsV0FDTCxNQUFNUixFQUFnQi9ELFNBQVNDLGVBQWUsaUJBQzlDLEVBQUdvQixZQUFZLEVBQUs2QyxjQUFjN0csT0FDbEMsRUFBR3dGLGNBQ0gsRUFBS2tDLG1CQUVMaEIsRUFBY0osUUFBVSxLQUN0QixFQUFHRyxnQkFFSCxFQUFHekMsWUFBWSxFQUFLNkMsY0FBYzdHLE9BRTlCLEVBQUs2RyxnQkFBa0IsRUFBSy9CLGVBQzlCLEVBQUt1QyxvQkFFTCxFQUFHakMsYUFDTCxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvR2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9VSS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSBmdW5jdGlvbiAocGF0aCkge1xuICBsZXQgaGl0cyA9IDA7XG5cbiAgY29uc3QgZ2V0SGl0cyA9ICgpID0+IHtcbiAgICByZXR1cm4gaGl0cztcbiAgfTtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgaGl0cysrO1xuICB9O1xuXG4gIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHtcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIHBhdGguZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgY291bnQrKztcbiAgICB9KTtcbiAgICByZXR1cm4gY291bnQ7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4ge1xuICAgIHJldHVybiBoaXRzID49IGdldExlbmd0aCgpO1xuICB9O1xuXG4gIGNvbnN0IGdldFBhdGggPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBhdGg7XG4gIH07XG5cbiAgY29uc3QgcmVzZXRIaXRzID0gKCkgPT4ge1xuICAgIGhpdHMgPSAwO1xuICB9O1xuXG4gIHJldHVybiB7IGdldExlbmd0aCwgaXNTdW5rLCBoaXQsIGdldEhpdHMsIGdldFBhdGgsIHJlc2V0SGl0cywgaGl0cyB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IFNoaXA7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL0dhbWVib2FyZFwiO1xuXG5jb25zdCBQbGF5ZXIgPSAodHlwZSkgPT4ge1xuICBjb25zdCBhdHRlbXB0cyA9IFtdO1xuICBjb25zdCB0dXJuID0gZmFsc2U7XG4gIGNvbnN0IGJvYXJkID0gR2FtZWJvYXJkKHR5cGUpO1xuXG4gIGNvbnN0IGF0dGVtcHQgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBhdHRlbXB0cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgfTtcblxuICBjb25zdCBnZW5lcmF0ZU1vdmUgPSAoKSA9PiB7XG4gICAgY29uc3QgZ2V0UmFuZG9tSW50ID0gKG1heCkgPT4ge1xuICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heCk7XG4gICAgfTtcblxuICAgIGNvbnN0IGNoZWNrQXR0ZW1wdGVkID0gKGF0dGVtcHQpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF0dGVtcHRzLnNvbWUoKGNvb3JkaW5hdGUpID0+IHtcbiAgICAgICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZTtcblxuICAgICAgICByZXR1cm4geCA9PT0gYXR0ZW1wdFswXSAmJiB5ID09PSBhdHRlbXB0WzFdO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIGxldCBtb3ZlID0gW2dldFJhbmRvbUludCg5KSwgZ2V0UmFuZG9tSW50KDkpXTtcblxuICAgIHdoaWxlIChjaGVja0F0dGVtcHRlZChtb3ZlKSkge1xuICAgICAgbW92ZSA9IFtnZXRSYW5kb21JbnQoOSksIGdldFJhbmRvbUludCg5KV07XG4gICAgfVxuXG4gICAgYXR0ZW1wdChtb3ZlKTtcblxuICAgIHJldHVybiBtb3ZlO1xuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlUmFuZG9tUGF0aCA9IChzaGlwTGVuZ3RoKSA9PiB7XG4gICAgY29uc3QgaG9yaXpvbnRhbCA9IE1hdGgucmFuZG9tKCkgPCAwLjU7IC8vIFJhbmRvbWx5IGNob29zZSBob3Jpem9udGFsIG9yIHZlcnRpY2FsIHBsYWNlbWVudFxuICAgIGxldCB4LCB5O1xuXG4gICAgaWYgKGhvcml6b250YWwpIHtcbiAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAgLSBzaGlwTGVuZ3RoICsgMSkpO1xuICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAgLSBzaGlwTGVuZ3RoICsgMSkpO1xuICAgIH1cblxuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChob3Jpem9udGFsKSB7XG4gICAgICAgIGNvb3JkaW5hdGVzLnB1c2goW3ggKyBpLCB5XSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb29yZGluYXRlcy5wdXNoKFt4LCB5ICsgaV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb29yZGluYXRlcztcbiAgfTtcblxuICByZXR1cm4geyBhdHRlbXB0LCBib2FyZCwgdHlwZSwgZ2VuZXJhdGVNb3ZlLCBnZW5lcmF0ZVJhbmRvbVBhdGggfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFBsYXllcjtcbiIsImltcG9ydCBTaGlwIGZyb20gXCIuL1NoaXAuanNcIjtcblxuY29uc3QgR2FtZWJvYXJkID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgY29uc3QgYm9hcmRBcnJheSA9IFsuLi5BcnJheSgxMCldLm1hcCgoZSkgPT4gQXJyYXkoMTApLmZpbGwoXCJub25lXCIpKTtcbiAgY29uc3QgaGl0cyA9IFtdO1xuICBjb25zdCBtaXNzZXMgPSBbXTtcbiAgbGV0IHNoaXBzID0gW107XG5cbiAgLy8gY29uc3QgaW5pdEJvYXJkID0gKCkgPT4ge1xuICAvLyAgIHBsYWNlU2hpcChcbiAgLy8gICAgIFNoaXAoW1xuICAvLyAgICAgICBbMSwgNF0sXG4gIC8vICAgICAgIFsxLCA1XSxcbiAgLy8gICAgIF0pXG4gIC8vICAgKTtcbiAgLy8gICBwbGFjZVNoaXAoXG4gIC8vICAgICBTaGlwKFtcbiAgLy8gICAgICAgWzYsIDRdLFxuICAvLyAgICAgICBbNiwgNV0sXG4gIC8vICAgICAgIFs2LCA2XSxcbiAgLy8gICAgIF0pXG4gIC8vICAgKTtcbiAgLy8gICBwbGFjZVNoaXAoXG4gIC8vICAgICBTaGlwKFtcbiAgLy8gICAgICAgWzQsIDJdLFxuICAvLyAgICAgICBbNSwgMl0sXG4gIC8vICAgICAgIFs2LCAyXSxcbiAgLy8gICAgICAgWzcsIDJdLFxuICAvLyAgICAgXSlcbiAgLy8gICApO1xuXG4gIC8vICAgcGxhY2VTaGlwKFxuICAvLyAgICAgU2hpcChbXG4gIC8vICAgICAgIFs4LCAzXSxcbiAgLy8gICAgICAgWzgsIDRdLFxuICAvLyAgICAgICBbOCwgNV0sXG4gIC8vICAgICAgIFs4LCA2XSxcbiAgLy8gICAgICAgWzgsIDddLFxuICAvLyAgICAgXSlcbiAgLy8gICApO1xuICAvLyB9O1xuXG4gIGNvbnN0IHJlc2V0R2FtZWJvYXJkID0gKCkgPT4ge1xuICAgIGhpdHMgPSBbXTtcbiAgICBtaXNzZXMgPSBbXTtcbiAgICBzaGlwcyA9IFtdO1xuICB9O1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwT2JqZWN0KSA9PiB7XG4gICAgY29uc3QgcGF0aCA9IHNoaXBPYmplY3QuZ2V0UGF0aCgpO1xuICAgIHBhdGguZm9yRWFjaCgoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuICAgICAgYm9hcmRBcnJheVt4XVt5XSA9IHNoaXBPYmplY3Q7XG4gICAgfSk7XG4gICAgYWRkU2hpcChzaGlwT2JqZWN0KTtcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICBsZXQgYWxyZWFkeUhpdCxcbiAgICAgIGFscmVhZHlNaXNzID0gZmFsc2U7XG5cbiAgICBhbHJlYWR5SGl0ID0gaGl0cy5zb21lKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBbeEl0ZW0sIHlJdGVtXSA9IGl0ZW07XG4gICAgICByZXR1cm4geEl0ZW0gPT09IGNvb3JkaW5hdGVzWzBdICYmIHlJdGVtID09PSBjb29yZGluYXRlc1sxXTtcbiAgICB9KTtcbiAgICBhbHJlYWR5TWlzcyA9IG1pc3Nlcy5zb21lKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBbeEl0ZW0sIHlJdGVtXSA9IGl0ZW07XG4gICAgICByZXR1cm4geEl0ZW0gPT09IGNvb3JkaW5hdGVzWzBdICYmIHlJdGVtID09PSBjb29yZGluYXRlc1sxXTtcbiAgICB9KTtcblxuICAgIGlmIChib2FyZEFycmF5W3hdW3ldICE9PSBcIm5vbmVcIiAmJiBhbHJlYWR5SGl0ID09PSBmYWxzZSkge1xuICAgICAgYm9hcmRBcnJheVt4XVt5XS5oaXQoKTtcbiAgICAgIGhpdHMucHVzaChjb29yZGluYXRlcyk7XG4gICAgfSBlbHNlIGlmIChib2FyZEFycmF5W3hdW3ldID09PSBcIm5vbmVcIiAmJiBhbHJlYWR5TWlzcyA9PT0gZmFsc2UpIHtcbiAgICAgIG1pc3Nlcy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYWRkU2hpcCA9IChzaGlwKSA9PiB7XG4gICAgc2hpcHMucHVzaChzaGlwKTtcbiAgfTtcblxuICBjb25zdCBpc1NoaXAgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIHJldHVybiBib2FyZEFycmF5W3hdW3ldICE9PSBcIm5vbmVcIjtcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICByZXR1cm4gYm9hcmRBcnJheVt4XVt5XTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHBsYWNlU2hpcCxcbiAgICBib2FyZEFycmF5LFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgaGl0cyxcbiAgICBtaXNzZXMsXG4gICAgYWRkU2hpcCxcbiAgICByZXNldEdhbWVib2FyZCxcbiAgICAvLyBpbml0Qm9hcmQsXG4gICAgaXNTaGlwLFxuICAgIGdldFNoaXAsXG4gICAgc2hpcHMsXG4gICAgdHlwZSxcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZDtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL1BsYXllclwiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcFwiO1xuaW1wb3J0IGdhbWUgZnJvbSBcIi4vZ2FtZVwiO1xuXG5jb25zdCBVSSA9ICgoKSA9PiB7XG4gIGNvbnN0IHJlbmRlclN0YXJ0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHN0YXJ0U2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGFydFNjcmVlblwiKTtcbiAgICBzdGFydFNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cbiAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XG4gICAgYm9hcmQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgY29uc3QgbmV4dFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgbmV4dFR1cm5CdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgZ2VuZXJhdGVHcmlkKCk7XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRFdmVudCA9IChlbGVtZW50KSA9PiB7XG4gICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblxuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcbiAgICBib2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblxuICAgIGNvbnN0IG5leHRUdXJuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hUdXJuQnRuXCIpO1xuICAgIG5leHRUdXJuQnRuLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlckJvYXJkID0gKHBsYXllckJvYXJkKSA9PiB7XG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLmlubmVySFRNTCA9IGA8ZGl2IGlkPVwib3ZlcmxheVwiPjwvZGl2PmA7XG5cbiAgICBjb25zdCBwbGF5ZXJUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoM1wiKTtcbiAgICBjb25zb2xlLmxvZyhwbGF5ZXJCb2FyZCk7XG4gICAgcGxheWVyVGl0bGUuaW5uZXJIVE1MID0gYCR7cGxheWVyQm9hcmQudHlwZX0ncyBUdXJuYDtcblxuICAgIGJvYXJkLmFwcGVuZENoaWxkKHBsYXllclRpdGxlKTtcblxuICAgIHBsYXllckJvYXJkLmJvYXJkQXJyYXkuZm9yRWFjaCgocm93LCByb3dJbmRleCkgPT4ge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICByb3cuZm9yRWFjaCgoaXRlbSwgY2VsbEluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJib2FyZENlbGxcIik7XG4gICAgICAgIGNlbGwuaWQgPSBgJHtwbGF5ZXJCb2FyZC50eXBlfSAtICR7cm93SW5kZXh9LCR7Y2VsbEluZGV4fWA7XG4gICAgICAgIGNlbGwuZGF0YXNldC5ib2FyZCA9IHBsYXllckJvYXJkLnR5cGU7XG4gICAgICAgIGNlbGwuZGF0YXNldC54ID0gcm93SW5kZXg7XG4gICAgICAgIGNlbGwuZGF0YXNldC55ID0gY2VsbEluZGV4O1xuXG4gICAgICAgIGlmIChwbGF5ZXJCb2FyZCA9PT0gZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZCAmJiBpdGVtICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGl0ZW0gIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwic2hpcENlbGxcIik7XG5cbiAgICAgICAgICBpZiAoaXRlbS5pc1N1bmsoKSkge1xuICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBpZiAoY2VsbC50ZXh0Q29udGVudCA9PT0gXCJcIikgZ2FtZS5tb3ZlRXZlbnQoY2VsbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICAgIH0pO1xuXG4gICAgICBib2FyZC5hcHBlbmRDaGlsZChyb3dEaXYpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmQubWlzc2VzLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBhdHRlbXB0KGNvb3JkaW5hdGVzLCBwbGF5ZXJCb2FyZCk7XG4gICAgfSk7XG4gICAgcGxheWVyQm9hcmQuaGl0cy5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgYXR0ZW1wdChjb29yZGluYXRlcywgcGxheWVyQm9hcmQpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGF0dGVtcHQgPSAoY29vcmRpbmF0ZXMsIGdhbWVib2FyZCkgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuICAgIGNvbnN0IHRhcmdldENlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtnYW1lYm9hcmQudHlwZX0gLSAke3h9LCR7eX1gKTtcbiAgICBjb25zdCBpc1NoaXAgPSBnYW1lYm9hcmQuaXNTaGlwKGNvb3JkaW5hdGVzKTtcblxuICAgIGlmIChpc1NoaXApIHtcbiAgICAgIHRhcmdldENlbGwuaW5uZXJIVE1MID0gXCJIaXRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFyZ2V0Q2VsbC5pbm5lckhUTUwgPSBcIk1pc3NcIjtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgc3RvcENsaWNrcyA9ICgpID0+IHtcbiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdmVybGF5XCIpO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJhbGxcIjtcbiAgfTtcblxuICBjb25zdCBzdGFydENsaWNrcyA9ICgpID0+IHtcbiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdmVybGF5XCIpO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gIH07XG5cbiAgY29uc3Qgc3R5bGVTdW5rID0gKGJvYXJkVHlwZSkgPT4ge1xuICAgIGNvbnN0IHJvd3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJvd0RpdlwiKTtcbiAgICByb3dzLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgY29uc3QgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJvYXJkQ2VsbFwiKTtcbiAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY29uc3QgW3gsIHldID0gW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV07XG5cbiAgICAgICAgaWYgKGJvYXJkVHlwZSA9PT0gXCJVc2VyXCIpIHtcbiAgICAgICAgICBpZiAoZ2FtZS51c2VyUGxheWVyLmJvYXJkLmlzU2hpcChbeCwgeV0pKSB7XG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZ2FtZS51c2VyUGxheWVyLmJvYXJkLmdldFNoaXAoW3gsIHldKTtcbiAgICAgICAgICAgIGlmIChzaGlwLmlzU3VuaygpKSBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLmlzU2hpcChbeCwgeV0pKSB7XG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5nZXRTaGlwKFt4LCB5XSk7XG4gICAgICAgICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgdG9nZ2xlVHVybkJ0biA9ICgpID0+IHtcbiAgICBjb25zdCBzd2l0Y2hUdXJuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hUdXJuQnRuXCIpO1xuICAgIHN3aXRjaFR1cm5CdG4uZGlzYWJsZWQgPSAhc3dpdGNoVHVybkJ0bi5kaXNhYmxlZDtcbiAgfTtcblxuICAvLyBDaG9vc2UgU2hpcCBMb2NhdGlvbnNcblxuICBsZXQgaXNWZXJ0aWNhbCA9IHRydWU7XG4gIGNvbnN0IHNoaXBMZW5ndGhzID0gWzIsIDMsIDQsIDVdO1xuICBsZXQgY3VycmVudFNoaXBMZW5ndGggPSA1O1xuXG4gIGNvbnN0IGdlbmVyYXRlR3JpZCA9ICgpID0+IHtcbiAgICBjb25zdCBzdGFydFNjcmVlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RhcnRTY3JlZW5cIik7XG4gICAgc3RhcnRTY3JlZW4uc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuXG4gICAgY29uc3QgZmxpcEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgZmxpcEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRmxpcCBTaGlwIERpcmVjdGlvblwiO1xuICAgIGZsaXBCdXR0b24uaWQgPSBcImZsaXBCdG5cIjtcblxuICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBzdGFydEJ1dHRvbi5pZCA9IFwic3RhcnRCdG5cIjtcbiAgICBzdGFydEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3RhcnQgR2FtZVwiO1xuXG4gICAgY29uc3QgY2hvb3NlU2hpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoM1wiKTtcbiAgICBjaG9vc2VTaGlwLnRleHRDb250ZW50ID0gYENob29zZSAke2N1cnJlbnRTaGlwTGVuZ3RofSBDb29yZGluYXRlc2A7XG4gICAgY2hvb3NlU2hpcC5pZCA9IFwiY2hvb3NlU2hpcFwiO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBjb25zdCByb3dEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcm93RGl2LmNsYXNzTGlzdC5hZGQoXCJyb3dEaXZcIik7XG5cbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwic2VsZWN0Q2VsbFwiKTtcbiAgICAgICAgcm93RGl2LmFwcGVuZENoaWxkKGNlbGwpO1xuXG4gICAgICAgIGNlbGwuZGF0YXNldC54ID0gaTtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnkgPSBqO1xuXG4gICAgICAgIC8vIGNvbnN0IGNvbmZsaWN0aW5nID0gKGNoZWNrQ2VsbCkgPT4ge1xuICAgICAgICAvLyAgIGZvciAoc2hpcCBvZiBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLnNoaXBzKSB7XG4gICAgICAgIC8vICAgICBmb3IgKGNvb3JkaW5hdGVzIG9mIHNoaXAucGF0aCkge1xuICAgICAgICAvLyAgICAgICBpZiAoXG4gICAgICAgIC8vICAgICAgICAgY29vcmRpbmF0ZXNbMF0gPT09IHBhcnNlSW50KGNoZWNrQ2VsbC5kYXRhc2V0LngpICYmXG4gICAgICAgIC8vICAgICAgICAgY29vcmRpbmF0ZXNbMV0gPT09IHBhcnNlSW50KGNoZWNrQ2VsbC5kYXRhc2V0LnkpXG4gICAgICAgIC8vICAgICAgICkge1xuICAgICAgICAvLyAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAvLyAgICAgICB9XG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vICAgfVxuICAgICAgICAvLyAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgLy8gfTtcblxuICAgICAgICBsZXQgaXNDb25mbGljdGVkID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgY29uZmxpY3RpbmcgPSAoY2hlY2tDZWxsKSA9PiB7XG4gICAgICAgICAgaWYgKGNoZWNrQ2VsbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5pc1NoaXAoW1xuICAgICAgICAgICAgICBjaGVja0NlbGwuZGF0YXNldC54LFxuICAgICAgICAgICAgICBjaGVja0NlbGwuZGF0YXNldC55LFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNlbGwub25tb3VzZWVudGVyID0gKGUpID0+IHtcbiAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgICAgICAgaWYgKGNvbmZsaWN0aW5nKGNlbGwpICYmIGNlbGwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImJsYWNrXCI7XG4gICAgICAgICAgICBpc0NvbmZsaWN0ZWQgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZvciAobGV0IGsgPSAxOyBrIDwgY3VycmVudFNoaXBMZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgbGV0IG5ld0NlbGwgPSBnZXRTZWxlY3RDZWxsKFtpLCBqICsga10pO1xuXG4gICAgICAgICAgICBpZiAoaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSArIGssIGpdKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG5ld0NlbGwgIT09IHVuZGVmaW5lZCkgbmV3Q2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInllbGxvd1wiO1xuICAgICAgICAgICAgaWYgKGNvbmZsaWN0aW5nKG5ld0NlbGwpICYmIG5ld0NlbGwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiYmxhY2tcIjtcbiAgICAgICAgICAgICAgaXNDb25mbGljdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3Q2VsbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGlzQ29uZmxpY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNlbGwub25tb3VzZW91dCA9IChlKSA9PiB7XG4gICAgICAgICAgaXNDb25mbGljdGVkID0gZmFsc2U7XG5cbiAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiXCI7XG5cbiAgICAgICAgICBmb3IgKGxldCBrID0gMTsgayA8IGN1cnJlbnRTaGlwTGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGxldCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSwgaiArIGtdKTtcblxuICAgICAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXdDZWxsICE9PSB1bmRlZmluZWQpIG5ld0NlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY2VsbC5vbmNsaWNrID0gKGUpID0+IHtcbiAgICAgICAgICBpZiAoIWlzQ29uZmxpY3RlZCkge1xuICAgICAgICAgICAgbGV0IHNoaXBDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICAgICAgW3BhcnNlSW50KGNlbGwuZGF0YXNldC54KSwgcGFyc2VJbnQoY2VsbC5kYXRhc2V0LnkpXSxcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGlmIChjZWxsICE9PSB1bmRlZmluZWQpIGNlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBrID0gMTsgayA8IGN1cnJlbnRTaGlwTGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgICAgbGV0IG5ld0NlbGwgPSBnZXRTZWxlY3RDZWxsKFtpLCBqICsga10pO1xuXG4gICAgICAgICAgICAgIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbmV3Q2VsbC5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgc2hpcENvb3JkaW5hdGVzLnB1c2goW1xuICAgICAgICAgICAgICAgICAgcGFyc2VJbnQobmV3Q2VsbC5kYXRhc2V0LngpLFxuICAgICAgICAgICAgICAgICAgcGFyc2VJbnQobmV3Q2VsbC5kYXRhc2V0LnkpLFxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG5ld0NlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChzaGlwQ29vcmRpbmF0ZXMpKTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJwbGFjZWRcIik7XG4gICAgICAgICAgICBuZXh0U2hpcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQocm93RGl2KTtcbiAgICAgIHN0YXJ0U2NyZWVuLmFwcGVuZENoaWxkKGNob29zZVNoaXApO1xuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQoZmxpcEJ1dHRvbik7XG4gICAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChzdGFydEJ1dHRvbik7XG5cbiAgICAgIHN0YXJ0QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHN0YXJ0RXZlbnQoc3RhcnRTY3JlZW4pO1xuICAgICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB9O1xuXG4gICAgICBmbGlwQnV0dG9uLm9uY2xpY2sgPSBmbGlwO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBuZXh0U2hpcCA9ICgpID0+IHtcbiAgICBjb25zdCBjaG9vc2VTaGlwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjaG9vc2VTaGlwXCIpO1xuXG4gICAgaWYgKFxuICAgICAgc2hpcExlbmd0aHMuZmluZCgobGVuZ3RoKSA9PiB7XG4gICAgICAgIHJldHVybiBsZW5ndGggPT09IGN1cnJlbnRTaGlwTGVuZ3RoIC0gMTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICBjdXJyZW50U2hpcExlbmd0aC0tO1xuICAgICAgY2hvb3NlU2hpcC50ZXh0Q29udGVudCA9IGBDaG9vc2UgJHtjdXJyZW50U2hpcExlbmd0aH0gQ29vcmRpbmF0ZXNgO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2VsZWN0Q2VsbFwiKTtcbiAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY2VsbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgICB9KTtcbiAgICAgIGNob29zZVNoaXAudGV4dENvbnRlbnQgPSBgQ2xpY2sgXCJTdGFydCBHYW1lXCIgdG8gQmVnaW4uYDtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0U2VsZWN0Q2VsbCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgY29uc3Qgc2VsZWN0Q2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNlbGVjdENlbGxcIik7XG4gICAgZm9yIChjb25zdCBzZWxlY3RDZWxsIG9mIHNlbGVjdENlbGxzKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHBhcnNlSW50KHNlbGVjdENlbGwuZGF0YXNldC54KSA9PT0geCAmJlxuICAgICAgICBwYXJzZUludChzZWxlY3RDZWxsLmRhdGFzZXQueSkgPT09IHlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gc2VsZWN0Q2VsbDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZmxpcCA9ICgpID0+IHtcbiAgICBpc1ZlcnRpY2FsID0gIWlzVmVydGljYWw7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJCb2FyZCxcbiAgICBhdHRlbXB0LFxuICAgIHN0b3BDbGlja3MsXG4gICAgc3RhcnRDbGlja3MsXG4gICAgc3R5bGVTdW5rLFxuICAgIHJlbmRlclN0YXJ0LFxuICAgIHRvZ2dsZVR1cm5CdG4sXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBVSTtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL1BsYXllclwiO1xuaW1wb3J0IFVJIGZyb20gXCIuL1VJXCI7XG5cbmNvbnN0IGdhbWUgPSAoKCkgPT4ge1xuICBjb25zdCBjb21wdXRlclBsYXllciA9IFBsYXllcihcIkNvbXB1dGVyXCIpO1xuICBjb25zdCB1c2VyUGxheWVyID0gUGxheWVyKFwiVXNlclwiKTtcblxuICBsZXQgY3VycmVudFBsYXllciA9IHVzZXJQbGF5ZXI7XG5cbiAgY29uc3QgaW5pdEdhbWUgPSAoKSA9PiB7XG4gICAgY29uc3QgdXNlckJvYXJkID0gdXNlclBsYXllci5ib2FyZDtcbiAgICBjb25zdCBjb21wdXRlckJvYXJkID0gY29tcHV0ZXJQbGF5ZXIuYm9hcmQ7XG4gICAgLy8gY29tcHV0ZXJCb2FyZC5pbml0Qm9hcmQoKTtcbiAgICAvLyB1c2VyQm9hcmQuaW5pdEJvYXJkKCk7XG4gIH07XG5cbiAgY29uc3Qgc3dpdGNoVHVybiA9ICgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcInN0YXJ0IHN3aXRjaFwiLCBnYW1lLmN1cnJlbnRQbGF5ZXIudHlwZSk7XG4gICAgaWYgKGdhbWUuY3VycmVudFBsYXllciA9PT0gdXNlclBsYXllcikge1xuICAgICAgZ2FtZS5jdXJyZW50UGxheWVyID0gY29tcHV0ZXJQbGF5ZXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdhbWUuY3VycmVudFBsYXllciA9IHVzZXJQbGF5ZXI7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCJlbmQgc3dpdGNoXCIsIGdhbWUuY3VycmVudFBsYXllci50eXBlKTtcbiAgfTtcblxuICBjb25zdCBjaGVja0xvc3MgPSAocGxheWVyKSA9PiB7XG4gICAgY29uc3QgYWxsU3VuayA9XG4gICAgICBwbGF5ZXIuYm9hcmQuc2hpcHMubGVuZ3RoID4gMCAmJlxuICAgICAgcGxheWVyLmJvYXJkLnNoaXBzLmV2ZXJ5KChzaGlwKSA9PiB7XG4gICAgICAgIHJldHVybiBzaGlwLmlzU3VuaygpO1xuICAgICAgfSk7XG5cbiAgICBpZiAoYWxsU3VuaykgYWxlcnQoYCR7Y3VycmVudFBsYXllci50eXBlfSB3aW5zYCk7XG4gIH07XG5cbiAgY29uc3QgbW92ZUV2ZW50ID0gKGNlbGwpID0+IHtcbiAgICBVSS5zdG9wQ2xpY2tzKCk7XG4gICAgY29uc3QgY2VsbEJvYXJkID1cbiAgICAgIGNlbGwuZGF0YXNldC5ib2FyZCA9PT0gXCJDb21wdXRlclwiXG4gICAgICAgID8gY29tcHV0ZXJQbGF5ZXIuYm9hcmRcbiAgICAgICAgOiB1c2VyUGxheWVyLmJvYXJkO1xuXG4gICAgY2VsbEJvYXJkLnJlY2VpdmVBdHRhY2soW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV0pO1xuICAgIFVJLmF0dGVtcHQoW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV0sIGNlbGxCb2FyZCk7XG4gICAgVUkuc3R5bGVTdW5rKGNlbGxCb2FyZC50eXBlKTtcbiAgICBjaGVja0xvc3MoY3VycmVudFBsYXllcik7XG4gICAgZ2FtZS5zd2l0Y2hUdXJuKCk7XG4gICAgVUkudG9nZ2xlVHVybkJ0bigpO1xuICB9O1xuXG4gIGNvbnN0IGNvbXB1dGVyTW92ZUV2ZW50ID0gYXN5bmMgKCkgPT4ge1xuICAgIFVJLnN0b3BDbGlja3MoKTtcblxuICAgIGNvbnN0IGRlbGF5ID0gKG1pbGxpc2Vjb25kcykgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgbWlsbGlzZWNvbmRzKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBhd2FpdCBkZWxheSg3NTApO1xuXG4gICAgY29uc29sZS5sb2coXCJhZnRlciAxIHNlY1wiKTtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVNb3ZlKCk7XG5cbiAgICBjb25zdCBjZWxsQm9hcmQgPSBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkO1xuICAgIGNlbGxCb2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGVzKTtcbiAgICBVSS5hdHRlbXB0KGNvb3JkaW5hdGVzLCBjZWxsQm9hcmQpO1xuICAgIFVJLnN0eWxlU3VuayhjZWxsQm9hcmQudHlwZSk7XG4gICAgZ2FtZS5jaGVja0xvc3MoZ2FtZS5jdXJyZW50UGxheWVyKTtcbiAgICBnYW1lLnN3aXRjaFR1cm4oKTtcbiAgICBVSS50b2dnbGVUdXJuQnRuKCk7XG4gIH07XG5cbiAgY29uc3Qgc2V0Q29tcHV0ZXJTaGlwcyA9ICgpID0+IHtcbiAgICBnYW1lLnVzZXJQbGF5ZXIuYm9hcmQucGxhY2VTaGlwKFNoaXAoY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVSYW5kb21QYXRoKDIpKSk7XG4gICAgZ2FtZS51c2VyUGxheWVyLmJvYXJkLnBsYWNlU2hpcChTaGlwKGNvbXB1dGVyUGxheWVyLmdlbmVyYXRlUmFuZG9tUGF0aCgzKSkpO1xuICAgIGdhbWUudXNlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChjb21wdXRlclBsYXllci5nZW5lcmF0ZVJhbmRvbVBhdGgoNCkpKTtcbiAgICBnYW1lLnVzZXJQbGF5ZXIuYm9hcmQucGxhY2VTaGlwKFNoaXAoY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVSYW5kb21QYXRoKDUpKSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0R2FtZSxcbiAgICBzd2l0Y2hUdXJuLFxuICAgIGNvbXB1dGVyUGxheWVyLFxuICAgIHVzZXJQbGF5ZXIsXG4gICAgY3VycmVudFBsYXllcixcbiAgICBjaGVja0xvc3MsXG4gICAgbW92ZUV2ZW50LFxuICAgIGNvbXB1dGVyTW92ZUV2ZW50LFxuICAgIHNldENvbXB1dGVyU2hpcHMsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9tb2R1bGVzL0dhbWVib2FyZC5qc1wiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vbW9kdWxlcy9TaGlwLmpzXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9tb2R1bGVzL2dhbWUuanNcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9tb2R1bGVzL1VJLmpzXCI7XG5cbmdhbWUuaW5pdEdhbWUoKTtcbmNvbnN0IHN3aXRjaFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG5VSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xuVUkucmVuZGVyU3RhcnQoKTtcbmdhbWUuc2V0Q29tcHV0ZXJTaGlwcygpO1xuXG5zd2l0Y2hUdXJuQnRuLm9uY2xpY2sgPSAoKSA9PiB7XG4gIFVJLnRvZ2dsZVR1cm5CdG4oKTtcblxuICBVSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xuXG4gIGlmIChnYW1lLmN1cnJlbnRQbGF5ZXIgPT09IGdhbWUuY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICBnYW1lLmNvbXB1dGVyTW92ZUV2ZW50KCk7XG4gIH0gZWxzZSB7XG4gICAgVUkuc3RhcnRDbGlja3MoKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6WyJwYXRoIiwiaGl0cyIsImdldExlbmd0aCIsImNvdW50IiwiZm9yRWFjaCIsImVsZW1lbnQiLCJpc1N1bmsiLCJoaXQiLCJnZXRIaXRzIiwiZ2V0UGF0aCIsInJlc2V0SGl0cyIsInR5cGUiLCJhdHRlbXB0cyIsImJvYXJkIiwiYm9hcmRBcnJheSIsIkFycmF5IiwibWFwIiwiZSIsImZpbGwiLCJtaXNzZXMiLCJzaGlwcyIsImFkZFNoaXAiLCJzaGlwIiwicHVzaCIsInBsYWNlU2hpcCIsInNoaXBPYmplY3QiLCJjb29yZGluYXRlcyIsIngiLCJ5IiwicmVjZWl2ZUF0dGFjayIsImFscmVhZHlIaXQiLCJhbHJlYWR5TWlzcyIsInNvbWUiLCJpdGVtIiwieEl0ZW0iLCJ5SXRlbSIsInJlc2V0R2FtZWJvYXJkIiwiaXNTaGlwIiwiZ2V0U2hpcCIsImF0dGVtcHQiLCJnZW5lcmF0ZU1vdmUiLCJnZXRSYW5kb21JbnQiLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjaGVja0F0dGVtcHRlZCIsImNvb3JkaW5hdGUiLCJtb3ZlIiwiZ2VuZXJhdGVSYW5kb21QYXRoIiwic2hpcExlbmd0aCIsImhvcml6b250YWwiLCJpIiwiVUkiLCJnYW1lYm9hcmQiLCJ0YXJnZXRDZWxsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImlzVmVydGljYWwiLCJzaGlwTGVuZ3RocyIsImN1cnJlbnRTaGlwTGVuZ3RoIiwibmV4dFNoaXAiLCJjaG9vc2VTaGlwIiwiZmluZCIsImxlbmd0aCIsInRleHRDb250ZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImNlbGwiLCJzdHlsZSIsInBvaW50ZXJFdmVudHMiLCJnZXRTZWxlY3RDZWxsIiwic2VsZWN0Q2VsbHMiLCJzZWxlY3RDZWxsIiwicGFyc2VJbnQiLCJkYXRhc2V0IiwiZmxpcCIsInJlbmRlckJvYXJkIiwicGxheWVyQm9hcmQiLCJwbGF5ZXJUaXRsZSIsImNyZWF0ZUVsZW1lbnQiLCJjb25zb2xlIiwibG9nIiwiYXBwZW5kQ2hpbGQiLCJyb3ciLCJyb3dJbmRleCIsInJvd0RpdiIsImNsYXNzTGlzdCIsImFkZCIsImNlbGxJbmRleCIsImlkIiwiY29tcHV0ZXJQbGF5ZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcFByb3BhZ2F0aW9uIiwibW92ZUV2ZW50Iiwic3RvcENsaWNrcyIsInN0YXJ0Q2xpY2tzIiwic3R5bGVTdW5rIiwiYm9hcmRUeXBlIiwidXNlclBsYXllciIsInJlbmRlclN0YXJ0IiwiZGlzcGxheSIsInN0YXJ0U2NyZWVuIiwiZmxpcEJ1dHRvbiIsInN0YXJ0QnV0dG9uIiwiaiIsImlzQ29uZmxpY3RlZCIsImNvbmZsaWN0aW5nIiwiY2hlY2tDZWxsIiwidW5kZWZpbmVkIiwib25tb3VzZWVudGVyIiwiayIsIm5ld0NlbGwiLCJvbm1vdXNlb3V0Iiwib25jbGljayIsInNoaXBDb29yZGluYXRlcyIsImdlbmVyYXRlR3JpZCIsInRvZ2dsZVR1cm5CdG4iLCJzd2l0Y2hUdXJuQnRuIiwiZGlzYWJsZWQiLCJnYW1lIiwiY3VycmVudFBsYXllciIsImNoZWNrTG9zcyIsInBsYXllciIsImV2ZXJ5IiwiYWxlcnQiLCJpbml0R2FtZSIsInN3aXRjaFR1cm4iLCJjZWxsQm9hcmQiLCJjb21wdXRlck1vdmVFdmVudCIsImFzeW5jIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Iiwic2V0Q29tcHV0ZXJTaGlwcyJdLCJzb3VyY2VSb290IjoiIn0=