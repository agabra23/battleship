(()=>{"use strict";const e=function(e){let t=0;const o=()=>{let t=0;return e.forEach((e=>{t++})),t};return{getLength:o,isSunk:()=>t>=o(),hit:()=>{t++},getHits:()=>t,getPath:()=>e,resetHits:()=>{t=0},hits:t}},t=e=>{const t=[],o=function(e){const t=[...Array(10)].map((e=>Array(10).fill("none"))),o=[],r=[];let n=[],a=[];const s=e=>{n.push(e)},l=e=>{a=e};return{placeShip:e=>{e.getPath().forEach((o=>{const[r,n]=o;t[r][n]=e})),s(e)},boardArray:t,receiveAttack:e=>{const[n,s]=e;let d,c=!1;d=o.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),c=r.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),"none"!==t[n][s]&&!1===d?(t[n][s].hit(),l([n,s]),console.log("Hit!",a),o.push(e)):"none"===t[n][s]&&!1===c&&r.push(e)},hits:o,misses:r,addShip:s,resetGameboard:()=>{o=[],r=[],n=[]},isShip:e=>{const[o,r]=e;return"none"!==t[o][r]},getShip:e=>{const[o,r]=e;return t[o][r]},ships:n,type:e,getLastHit:()=>a,setLastHit:l}}(e),r=e=>{t.push(e)};return{attempt:r,board:o,type:e,generateMove:()=>{const e=e=>Math.floor(Math.random()*e),n=e=>t.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]}));let a=[e(9),e(9)];for(;n(a);)a=[e(9),e(9)];return 0!==o.getLastHit().length&&(a=(t=>{const r=[[0,1],[0,-1],[1,0],[-1,0]];for(let e of r){const[t,r]=o.getLastHit(),a=t+e[0],s=r+e[1];if(!n([a,s])&&a>=0&&s>=0)return[a,s]}o.setLastHit([]);let a=[e(9),e(9)];for(;n(a);)a=[e(9),e(9)];return a})(o.getLastHit()),console.log("should be next move",a)),r(a),a},generateRandomPath:e=>{const t=Math.random()<.5;let r,n,a=!1;const s=[];do{t?(r=Math.floor(Math.random()*(10-e+1)),n=Math.floor(10*Math.random())):(r=Math.floor(10*Math.random()),n=Math.floor(Math.random()*(10-e+1)));for(let o=0;o<e;o++)t?s.push([r+o,n]):s.push([r,n+o]);for(let e of o.ships)for(set of e.path)set[0]===s[0]&&set[1]===s[1]&&(a=!0)}while(a);return s}}},o=(()=>{const t=(e,t)=>{const[o,r]=e,n=document.getElementById(`${t.type} - ${o},${r}`),a=t.isShip(e);n.innerHTML=a?"Hit":"Miss"};let o=!0;const r=[2,3,4,5];let n=5;const s=()=>{const e=document.getElementById("chooseShip");r.find((e=>e===n-1))?(n--,e.textContent=`Choose ${n} Coordinates`):(document.querySelectorAll(".selectCell").forEach((e=>{e.style.pointerEvents="none"})),e.textContent='Click "Start Game" to Begin.')},l=e=>{const[t,o]=e,r=document.querySelectorAll(".selectCell");for(const e of r)if(parseInt(e.dataset.x)===t&&parseInt(e.dataset.y)===o)return e},d=()=>{o=!o};return{renderBoard:e=>{const o=document.getElementById("board");o.innerHTML='<div id="overlay"></div>';const r=document.createElement("h3");r.innerHTML=`${e.type}'s Turn`,o.appendChild(r),e.boardArray.forEach(((t,r)=>{const n=document.createElement("div");n.classList.add("rowDiv"),t.forEach(((t,o)=>{const s=document.createElement("div");s.classList.add("boardCell"),s.id=`${e.type} - ${r},${o}`,s.dataset.board=e.type,s.dataset.x=r,s.dataset.y=o,e===a.computerPlayer.board&&"none"!==t&&s.classList.add("selected"),"none"!==t&&(s.classList.add("shipCell"),t.isSunk()&&(s.style.backgroundColor="red")),s.addEventListener("click",(e=>{e.stopPropagation(),""===s.textContent&&a.moveEvent(s)})),n.appendChild(s)})),o.appendChild(n)})),e.misses.forEach((o=>{t(o,e)})),e.hits.forEach((o=>{t(o,e)}))},attempt:t,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"},styleSunk:e=>{document.querySelectorAll(".rowDiv").forEach((t=>{document.querySelectorAll(".boardCell").forEach((t=>{const[o,r]=[t.dataset.x,t.dataset.y];"User"===e?a.userPlayer.board.isShip([o,r])&&a.userPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red"):a.computerPlayer.board.isShip([o,r])&&a.computerPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red")}))}))},renderStart:()=>{document.getElementById("startScreen").style.display="flex",document.getElementById("board").style.display="none",document.getElementById("switchTurnBtn").style.display="none",(()=>{const t=document.getElementById("startScreen");t.style.display="flex";const r=document.createElement("button");r.textContent="Flip Ship Direction",r.id="flipBtn";const c=document.createElement("button");c.id="startBtn",c.textContent="Start Game";const i=document.createElement("h3");i.textContent=`Choose ${n} Coordinates`,i.id="chooseShip";for(let u=0;u<10;u++){const p=document.createElement("div");p.classList.add("rowDiv");for(let t=0;t<10;t++){const r=document.createElement("div");r.classList.add("selectCell"),p.appendChild(r),r.dataset.x=u,r.dataset.y=t;let d=!1;const c=e=>void 0===e||a.computerPlayer.board.isShip([e.dataset.x,e.dataset.y]);r.onmouseenter=e=>{r.style.backgroundColor="yellow",c(r)&&void 0!==r&&(r.style.backgroundColor="black",d=!0);for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="yellow"),c(r)&&void 0!==r?(r.style.backgroundColor="black",d=!0):void 0===r&&(d=!0)}},r.onmouseout=e=>{d=!1,r.style.backgroundColor="";for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="")}},r.onclick=c=>{if(!d){let d=[[parseInt(r.dataset.x),parseInt(r.dataset.y)]];void 0!==r&&r.classList.add("selected");for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.classList.add("selected"),d.push([parseInt(r.dataset.x),parseInt(r.dataset.y)]))}a.computerPlayer.board.placeShip(e(d)),s()}}}t.appendChild(p),t.appendChild(i),t.appendChild(r),t.appendChild(c),c.onclick=()=>{t.style.display="",document.getElementById("board").style.display="",document.getElementById("switchTurnBtn").style.display="",c.style.display="none"},r.onclick=d}})()},toggleTurnBtn:()=>{const e=document.getElementById("switchTurnBtn");e.disabled=!e.disabled}}})(),r=o,n=(()=>{let o=t("Computer"),a=t("User"),s=a;const l=()=>{o=t("Computer"),a=t("User"),s=a,r.renderBoard(s.board),r.renderStart(),n.setComputerShips()},d=()=>{n.currentPlayer===a?n.currentPlayer=o:n.currentPlayer=a},c=e=>{e.board.ships.length>0&&e.board.ships.every((e=>e.isSunk()))&&(alert(`${s.type} wins`),l())};return{switchTurn:d,computerPlayer:o,userPlayer:a,currentPlayer:s,checkLoss:c,moveEvent:e=>{r.stopClicks();const t="Computer"===e.dataset.board?o.board:a.board;t.receiveAttack([e.dataset.x,e.dataset.y],s),r.attempt([e.dataset.x,e.dataset.y],t),r.styleSunk(t.type),c(s),n.switchTurn(),r.toggleTurnBtn()},computerMoveEvent:async()=>{r.stopClicks(),console.log(o.board.getLastHit()),await(750,new Promise((e=>{setTimeout(e,750)})));const e=n.computerPlayer.generateMove(),t=n.computerPlayer.board;t.receiveAttack(e,n.computerPlayer),r.attempt(e,t),r.styleSunk(t.type),c(n.currentPlayer),d(),r.toggleTurnBtn()},setComputerShips:()=>{a.board.placeShip(e(o.generateRandomPath(2))),a.board.placeShip(e(o.generateRandomPath(3))),a.board.placeShip(e(o.generateRandomPath(4))),a.board.placeShip(e(o.generateRandomPath(5)))},resetGame:l}})(),a=n,s=document.getElementById("switchTurnBtn");r.renderBoard(a.currentPlayer.board),r.renderStart(),a.setComputerShips(),s.onclick=()=>{r.toggleTurnBtn(),r.renderBoard(a.currentPlayer.board),a.currentPlayer===a.computerPlayer?a.computerMoveEvent():r.startClicks()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WVQsRUFBSzlCLGVBQWUzRixNQUN0Q2tJLEVBQVVoSCxjQUFjTCxFQUFhNEcsRUFBSzlCLGdCQUMxQyxFQUFHNUQsUUFBUWxCLEVBQWFxSCxHQUN4QixFQUFHaEMsVUFBVWdDLEVBQVVwSSxNQUN2QmdJLEVBQVVMLEVBQUtDLGVBQ2ZHLElBQ0EsRUFBR1AsZUFBZSxFQWtCbEJNLGlCQWZ1QixLQUN2QnhCLEVBQVdwRyxNQUFNYyxVQUFVLEVBQUs2RSxFQUFlekMsbUJBQW1CLEtBQ2xFa0QsRUFBV3BHLE1BQU1jLFVBQVUsRUFBSzZFLEVBQWV6QyxtQkFBbUIsS0FDbEVrRCxFQUFXcEcsTUFBTWMsVUFBVSxFQUFLNkUsRUFBZXpDLG1CQUFtQixLQUNsRWtELEVBQVdwRyxNQUFNYyxVQUFVLEVBQUs2RSxFQUFlekMsbUJBQW1CLElBQUksRUFZdEV5RSxZQUVILEVBL0ZZLEdBaUdiLElDaEdNSixFQUFnQjVELFNBQVNDLGVBQWUsaUJBQzlDLEVBQUdtQixZQUFZLEVBQUsyQyxjQUFjMUgsT0FDbEMsRUFBR3FHLGNBQ0gsRUFBS3VCLG1CQUVMTCxFQUFjSixRQUFVLEtBQ3RCLEVBQUdHLGdCQUVILEVBQUd2QyxZQUFZLEVBQUsyQyxjQUFjMUgsT0FFOUIsRUFBSzBILGdCQUFrQixFQUFLL0IsZUFDOUIsRUFBS3dDLG9CQUVMLEVBQUdsQyxhQUNMLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1VJLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gIGxldCBoaXRzID0gMDtcblxuICBjb25zdCBnZXRIaXRzID0gKCkgPT4ge1xuICAgIHJldHVybiBoaXRzO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzKys7XG4gIH07XG5cbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgcGF0aC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBjb3VudCsrO1xuICAgIH0pO1xuICAgIHJldHVybiBjb3VudDtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGhpdHMgPj0gZ2V0TGVuZ3RoKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGF0aCA9ICgpID0+IHtcbiAgICByZXR1cm4gcGF0aDtcbiAgfTtcblxuICBjb25zdCByZXNldEhpdHMgPSAoKSA9PiB7XG4gICAgaGl0cyA9IDA7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TGVuZ3RoLCBpc1N1bmssIGhpdCwgZ2V0SGl0cywgZ2V0UGF0aCwgcmVzZXRIaXRzLCBoaXRzIH07XG59O1xuZXhwb3J0IGRlZmF1bHQgU2hpcDtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5cbmNvbnN0IFBsYXllciA9ICh0eXBlKSA9PiB7XG4gIGNvbnN0IGF0dGVtcHRzID0gW107XG4gIGNvbnN0IGJvYXJkID0gR2FtZWJvYXJkKHR5cGUpO1xuXG4gIGNvbnN0IGF0dGVtcHQgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBhdHRlbXB0cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgfTtcblxuICBjb25zdCBnZW5lcmF0ZU1vdmUgPSAoKSA9PiB7XG4gICAgY29uc3QgZ2V0UmFuZG9tSW50ID0gKG1heCkgPT4ge1xuICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heCk7XG4gICAgfTtcblxuICAgIGNvbnN0IGNoZWNrQXR0ZW1wdGVkID0gKGF0dGVtcHQpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF0dGVtcHRzLnNvbWUoKGNvb3JkaW5hdGUpID0+IHtcbiAgICAgICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZTtcblxuICAgICAgICByZXR1cm4geCA9PT0gYXR0ZW1wdFswXSAmJiB5ID09PSBhdHRlbXB0WzFdO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIGNvbnN0IGdldEVtcHR5QWRqYWNlbnQgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBbXG4gICAgICAgIFswLCAxXSxcbiAgICAgICAgWzAsIC0xXSxcbiAgICAgICAgWzEsIDBdLFxuICAgICAgICBbLTEsIDBdLFxuICAgICAgXTtcblxuICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgW3hMYXN0LCB5TGFzdF0gPSBib2FyZC5nZXRMYXN0SGl0KCk7XG4gICAgICAgIGNvbnN0IG5ld1ggPSB4TGFzdCArIG9wdGlvblswXTtcbiAgICAgICAgY29uc3QgbmV3WSA9IHlMYXN0ICsgb3B0aW9uWzFdO1xuXG4gICAgICAgIGlmICghY2hlY2tBdHRlbXB0ZWQoW25ld1gsIG5ld1ldKSAmJiBuZXdYID49IDAgJiYgbmV3WSA+PSAwKVxuICAgICAgICAgIHJldHVybiBbbmV3WCwgbmV3WV07XG4gICAgICB9XG4gICAgICBib2FyZC5zZXRMYXN0SGl0KFtdKTtcblxuICAgICAgbGV0IG5ld01vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuICAgICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG5ld01vdmUpKSB7XG4gICAgICAgIG5ld01vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3TW92ZTtcbiAgICB9O1xuXG4gICAgbGV0IG1vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuXG4gICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG1vdmUpKSB7XG4gICAgICBtb3ZlID0gW2dldFJhbmRvbUludCg5KSwgZ2V0UmFuZG9tSW50KDkpXTtcbiAgICB9XG5cbiAgICBpZiAoYm9hcmQuZ2V0TGFzdEhpdCgpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgbW92ZSA9IGdldEVtcHR5QWRqYWNlbnQoYm9hcmQuZ2V0TGFzdEhpdCgpKTtcbiAgICAgIGNvbnNvbGUubG9nKFwic2hvdWxkIGJlIG5leHQgbW92ZVwiLCBtb3ZlKTtcbiAgICB9XG5cbiAgICBhdHRlbXB0KG1vdmUpO1xuXG4gICAgcmV0dXJuIG1vdmU7XG4gIH07XG5cbiAgY29uc3QgZ2VuZXJhdGVSYW5kb21QYXRoID0gKHNoaXBMZW5ndGgpID0+IHtcbiAgICBjb25zdCBob3Jpem9udGFsID0gTWF0aC5yYW5kb20oKSA8IDAuNTsgLy8gUmFuZG9tbHkgY2hvb3NlIGhvcml6b250YWwgb3IgdmVydGljYWwgcGxhY2VtZW50XG4gICAgbGV0IHgsIHk7XG4gICAgbGV0IG92ZXJsYXBwZWQgPSBmYWxzZTtcblxuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW107XG5cbiAgICBkbyB7XG4gICAgICBpZiAoaG9yaXpvbnRhbCkge1xuICAgICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwIC0gc2hpcExlbmd0aCArIDEpKTtcbiAgICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAgLSBzaGlwTGVuZ3RoICsgMSkpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaG9yaXpvbnRhbCkge1xuICAgICAgICAgIGNvb3JkaW5hdGVzLnB1c2goW3ggKyBpLCB5XSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29vcmRpbmF0ZXMucHVzaChbeCwgeSArIGldKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBzaGlwIG9mIGJvYXJkLnNoaXBzKSB7XG4gICAgICAgIGZvciAoc2V0IG9mIHNoaXAucGF0aCkge1xuICAgICAgICAgIGlmIChzZXRbMF0gPT09IGNvb3JkaW5hdGVzWzBdICYmIHNldFsxXSA9PT0gY29vcmRpbmF0ZXNbMV0pIHtcbiAgICAgICAgICAgIG92ZXJsYXBwZWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gd2hpbGUgKG92ZXJsYXBwZWQpO1xuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7IGF0dGVtcHQsIGJvYXJkLCB0eXBlLCBnZW5lcmF0ZU1vdmUsIGdlbmVyYXRlUmFuZG9tUGF0aCB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyO1xuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcC5qc1wiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSBmdW5jdGlvbiAodHlwZSkge1xuICBjb25zdCBib2FyZEFycmF5ID0gWy4uLkFycmF5KDEwKV0ubWFwKChlKSA9PiBBcnJheSgxMCkuZmlsbChcIm5vbmVcIikpO1xuICBjb25zdCBoaXRzID0gW107XG4gIGNvbnN0IG1pc3NlcyA9IFtdO1xuICBsZXQgc2hpcHMgPSBbXTtcbiAgbGV0IGxhc3RIaXQgPSBbXTtcblxuICBjb25zdCByZXNldEdhbWVib2FyZCA9ICgpID0+IHtcbiAgICBoaXRzID0gW107XG4gICAgbWlzc2VzID0gW107XG4gICAgc2hpcHMgPSBbXTtcbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcE9iamVjdCkgPT4ge1xuICAgIGNvbnN0IHBhdGggPSBzaGlwT2JqZWN0LmdldFBhdGgoKTtcbiAgICBwYXRoLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcbiAgICAgIGJvYXJkQXJyYXlbeF1beV0gPSBzaGlwT2JqZWN0O1xuICAgIH0pO1xuICAgIGFkZFNoaXAoc2hpcE9iamVjdCk7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgbGV0IGFscmVhZHlIaXQsXG4gICAgICBhbHJlYWR5TWlzcyA9IGZhbHNlO1xuXG4gICAgYWxyZWFkeUhpdCA9IGhpdHMuc29tZSgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgW3hJdGVtLCB5SXRlbV0gPSBpdGVtO1xuICAgICAgcmV0dXJuIHhJdGVtID09PSBjb29yZGluYXRlc1swXSAmJiB5SXRlbSA9PT0gY29vcmRpbmF0ZXNbMV07XG4gICAgfSk7XG4gICAgYWxyZWFkeU1pc3MgPSBtaXNzZXMuc29tZSgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgW3hJdGVtLCB5SXRlbV0gPSBpdGVtO1xuICAgICAgcmV0dXJuIHhJdGVtID09PSBjb29yZGluYXRlc1swXSAmJiB5SXRlbSA9PT0gY29vcmRpbmF0ZXNbMV07XG4gICAgfSk7XG5cbiAgICBpZiAoYm9hcmRBcnJheVt4XVt5XSAhPT0gXCJub25lXCIgJiYgYWxyZWFkeUhpdCA9PT0gZmFsc2UpIHtcbiAgICAgIGJvYXJkQXJyYXlbeF1beV0uaGl0KCk7XG4gICAgICBzZXRMYXN0SGl0KFt4LCB5XSk7XG4gICAgICBjb25zb2xlLmxvZyhcIkhpdCFcIiwgbGFzdEhpdCk7XG4gICAgICBoaXRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgIH0gZWxzZSBpZiAoYm9hcmRBcnJheVt4XVt5XSA9PT0gXCJub25lXCIgJiYgYWxyZWFkeU1pc3MgPT09IGZhbHNlKSB7XG4gICAgICBtaXNzZXMucHVzaChjb29yZGluYXRlcyk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGFkZFNoaXAgPSAoc2hpcCkgPT4ge1xuICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gIH07XG5cbiAgY29uc3QgaXNTaGlwID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICByZXR1cm4gYm9hcmRBcnJheVt4XVt5XSAhPT0gXCJub25lXCI7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgcmV0dXJuIGJvYXJkQXJyYXlbeF1beV07XG4gIH07XG5cbiAgY29uc3QgZ2V0TGFzdEhpdCA9ICgpID0+IHtcbiAgICByZXR1cm4gbGFzdEhpdDtcbiAgfTtcblxuICBjb25zdCBzZXRMYXN0SGl0ID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgbGFzdEhpdCA9IGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcGxhY2VTaGlwLFxuICAgIGJvYXJkQXJyYXksXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBoaXRzLFxuICAgIG1pc3NlcyxcbiAgICBhZGRTaGlwLFxuICAgIHJlc2V0R2FtZWJvYXJkLFxuICAgIGlzU2hpcCxcbiAgICBnZXRTaGlwLFxuICAgIHNoaXBzLFxuICAgIHR5cGUsXG4gICAgZ2V0TGFzdEhpdCxcbiAgICBzZXRMYXN0SGl0LFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgR2FtZWJvYXJkO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vUGxheWVyXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5cbmNvbnN0IFVJID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyU3RhcnQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcbiAgICBib2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBuZXh0VHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcbiAgICBuZXh0VHVybkJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBnZW5lcmF0ZUdyaWQoKTtcbiAgfTtcblxuICBjb25zdCBzdGFydEV2ZW50ID0gKGVsZW1lbnQpID0+IHtcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgbmV4dFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgbmV4dFR1cm5CdG4uc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyQm9hcmQpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XG4gICAgYm9hcmQuaW5uZXJIVE1MID0gYDxkaXYgaWQ9XCJvdmVybGF5XCI+PC9kaXY+YDtcblxuICAgIGNvbnN0IHBsYXllclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIHBsYXllclRpdGxlLmlubmVySFRNTCA9IGAke3BsYXllckJvYXJkLnR5cGV9J3MgVHVybmA7XG5cbiAgICBib2FyZC5hcHBlbmRDaGlsZChwbGF5ZXJUaXRsZSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5ib2FyZEFycmF5LmZvckVhY2goKHJvdywgcm93SW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHJvd0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICByb3dEaXYuY2xhc3NMaXN0LmFkZChcInJvd0RpdlwiKTtcblxuICAgICAgcm93LmZvckVhY2goKGl0ZW0sIGNlbGxJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiYm9hcmRDZWxsXCIpO1xuICAgICAgICBjZWxsLmlkID0gYCR7cGxheWVyQm9hcmQudHlwZX0gLSAke3Jvd0luZGV4fSwke2NlbGxJbmRleH1gO1xuICAgICAgICBjZWxsLmRhdGFzZXQuYm9hcmQgPSBwbGF5ZXJCb2FyZC50eXBlO1xuICAgICAgICBjZWxsLmRhdGFzZXQueCA9IHJvd0luZGV4O1xuICAgICAgICBjZWxsLmRhdGFzZXQueSA9IGNlbGxJbmRleDtcblxuICAgICAgICBpZiAocGxheWVyQm9hcmQgPT09IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQgJiYgaXRlbSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpdGVtICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNoaXBDZWxsXCIpO1xuXG4gICAgICAgICAgaWYgKGl0ZW0uaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgaWYgKGNlbGwudGV4dENvbnRlbnQgPT09IFwiXCIpIGdhbWUubW92ZUV2ZW50KGNlbGwpO1xuICAgICAgICB9KTtcblxuICAgICAgICByb3dEaXYuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICB9KTtcblxuICAgICAgYm9hcmQuYXBwZW5kQ2hpbGQocm93RGl2KTtcbiAgICB9KTtcblxuICAgIHBsYXllckJvYXJkLm1pc3Nlcy5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgYXR0ZW1wdChjb29yZGluYXRlcywgcGxheWVyQm9hcmQpO1xuICAgIH0pO1xuICAgIHBsYXllckJvYXJkLmhpdHMuZm9yRWFjaCgoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGF0dGVtcHQoY29vcmRpbmF0ZXMsIHBsYXllckJvYXJkKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBhdHRlbXB0ID0gKGNvb3JkaW5hdGVzLCBnYW1lYm9hcmQpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcbiAgICBjb25zdCB0YXJnZXRDZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Z2FtZWJvYXJkLnR5cGV9IC0gJHt4fSwke3l9YCk7XG4gICAgY29uc3QgaXNTaGlwID0gZ2FtZWJvYXJkLmlzU2hpcChjb29yZGluYXRlcyk7XG5cbiAgICBpZiAoaXNTaGlwKSB7XG4gICAgICB0YXJnZXRDZWxsLmlubmVySFRNTCA9IFwiSGl0XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldENlbGwuaW5uZXJIVE1MID0gXCJNaXNzXCI7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHN0b3BDbGlja3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheVwiKTtcblxuICAgIG92ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiYWxsXCI7XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRDbGlja3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheVwiKTtcblxuICAgIG92ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICB9O1xuXG4gIGNvbnN0IHN0eWxlU3VuayA9IChib2FyZFR5cGUpID0+IHtcbiAgICBjb25zdCByb3dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yb3dEaXZcIik7XG4gICAgcm93cy5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIGNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5ib2FyZENlbGxcIik7XG4gICAgICBjZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgIGNvbnN0IFt4LCB5XSA9IFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldO1xuXG4gICAgICAgIGlmIChib2FyZFR5cGUgPT09IFwiVXNlclwiKSB7XG4gICAgICAgICAgaWYgKGdhbWUudXNlclBsYXllci5ib2FyZC5pc1NoaXAoW3gsIHldKSkge1xuICAgICAgICAgICAgY29uc3Qgc2hpcCA9IGdhbWUudXNlclBsYXllci5ib2FyZC5nZXRTaGlwKFt4LCB5XSk7XG4gICAgICAgICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5pc1NoaXAoW3gsIHldKSkge1xuICAgICAgICAgICAgY29uc3Qgc2hpcCA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQuZ2V0U2hpcChbeCwgeV0pO1xuICAgICAgICAgICAgaWYgKHNoaXAuaXNTdW5rKCkpIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHRvZ2dsZVR1cm5CdG4gPSAoKSA9PiB7XG4gICAgY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcbiAgICBzd2l0Y2hUdXJuQnRuLmRpc2FibGVkID0gIXN3aXRjaFR1cm5CdG4uZGlzYWJsZWQ7XG4gIH07XG5cbiAgLy8gQ2hvb3NlIFNoaXAgTG9jYXRpb25zXG5cbiAgbGV0IGlzVmVydGljYWwgPSB0cnVlO1xuICBjb25zdCBzaGlwTGVuZ3RocyA9IFsyLCAzLCA0LCA1XTtcbiAgbGV0IGN1cnJlbnRTaGlwTGVuZ3RoID0gNTtcblxuICBjb25zdCBnZW5lcmF0ZUdyaWQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGNvbnN0IGZsaXBCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIGZsaXBCdXR0b24udGV4dENvbnRlbnQgPSBcIkZsaXAgU2hpcCBEaXJlY3Rpb25cIjtcbiAgICBmbGlwQnV0dG9uLmlkID0gXCJmbGlwQnRuXCI7XG5cbiAgICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgc3RhcnRCdXR0b24uaWQgPSBcInN0YXJ0QnRuXCI7XG4gICAgc3RhcnRCdXR0b24udGV4dENvbnRlbnQgPSBcIlN0YXJ0IEdhbWVcIjtcblxuICAgIGNvbnN0IGNob29zZVNoaXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDNcIik7XG4gICAgY2hvb3NlU2hpcC50ZXh0Q29udGVudCA9IGBDaG9vc2UgJHtjdXJyZW50U2hpcExlbmd0aH0gQ29vcmRpbmF0ZXNgO1xuICAgIGNob29zZVNoaXAuaWQgPSBcImNob29zZVNoaXBcIjtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdENlbGxcIik7XG4gICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcblxuICAgICAgICBjZWxsLmRhdGFzZXQueCA9IGk7XG4gICAgICAgIGNlbGwuZGF0YXNldC55ID0gajtcblxuICAgICAgICAvLyBjb25zdCBjb25mbGljdGluZyA9IChjaGVja0NlbGwpID0+IHtcbiAgICAgICAgLy8gICBmb3IgKHNoaXAgb2YgZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5zaGlwcykge1xuICAgICAgICAvLyAgICAgZm9yIChjb29yZGluYXRlcyBvZiBzaGlwLnBhdGgpIHtcbiAgICAgICAgLy8gICAgICAgaWYgKFxuICAgICAgICAvLyAgICAgICAgIGNvb3JkaW5hdGVzWzBdID09PSBwYXJzZUludChjaGVja0NlbGwuZGF0YXNldC54KSAmJlxuICAgICAgICAvLyAgICAgICAgIGNvb3JkaW5hdGVzWzFdID09PSBwYXJzZUludChjaGVja0NlbGwuZGF0YXNldC55KVxuICAgICAgICAvLyAgICAgICApIHtcbiAgICAgICAgLy8gICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgLy8gICAgICAgfVxuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyAgIH1cbiAgICAgICAgLy8gICByZXR1cm4gZmFsc2U7XG4gICAgICAgIC8vIH07XG5cbiAgICAgICAgbGV0IGlzQ29uZmxpY3RlZCA9IGZhbHNlO1xuXG4gICAgICAgIGNvbnN0IGNvbmZsaWN0aW5nID0gKGNoZWNrQ2VsbCkgPT4ge1xuICAgICAgICAgIGlmIChjaGVja0NlbGwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQuaXNTaGlwKFtcbiAgICAgICAgICAgICAgY2hlY2tDZWxsLmRhdGFzZXQueCxcbiAgICAgICAgICAgICAgY2hlY2tDZWxsLmRhdGFzZXQueSxcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICBjZWxsLm9ubW91c2VlbnRlciA9IChlKSA9PiB7XG4gICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInllbGxvd1wiO1xuICAgICAgICAgIGlmIChjb25mbGljdGluZyhjZWxsKSAmJiBjZWxsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJibGFja1wiO1xuICAgICAgICAgICAgaXNDb25mbGljdGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmb3IgKGxldCBrID0gMTsgayA8IGN1cnJlbnRTaGlwTGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGxldCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSwgaiArIGtdKTtcblxuICAgICAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXdDZWxsICE9PSB1bmRlZmluZWQpIG5ld0NlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ5ZWxsb3dcIjtcbiAgICAgICAgICAgIGlmIChjb25mbGljdGluZyhuZXdDZWxsKSAmJiBuZXdDZWxsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbmV3Q2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImJsYWNrXCI7XG4gICAgICAgICAgICAgIGlzQ29uZmxpY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld0NlbGwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBpc0NvbmZsaWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjZWxsLm9ubW91c2VvdXQgPSAoZSkgPT4ge1xuICAgICAgICAgIGlzQ29uZmxpY3RlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIlwiO1xuXG4gICAgICAgICAgZm9yIChsZXQgayA9IDE7IGsgPCBjdXJyZW50U2hpcExlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICBsZXQgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2ksIGogKyBrXSk7XG5cbiAgICAgICAgICAgIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgIG5ld0NlbGwgPSBnZXRTZWxlY3RDZWxsKFtpICsgaywgal0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNlbGwub25jbGljayA9IChlKSA9PiB7XG4gICAgICAgICAgaWYgKCFpc0NvbmZsaWN0ZWQpIHtcbiAgICAgICAgICAgIGxldCBzaGlwQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAgICAgICAgIFtwYXJzZUludChjZWxsLmRhdGFzZXQueCksIHBhcnNlSW50KGNlbGwuZGF0YXNldC55KV0sXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBpZiAoY2VsbCAhPT0gdW5kZWZpbmVkKSBjZWxsLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RlZFwiKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgayA9IDE7IGsgPCBjdXJyZW50U2hpcExlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgIGxldCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSwgaiArIGtdKTtcblxuICAgICAgICAgICAgICBpZiAoaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgIG5ld0NlbGwgPSBnZXRTZWxlY3RDZWxsKFtpICsgaywgal0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKG5ld0NlbGwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG5ld0NlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIHNoaXBDb29yZGluYXRlcy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgIHBhcnNlSW50KG5ld0NlbGwuZGF0YXNldC54KSxcbiAgICAgICAgICAgICAgICAgIHBhcnNlSW50KG5ld0NlbGwuZGF0YXNldC55KSxcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLnBsYWNlU2hpcChTaGlwKHNoaXBDb29yZGluYXRlcykpO1xuXG4gICAgICAgICAgICBuZXh0U2hpcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQocm93RGl2KTtcbiAgICAgIHN0YXJ0U2NyZWVuLmFwcGVuZENoaWxkKGNob29zZVNoaXApO1xuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQoZmxpcEJ1dHRvbik7XG4gICAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChzdGFydEJ1dHRvbik7XG5cbiAgICAgIHN0YXJ0QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHN0YXJ0RXZlbnQoc3RhcnRTY3JlZW4pO1xuICAgICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB9O1xuXG4gICAgICBmbGlwQnV0dG9uLm9uY2xpY2sgPSBmbGlwO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBuZXh0U2hpcCA9ICgpID0+IHtcbiAgICBjb25zdCBjaG9vc2VTaGlwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjaG9vc2VTaGlwXCIpO1xuXG4gICAgaWYgKFxuICAgICAgc2hpcExlbmd0aHMuZmluZCgobGVuZ3RoKSA9PiB7XG4gICAgICAgIHJldHVybiBsZW5ndGggPT09IGN1cnJlbnRTaGlwTGVuZ3RoIC0gMTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICBjdXJyZW50U2hpcExlbmd0aC0tO1xuICAgICAgY2hvb3NlU2hpcC50ZXh0Q29udGVudCA9IGBDaG9vc2UgJHtjdXJyZW50U2hpcExlbmd0aH0gQ29vcmRpbmF0ZXNgO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2VsZWN0Q2VsbFwiKTtcbiAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY2VsbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgICB9KTtcbiAgICAgIGNob29zZVNoaXAudGV4dENvbnRlbnQgPSBgQ2xpY2sgXCJTdGFydCBHYW1lXCIgdG8gQmVnaW4uYDtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0U2VsZWN0Q2VsbCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgY29uc3Qgc2VsZWN0Q2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNlbGVjdENlbGxcIik7XG4gICAgZm9yIChjb25zdCBzZWxlY3RDZWxsIG9mIHNlbGVjdENlbGxzKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHBhcnNlSW50KHNlbGVjdENlbGwuZGF0YXNldC54KSA9PT0geCAmJlxuICAgICAgICBwYXJzZUludChzZWxlY3RDZWxsLmRhdGFzZXQueSkgPT09IHlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gc2VsZWN0Q2VsbDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZmxpcCA9ICgpID0+IHtcbiAgICBpc1ZlcnRpY2FsID0gIWlzVmVydGljYWw7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJCb2FyZCxcbiAgICBhdHRlbXB0LFxuICAgIHN0b3BDbGlja3MsXG4gICAgc3RhcnRDbGlja3MsXG4gICAgc3R5bGVTdW5rLFxuICAgIHJlbmRlclN0YXJ0LFxuICAgIHRvZ2dsZVR1cm5CdG4sXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBVSTtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL1BsYXllclwiO1xuaW1wb3J0IFVJIGZyb20gXCIuL1VJXCI7XG5cbmNvbnN0IGdhbWUgPSAoKCkgPT4ge1xuICBsZXQgY29tcHV0ZXJQbGF5ZXIgPSBQbGF5ZXIoXCJDb21wdXRlclwiKTtcbiAgbGV0IHVzZXJQbGF5ZXIgPSBQbGF5ZXIoXCJVc2VyXCIpO1xuXG4gIGxldCBjdXJyZW50UGxheWVyID0gdXNlclBsYXllcjtcblxuICBjb25zdCByZXNldEdhbWUgPSAoKSA9PiB7XG4gICAgY29tcHV0ZXJQbGF5ZXIgPSBQbGF5ZXIoXCJDb21wdXRlclwiKTtcbiAgICB1c2VyUGxheWVyID0gUGxheWVyKFwiVXNlclwiKTtcblxuICAgIGN1cnJlbnRQbGF5ZXIgPSB1c2VyUGxheWVyO1xuXG4gICAgVUkucmVuZGVyQm9hcmQoY3VycmVudFBsYXllci5ib2FyZCk7XG4gICAgVUkucmVuZGVyU3RhcnQoKTtcbiAgICBnYW1lLnNldENvbXB1dGVyU2hpcHMoKTtcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hUdXJuID0gKCkgPT4ge1xuICAgIGlmIChnYW1lLmN1cnJlbnRQbGF5ZXIgPT09IHVzZXJQbGF5ZXIpIHtcbiAgICAgIGdhbWUuY3VycmVudFBsYXllciA9IGNvbXB1dGVyUGxheWVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBnYW1lLmN1cnJlbnRQbGF5ZXIgPSB1c2VyUGxheWVyO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjaGVja0xvc3MgPSAocGxheWVyKSA9PiB7XG4gICAgY29uc3QgYWxsU3VuayA9XG4gICAgICBwbGF5ZXIuYm9hcmQuc2hpcHMubGVuZ3RoID4gMCAmJlxuICAgICAgcGxheWVyLmJvYXJkLnNoaXBzLmV2ZXJ5KChzaGlwKSA9PiB7XG4gICAgICAgIHJldHVybiBzaGlwLmlzU3VuaygpO1xuICAgICAgfSk7XG5cbiAgICBpZiAoYWxsU3Vuaykge1xuICAgICAgYWxlcnQoYCR7Y3VycmVudFBsYXllci50eXBlfSB3aW5zYCk7XG4gICAgICByZXNldEdhbWUoKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgbW92ZUV2ZW50ID0gKGNlbGwpID0+IHtcbiAgICBVSS5zdG9wQ2xpY2tzKCk7XG4gICAgY29uc3QgY2VsbEJvYXJkID1cbiAgICAgIGNlbGwuZGF0YXNldC5ib2FyZCA9PT0gXCJDb21wdXRlclwiXG4gICAgICAgID8gY29tcHV0ZXJQbGF5ZXIuYm9hcmRcbiAgICAgICAgOiB1c2VyUGxheWVyLmJvYXJkO1xuXG4gICAgY2VsbEJvYXJkLnJlY2VpdmVBdHRhY2soW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV0sIGN1cnJlbnRQbGF5ZXIpO1xuICAgIFVJLmF0dGVtcHQoW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV0sIGNlbGxCb2FyZCk7XG4gICAgVUkuc3R5bGVTdW5rKGNlbGxCb2FyZC50eXBlKTtcbiAgICBjaGVja0xvc3MoY3VycmVudFBsYXllcik7XG4gICAgZ2FtZS5zd2l0Y2hUdXJuKCk7XG4gICAgVUkudG9nZ2xlVHVybkJ0bigpO1xuICB9O1xuXG4gIGNvbnN0IGNvbXB1dGVyTW92ZUV2ZW50ID0gYXN5bmMgKCkgPT4ge1xuICAgIFVJLnN0b3BDbGlja3MoKTtcblxuICAgIGNvbnNvbGUubG9nKGNvbXB1dGVyUGxheWVyLmJvYXJkLmdldExhc3RIaXQoKSk7XG5cbiAgICBjb25zdCBkZWxheSA9IChtaWxsaXNlY29uZHMpID0+IHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KHJlc29sdmUsIG1pbGxpc2Vjb25kcyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgYXdhaXQgZGVsYXkoNzUwKTtcblxuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gZ2FtZS5jb21wdXRlclBsYXllci5nZW5lcmF0ZU1vdmUoKTtcblxuICAgIGNvbnN0IGNlbGxCb2FyZCA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQ7XG4gICAgY2VsbEJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMsIGdhbWUuY29tcHV0ZXJQbGF5ZXIpO1xuICAgIFVJLmF0dGVtcHQoY29vcmRpbmF0ZXMsIGNlbGxCb2FyZCk7XG4gICAgVUkuc3R5bGVTdW5rKGNlbGxCb2FyZC50eXBlKTtcbiAgICBjaGVja0xvc3MoZ2FtZS5jdXJyZW50UGxheWVyKTtcbiAgICBzd2l0Y2hUdXJuKCk7XG4gICAgVUkudG9nZ2xlVHVybkJ0bigpO1xuICB9O1xuXG4gIGNvbnN0IHNldENvbXB1dGVyU2hpcHMgPSAoKSA9PiB7XG4gICAgdXNlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChjb21wdXRlclBsYXllci5nZW5lcmF0ZVJhbmRvbVBhdGgoMikpKTtcbiAgICB1c2VyUGxheWVyLmJvYXJkLnBsYWNlU2hpcChTaGlwKGNvbXB1dGVyUGxheWVyLmdlbmVyYXRlUmFuZG9tUGF0aCgzKSkpO1xuICAgIHVzZXJQbGF5ZXIuYm9hcmQucGxhY2VTaGlwKFNoaXAoY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVSYW5kb21QYXRoKDQpKSk7XG4gICAgdXNlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChjb21wdXRlclBsYXllci5nZW5lcmF0ZVJhbmRvbVBhdGgoNSkpKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHN3aXRjaFR1cm4sXG4gICAgY29tcHV0ZXJQbGF5ZXIsXG4gICAgdXNlclBsYXllcixcbiAgICBjdXJyZW50UGxheWVyLFxuICAgIGNoZWNrTG9zcyxcbiAgICBtb3ZlRXZlbnQsXG4gICAgY29tcHV0ZXJNb3ZlRXZlbnQsXG4gICAgc2V0Q29tcHV0ZXJTaGlwcyxcbiAgICByZXNldEdhbWUsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9tb2R1bGVzL0dhbWVib2FyZC5qc1wiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vbW9kdWxlcy9TaGlwLmpzXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9tb2R1bGVzL2dhbWUuanNcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9tb2R1bGVzL1VJLmpzXCI7XG5cblxuY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcblVJLnJlbmRlckJvYXJkKGdhbWUuY3VycmVudFBsYXllci5ib2FyZCk7XG5VSS5yZW5kZXJTdGFydCgpO1xuZ2FtZS5zZXRDb21wdXRlclNoaXBzKCk7XG5cbnN3aXRjaFR1cm5CdG4ub25jbGljayA9ICgpID0+IHtcbiAgVUkudG9nZ2xlVHVybkJ0bigpO1xuXG4gIFVJLnJlbmRlckJvYXJkKGdhbWUuY3VycmVudFBsYXllci5ib2FyZCk7XG5cbiAgaWYgKGdhbWUuY3VycmVudFBsYXllciA9PT0gZ2FtZS5jb21wdXRlclBsYXllcikge1xuICAgIGdhbWUuY29tcHV0ZXJNb3ZlRXZlbnQoKTtcbiAgfSBlbHNlIHtcbiAgICBVSS5zdGFydENsaWNrcygpO1xuICB9XG59O1xuIl0sIm5hbWVzIjpbInBhdGgiLCJoaXRzIiwiZ2V0TGVuZ3RoIiwiY291bnQiLCJmb3JFYWNoIiwiZWxlbWVudCIsImlzU3VuayIsImhpdCIsImdldEhpdHMiLCJnZXRQYXRoIiwicmVzZXRIaXRzIiwidHlwZSIsImF0dGVtcHRzIiwiYm9hcmQiLCJib2FyZEFycmF5IiwiQXJyYXkiLCJtYXAiLCJlIiwiZmlsbCIsIm1pc3NlcyIsInNoaXBzIiwibGFzdEhpdCIsImFkZFNoaXAiLCJzaGlwIiwicHVzaCIsInNldExhc3RIaXQiLCJjb29yZGluYXRlcyIsInBsYWNlU2hpcCIsInNoaXBPYmplY3QiLCJ4IiwieSIsInJlY2VpdmVBdHRhY2siLCJhbHJlYWR5SGl0IiwiYWxyZWFkeU1pc3MiLCJzb21lIiwiaXRlbSIsInhJdGVtIiwieUl0ZW0iLCJjb25zb2xlIiwibG9nIiwicmVzZXRHYW1lYm9hcmQiLCJpc1NoaXAiLCJnZXRTaGlwIiwiZ2V0TGFzdEhpdCIsImF0dGVtcHQiLCJnZW5lcmF0ZU1vdmUiLCJnZXRSYW5kb21JbnQiLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjaGVja0F0dGVtcHRlZCIsImNvb3JkaW5hdGUiLCJtb3ZlIiwibGVuZ3RoIiwib3B0aW9ucyIsIm9wdGlvbiIsInhMYXN0IiwieUxhc3QiLCJuZXdYIiwibmV3WSIsIm5ld01vdmUiLCJnZXRFbXB0eUFkamFjZW50IiwiZ2VuZXJhdGVSYW5kb21QYXRoIiwic2hpcExlbmd0aCIsImhvcml6b250YWwiLCJvdmVybGFwcGVkIiwiaSIsInNldCIsIlVJIiwiZ2FtZWJvYXJkIiwidGFyZ2V0Q2VsbCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJpc1ZlcnRpY2FsIiwic2hpcExlbmd0aHMiLCJjdXJyZW50U2hpcExlbmd0aCIsIm5leHRTaGlwIiwiY2hvb3NlU2hpcCIsImZpbmQiLCJ0ZXh0Q29udGVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjZWxsIiwic3R5bGUiLCJwb2ludGVyRXZlbnRzIiwiZ2V0U2VsZWN0Q2VsbCIsInNlbGVjdENlbGxzIiwic2VsZWN0Q2VsbCIsInBhcnNlSW50IiwiZGF0YXNldCIsImZsaXAiLCJyZW5kZXJCb2FyZCIsInBsYXllckJvYXJkIiwicGxheWVyVGl0bGUiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJyb3ciLCJyb3dJbmRleCIsInJvd0RpdiIsImNsYXNzTGlzdCIsImFkZCIsImNlbGxJbmRleCIsImlkIiwiY29tcHV0ZXJQbGF5ZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcFByb3BhZ2F0aW9uIiwibW92ZUV2ZW50Iiwic3RvcENsaWNrcyIsInN0YXJ0Q2xpY2tzIiwic3R5bGVTdW5rIiwiYm9hcmRUeXBlIiwidXNlclBsYXllciIsInJlbmRlclN0YXJ0IiwiZGlzcGxheSIsInN0YXJ0U2NyZWVuIiwiZmxpcEJ1dHRvbiIsInN0YXJ0QnV0dG9uIiwiaiIsImlzQ29uZmxpY3RlZCIsImNvbmZsaWN0aW5nIiwiY2hlY2tDZWxsIiwidW5kZWZpbmVkIiwib25tb3VzZWVudGVyIiwiayIsIm5ld0NlbGwiLCJvbm1vdXNlb3V0Iiwib25jbGljayIsInNoaXBDb29yZGluYXRlcyIsImdlbmVyYXRlR3JpZCIsInRvZ2dsZVR1cm5CdG4iLCJzd2l0Y2hUdXJuQnRuIiwiZGlzYWJsZWQiLCJnYW1lIiwiY3VycmVudFBsYXllciIsInJlc2V0R2FtZSIsInNldENvbXB1dGVyU2hpcHMiLCJzd2l0Y2hUdXJuIiwiY2hlY2tMb3NzIiwicGxheWVyIiwiZXZlcnkiLCJhbGVydCIsImNlbGxCb2FyZCIsImNvbXB1dGVyTW92ZUV2ZW50IiwiYXN5bmMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiXSwic291cmNlUm9vdCI6IiJ9