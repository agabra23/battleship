(()=>{"use strict";const e=function(e){let t=0;const r=()=>{let t=0;return e.forEach((e=>{t++})),t};return{getLength:r,isSunk:()=>t>=r(),hit:()=>{t++},getHits:()=>t,getPath:()=>e,resetHits:()=>{t=0},hits:t}},t=t=>{const r=[],n=function(t){const r=[...Array(10)].map((e=>Array(10).fill("none"))),n=[],o=[];let s=[];const a=e=>{e.getPath().forEach((t=>{const[n,o]=t;r[n][o]=e})),l(e)},l=e=>{s.push(e)};return{placeShip:a,boardArray:r,receiveAttack:e=>{const[t,s]=e;let a,l=!1;a=n.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]})),l=o.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]})),"none"!==r[t][s]&&!1===a?(r[t][s].hit(),n.push(e)):"none"===r[t][s]&&!1===l&&o.push(e)},hits:n,misses:o,addShip:l,resetGameboard:()=>{n=[],o=[],s=[]},initBoard:()=>{a(e([[1,4],[1,5]])),a(e([[6,4],[6,5],[6,6]])),a(e([[4,2],[5,2],[6,2],[7,2]])),a(e([[8,3],[8,4],[8,5],[8,6],[8,7]]))},isShip:e=>{const[t,n]=e;return"none"!==r[t][n]},getShip:e=>{const[t,n]=e;return r[t][n]},ships:s,type:t}}(t),o=e=>{r.push(e)};return{attempt:o,board:n,type:t,generateMove:()=>{const e=e=>Math.floor(Math.random()*e),t=e=>r.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]}));let n=[e(9),e(9)];for(;t(n);)n=[e(9),e(9)];return o(n),n}}},r=(()=>{const t=(e,t)=>{const[r,n]=e,o=document.getElementById(`${t.type} - ${r},${n}`),s=t.isShip(e);o.innerHTML=s?"Hit":"Miss"},r=e=>{const[t,r]=e,n=document.querySelectorAll(".selectCell");for(const e of n)if(parseInt(e.dataset.x)===t&&parseInt(e.dataset.y)===r)return e};return{renderBoard:e=>{const r=document.getElementById("board");r.innerHTML='<div id="overlay"></div>';const n=document.createElement("h3");console.log(e),n.innerHTML=`${e.type}'s Turn`,r.appendChild(n),e.boardArray.forEach(((t,n)=>{const o=document.createElement("div");o.classList.add("rowDiv"),t.forEach(((t,r)=>{const a=document.createElement("div");a.classList.add("boardCell"),a.id=`${e.type} - ${n},${r}`,a.dataset.board=e.type,a.dataset.x=n,a.dataset.y=r,"none"!==t&&(a.classList.add("shipCell"),t.isSunk()&&(a.style.backgroundColor="red")),a.addEventListener("click",(e=>{e.stopPropagation(),""===a.textContent&&s.moveEvent(a)})),o.appendChild(a)})),r.appendChild(o)})),e.misses.forEach((r=>{t(r,e)})),e.hits.forEach((r=>{t(r,e)}))},attempt:t,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"},styleSunk:e=>{document.querySelectorAll(".rowDiv").forEach((t=>{document.querySelectorAll(".boardCell").forEach((t=>{const[r,n]=[t.dataset.x,t.dataset.y];"User"===e?s.userPlayer.board.isShip([r,n])&&s.userPlayer.board.getShip([r,n]).isSunk()&&(t.style.backgroundColor="red"):s.computerPlayer.board.isShip([r,n])&&s.computerPlayer.board.getShip([r,n]).isSunk()&&(t.style.backgroundColor="red")}))}))},renderStart:()=>{const t=document.getElementById("startScreen");t.style.display="flex";const n=document.createElement("button");n.id="startBtn",n.textContent="Start Game",t.appendChild(n),document.getElementById("board").style.display="none",document.getElementById("switchTurnBtn").style.display="none",(()=>{const t=document.getElementById("startScreen");t.style.display="flex";const n=document.createElement("h3");n.textContent="Choose 5 Coordinates";for(let o=0;o<10;o++){const a=document.createElement("div");a.classList.add("rowDiv");for(let t=0;t<10;t++){const n=document.createElement("div");n.classList.add("selectCell"),a.appendChild(n),n.dataset.x=o,n.dataset.y=t,n.onmouseenter=e=>{n.style.backgroundColor="yellow";for(let e=1;e<5;e++){const n=r([o+e,t]);void 0!==n&&(n.style.backgroundColor="yellow")}},n.onmouseout=e=>{n.style.backgroundColor="";for(let e=1;e<5;e++){const n=r([o+e,t]);void 0!==n&&(n.style.backgroundColor="")}},n.onclick=a=>{let l=[[parseInt(n.dataset.x),parseInt(n.dataset.y)]];for(let e=1;e<5;e++){const n=r([o+e,t]);l.push([parseInt(n.dataset.x),parseInt(n.dataset.y)])}s.computerPlayer.board.placeShip(e(l)),console.log("placed")}}t.appendChild(a),t.appendChild(n)}})(),n.onclick=()=>{t.style.display="",document.getElementById("board").style.display="",document.getElementById("switchTurnBtn").style.display="",n.style.display="none"}},toggleTurnBtn:()=>{const e=document.getElementById("switchTurnBtn");e.disabled=!e.disabled}}})(),n=r,o=(()=>{const e=t("Computer"),r=t("User");let s=r;const a=e=>{e.board.ships.length>0&&e.board.ships.every((e=>e.isSunk()))&&alert(`${s.type} wins`)};return{initGame:()=>{r.board,e.board},switchTurn:()=>{console.log("start switch",o.currentPlayer.type),o.currentPlayer===r?o.currentPlayer=e:o.currentPlayer=r,console.log("end switch",o.currentPlayer.type)},computerPlayer:e,userPlayer:r,currentPlayer:s,checkLoss:a,moveEvent:t=>{n.stopClicks();const l="Computer"===t.dataset.board?e.board:r.board;l.receiveAttack([t.dataset.x,t.dataset.y]),n.attempt([t.dataset.x,t.dataset.y],l),n.styleSunk(l.type),a(s),o.switchTurn(),n.toggleTurnBtn()},computerMoveEvent:async()=>{n.stopClicks(),await(750,new Promise((e=>{setTimeout(e,750)}))),console.log("after 1 sec");const e=o.computerPlayer.generateMove(),t=o.computerPlayer.board;t.receiveAttack(e),n.attempt(e,t),n.styleSunk(t.type),o.checkLoss(o.currentPlayer),o.switchTurn(),n.toggleTurnBtn()}}})(),s=o;s.initGame();const a=document.getElementById("switchTurnBtn");n.renderBoard(s.currentPlayer.board),n.renderStart(),a.onclick=()=>{n.toggleTurnBtn(),n.renderBoard(s.currentPlayer.board),s.currentPlayer===s.computerPlayer?s.computerMoveEvent():n.startClicks()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WCxlQUFlLEVBYXJCLEVBbEZZLEdBb0ZiLElDcEZBLEVBQUtVLFdBQ0wsTUFBTVQsRUFBZ0JyRCxTQUFTQyxlQUFlLGlCQUM5QyxFQUFHUSxZQUFZLEVBQUsrQyxjQUFjaEcsT0FDbEMsRUFBRzZFLGNBRUhnQixFQUFjSixRQUFVLEtBQ3RCLEVBQUdHLGdCQUVILEVBQUczQyxZQUFZLEVBQUsrQyxjQUFjaEcsT0FFOUIsRUFBS2dHLGdCQUFrQixFQUFLcEIsZUFDOUIsRUFBSzZCLG9CQUVMLEVBQUdqQyxhQUNMLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1VJLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gIGxldCBoaXRzID0gMDtcblxuICBjb25zdCBnZXRIaXRzID0gKCkgPT4ge1xuICAgIHJldHVybiBoaXRzO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzKys7XG4gIH07XG5cbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgcGF0aC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBjb3VudCsrO1xuICAgIH0pO1xuICAgIHJldHVybiBjb3VudDtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGhpdHMgPj0gZ2V0TGVuZ3RoKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGF0aCA9ICgpID0+IHtcbiAgICByZXR1cm4gcGF0aDtcbiAgfTtcblxuICBjb25zdCByZXNldEhpdHMgPSAoKSA9PiB7XG4gICAgaGl0cyA9IDA7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TGVuZ3RoLCBpc1N1bmssIGhpdCwgZ2V0SGl0cywgZ2V0UGF0aCwgcmVzZXRIaXRzLCBoaXRzIH07XG59O1xuZXhwb3J0IGRlZmF1bHQgU2hpcDtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5cbmNvbnN0IFBsYXllciA9ICh0eXBlKSA9PiB7XG4gIGNvbnN0IGF0dGVtcHRzID0gW107XG4gIGNvbnN0IHR1cm4gPSBmYWxzZTtcbiAgY29uc3QgYm9hcmQgPSBHYW1lYm9hcmQodHlwZSk7XG5cbiAgY29uc3QgYXR0ZW1wdCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGF0dGVtcHRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlTW92ZSA9ICgpID0+IHtcbiAgICBjb25zdCBnZXRSYW5kb21JbnQgPSAobWF4KSA9PiB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KTtcbiAgICB9O1xuXG4gICAgY29uc3QgY2hlY2tBdHRlbXB0ZWQgPSAoYXR0ZW1wdCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXR0ZW1wdHMuc29tZSgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlO1xuXG4gICAgICAgIHJldHVybiB4ID09PSBhdHRlbXB0WzBdICYmIHkgPT09IGF0dGVtcHRbMV07XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgbGV0IG1vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuXG4gICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG1vdmUpKSB7XG4gICAgICBtb3ZlID0gW2dldFJhbmRvbUludCg5KSwgZ2V0UmFuZG9tSW50KDkpXTtcbiAgICB9XG5cbiAgICBhdHRlbXB0KG1vdmUpO1xuXG4gICAgcmV0dXJuIG1vdmU7XG4gIH07XG5cbiAgcmV0dXJuIHsgYXR0ZW1wdCwgYm9hcmQsIHR5cGUsIGdlbmVyYXRlTW92ZSB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyO1xuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcC5qc1wiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSBmdW5jdGlvbiAodHlwZSkge1xuICBjb25zdCBib2FyZEFycmF5ID0gWy4uLkFycmF5KDEwKV0ubWFwKChlKSA9PiBBcnJheSgxMCkuZmlsbChcIm5vbmVcIikpO1xuICBjb25zdCBoaXRzID0gW107XG4gIGNvbnN0IG1pc3NlcyA9IFtdO1xuICBsZXQgc2hpcHMgPSBbXTtcblxuICBjb25zdCBpbml0Qm9hcmQgPSAoKSA9PiB7XG4gICAgcGxhY2VTaGlwKFxuICAgICAgU2hpcChbXG4gICAgICAgIFsxLCA0XSxcbiAgICAgICAgWzEsIDVdLFxuICAgICAgXSlcbiAgICApO1xuICAgIHBsYWNlU2hpcChcbiAgICAgIFNoaXAoW1xuICAgICAgICBbNiwgNF0sXG4gICAgICAgIFs2LCA1XSxcbiAgICAgICAgWzYsIDZdLFxuICAgICAgXSlcbiAgICApO1xuICAgIHBsYWNlU2hpcChcbiAgICAgIFNoaXAoW1xuICAgICAgICBbNCwgMl0sXG4gICAgICAgIFs1LCAyXSxcbiAgICAgICAgWzYsIDJdLFxuICAgICAgICBbNywgMl0sXG4gICAgICBdKVxuICAgICk7XG5cbiAgICBwbGFjZVNoaXAoXG4gICAgICBTaGlwKFtcbiAgICAgICAgWzgsIDNdLFxuICAgICAgICBbOCwgNF0sXG4gICAgICAgIFs4LCA1XSxcbiAgICAgICAgWzgsIDZdLFxuICAgICAgICBbOCwgN10sXG4gICAgICBdKVxuICAgICk7XG4gIH07XG5cbiAgY29uc3QgcmVzZXRHYW1lYm9hcmQgPSAoKSA9PiB7XG4gICAgaGl0cyA9IFtdO1xuICAgIG1pc3NlcyA9IFtdO1xuICAgIHNoaXBzID0gW107XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXBPYmplY3QpID0+IHtcbiAgICBjb25zdCBwYXRoID0gc2hpcE9iamVjdC5nZXRQYXRoKCk7XG4gICAgcGF0aC5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG4gICAgICBib2FyZEFycmF5W3hdW3ldID0gc2hpcE9iamVjdDtcbiAgICB9KTtcbiAgICBhZGRTaGlwKHNoaXBPYmplY3QpO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIGxldCBhbHJlYWR5SGl0LFxuICAgICAgYWxyZWFkeU1pc3MgPSBmYWxzZTtcblxuICAgIGFscmVhZHlIaXQgPSBoaXRzLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IFt4SXRlbSwgeUl0ZW1dID0gaXRlbTtcbiAgICAgIHJldHVybiB4SXRlbSA9PT0gY29vcmRpbmF0ZXNbMF0gJiYgeUl0ZW0gPT09IGNvb3JkaW5hdGVzWzFdO1xuICAgIH0pO1xuICAgIGFscmVhZHlNaXNzID0gbWlzc2VzLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IFt4SXRlbSwgeUl0ZW1dID0gaXRlbTtcbiAgICAgIHJldHVybiB4SXRlbSA9PT0gY29vcmRpbmF0ZXNbMF0gJiYgeUl0ZW0gPT09IGNvb3JkaW5hdGVzWzFdO1xuICAgIH0pO1xuXG4gICAgaWYgKGJvYXJkQXJyYXlbeF1beV0gIT09IFwibm9uZVwiICYmIGFscmVhZHlIaXQgPT09IGZhbHNlKSB7XG4gICAgICBib2FyZEFycmF5W3hdW3ldLmhpdCgpO1xuICAgICAgaGl0cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICB9IGVsc2UgaWYgKGJvYXJkQXJyYXlbeF1beV0gPT09IFwibm9uZVwiICYmIGFscmVhZHlNaXNzID09PSBmYWxzZSkge1xuICAgICAgbWlzc2VzLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBhZGRTaGlwID0gKHNoaXApID0+IHtcbiAgICBzaGlwcy5wdXNoKHNoaXApO1xuICB9O1xuXG4gIGNvbnN0IGlzU2hpcCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgcmV0dXJuIGJvYXJkQXJyYXlbeF1beV0gIT09IFwibm9uZVwiO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXAgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIHJldHVybiBib2FyZEFycmF5W3hdW3ldO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcGxhY2VTaGlwLFxuICAgIGJvYXJkQXJyYXksXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBoaXRzLFxuICAgIG1pc3NlcyxcbiAgICBhZGRTaGlwLFxuICAgIHJlc2V0R2FtZWJvYXJkLFxuICAgIGluaXRCb2FyZCxcbiAgICBpc1NoaXAsXG4gICAgZ2V0U2hpcCxcbiAgICBzaGlwcyxcbiAgICB0eXBlLFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgR2FtZWJvYXJkO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vUGxheWVyXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5cbmNvbnN0IFVJID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyU3RhcnQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBzdGFydEJ1dHRvbi5pZCA9IFwic3RhcnRCdG5cIjtcbiAgICBzdGFydEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3RhcnQgR2FtZVwiO1xuXG4gICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQoc3RhcnRCdXR0b24pO1xuXG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIGNvbnN0IG5leHRUdXJuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hUdXJuQnRuXCIpO1xuICAgIG5leHRUdXJuQnRuLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIGdlbmVyYXRlR3JpZCgpO1xuXG4gICAgc3RhcnRCdXR0b24ub25jbGljayA9ICgpID0+IHtcbiAgICAgIHN0YXJ0RXZlbnQoc3RhcnRTY3JlZW4pO1xuICAgICAgc3RhcnRCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH07XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRFdmVudCA9IChlbGVtZW50KSA9PiB7XG4gICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblxuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcbiAgICBib2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblxuICAgIGNvbnN0IG5leHRUdXJuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hUdXJuQnRuXCIpO1xuICAgIG5leHRUdXJuQnRuLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlckJvYXJkID0gKHBsYXllckJvYXJkKSA9PiB7XG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLmlubmVySFRNTCA9IGA8ZGl2IGlkPVwib3ZlcmxheVwiPjwvZGl2PmA7XG5cbiAgICBjb25zdCBwbGF5ZXJUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoM1wiKTtcbiAgICBjb25zb2xlLmxvZyhwbGF5ZXJCb2FyZCk7XG4gICAgcGxheWVyVGl0bGUuaW5uZXJIVE1MID0gYCR7cGxheWVyQm9hcmQudHlwZX0ncyBUdXJuYDtcblxuICAgIGJvYXJkLmFwcGVuZENoaWxkKHBsYXllclRpdGxlKTtcblxuICAgIHBsYXllckJvYXJkLmJvYXJkQXJyYXkuZm9yRWFjaCgocm93LCByb3dJbmRleCkgPT4ge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICByb3cuZm9yRWFjaCgoaXRlbSwgY2VsbEluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJib2FyZENlbGxcIik7XG4gICAgICAgIGNlbGwuaWQgPSBgJHtwbGF5ZXJCb2FyZC50eXBlfSAtICR7cm93SW5kZXh9LCR7Y2VsbEluZGV4fWA7XG4gICAgICAgIGNlbGwuZGF0YXNldC5ib2FyZCA9IHBsYXllckJvYXJkLnR5cGU7XG4gICAgICAgIGNlbGwuZGF0YXNldC54ID0gcm93SW5kZXg7XG4gICAgICAgIGNlbGwuZGF0YXNldC55ID0gY2VsbEluZGV4O1xuICAgICAgICBpZiAoaXRlbSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJzaGlwQ2VsbFwiKTtcblxuICAgICAgICAgIGlmIChpdGVtLmlzU3VuaygpKSB7XG4gICAgICAgICAgICBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgICAvLyBhZGp1c3QgdGhpcy4gTWF5YmUgbWFrZSBpdCBhIHBsYXlSb3VuZCB0aGluZyB0byBraWNrIG9mZiBhIHJvdW5kIGFuZCBlbmQgaXQgd2l0aCBhIHR1cm4gc3dpdGNoLlxuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgaWYgKGNlbGwudGV4dENvbnRlbnQgPT09IFwiXCIpIGdhbWUubW92ZUV2ZW50KGNlbGwpO1xuICAgICAgICB9KTtcblxuICAgICAgICByb3dEaXYuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICB9KTtcblxuICAgICAgYm9hcmQuYXBwZW5kQ2hpbGQocm93RGl2KTtcbiAgICB9KTtcblxuICAgIHBsYXllckJvYXJkLm1pc3Nlcy5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgYXR0ZW1wdChjb29yZGluYXRlcywgcGxheWVyQm9hcmQpO1xuICAgIH0pO1xuICAgIHBsYXllckJvYXJkLmhpdHMuZm9yRWFjaCgoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGF0dGVtcHQoY29vcmRpbmF0ZXMsIHBsYXllckJvYXJkKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBhdHRlbXB0ID0gKGNvb3JkaW5hdGVzLCBnYW1lYm9hcmQpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcbiAgICBjb25zdCB0YXJnZXRDZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Z2FtZWJvYXJkLnR5cGV9IC0gJHt4fSwke3l9YCk7XG4gICAgY29uc3QgaXNTaGlwID0gZ2FtZWJvYXJkLmlzU2hpcChjb29yZGluYXRlcyk7XG5cbiAgICBpZiAoaXNTaGlwKSB7XG4gICAgICB0YXJnZXRDZWxsLmlubmVySFRNTCA9IFwiSGl0XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldENlbGwuaW5uZXJIVE1MID0gXCJNaXNzXCI7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHN0b3BDbGlja3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheVwiKTtcblxuICAgIG92ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiYWxsXCI7XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRDbGlja3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheVwiKTtcblxuICAgIG92ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICB9O1xuXG4gIGNvbnN0IHN0eWxlU3VuayA9IChib2FyZFR5cGUpID0+IHtcbiAgICBjb25zdCByb3dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yb3dEaXZcIik7XG4gICAgcm93cy5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIGNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5ib2FyZENlbGxcIik7XG4gICAgICBjZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgIGNvbnN0IFt4LCB5XSA9IFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldO1xuXG4gICAgICAgIGlmIChib2FyZFR5cGUgPT09IFwiVXNlclwiKSB7XG4gICAgICAgICAgaWYgKGdhbWUudXNlclBsYXllci5ib2FyZC5pc1NoaXAoW3gsIHldKSkge1xuICAgICAgICAgICAgY29uc3Qgc2hpcCA9IGdhbWUudXNlclBsYXllci5ib2FyZC5nZXRTaGlwKFt4LCB5XSk7XG4gICAgICAgICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5pc1NoaXAoW3gsIHldKSkge1xuICAgICAgICAgICAgY29uc3Qgc2hpcCA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQuZ2V0U2hpcChbeCwgeV0pO1xuICAgICAgICAgICAgaWYgKHNoaXAuaXNTdW5rKCkpIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHRvZ2dsZVR1cm5CdG4gPSAoKSA9PiB7XG4gICAgY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcbiAgICBzd2l0Y2hUdXJuQnRuLmRpc2FibGVkID0gIXN3aXRjaFR1cm5CdG4uZGlzYWJsZWQ7XG4gIH07XG5cbiAgLy8gQ2hvb3NlIFNoaXAgTG9jYXRpb25zXG5cbiAgY29uc3QgaXNWZXJ0aWNhbCA9IHRydWU7XG4gIGNvbnN0IHNoaXBMZW5ndGhzID0gWzIsIDMsIDQsIDVdO1xuICBjb25zdCBjdXJyZW50U2hpcExlbmd0aCA9IDU7XG5cbiAgY29uc3QgZ2VuZXJhdGVHcmlkID0gKCkgPT4ge1xuICAgIGNvbnN0IHN0YXJ0U2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGFydFNjcmVlblwiKTtcbiAgICBzdGFydFNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cbiAgICBjb25zdCBjaG9vc2VTaGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIGNob29zZVNoaXAudGV4dENvbnRlbnQgPSBgQ2hvb3NlICR7Y3VycmVudFNoaXBMZW5ndGh9IENvb3JkaW5hdGVzYDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdENlbGxcIik7XG4gICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcblxuICAgICAgICBjZWxsLmRhdGFzZXQueCA9IGk7XG4gICAgICAgIGNlbGwuZGF0YXNldC55ID0gajtcblxuICAgICAgICBjZWxsLm9ubW91c2VlbnRlciA9IChlKSA9PiB7XG4gICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInllbGxvd1wiO1xuICAgICAgICAgIGZvciAobGV0IGsgPSAxOyBrIDwgY3VycmVudFNoaXBMZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgY29uc3QgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNlbGwub25tb3VzZW91dCA9IChlKSA9PiB7XG4gICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIlwiO1xuICAgICAgICAgIGZvciAobGV0IGsgPSAxOyBrIDwgY3VycmVudFNoaXBMZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgY29uc3QgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNlbGwub25jbGljayA9IChlKSA9PiB7XG4gICAgICAgICAgbGV0IHNoaXBDb29yZGluYXRlcyA9IFtcbiAgICAgICAgICAgIFtwYXJzZUludChjZWxsLmRhdGFzZXQueCksIHBhcnNlSW50KGNlbGwuZGF0YXNldC55KV0sXG4gICAgICAgICAgXTtcblxuICAgICAgICAgIGZvciAobGV0IGsgPSAxOyBrIDwgY3VycmVudFNoaXBMZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgY29uc3QgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICBzaGlwQ29vcmRpbmF0ZXMucHVzaChbXG4gICAgICAgICAgICAgIHBhcnNlSW50KG5ld0NlbGwuZGF0YXNldC54KSxcbiAgICAgICAgICAgICAgcGFyc2VJbnQobmV3Q2VsbC5kYXRhc2V0LnkpLFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChzaGlwQ29vcmRpbmF0ZXMpKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcInBsYWNlZFwiKTtcbiAgICAgICAgICAvLyBuZXh0U2hpcCgpO1xuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChyb3dEaXYpO1xuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQoY2hvb3NlU2hpcCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdldFNlbGVjdENlbGwgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIGNvbnN0IHNlbGVjdENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zZWxlY3RDZWxsXCIpO1xuICAgIGZvciAoY29uc3Qgc2VsZWN0Q2VsbCBvZiBzZWxlY3RDZWxscykge1xuICAgICAgaWYgKFxuICAgICAgICBwYXJzZUludChzZWxlY3RDZWxsLmRhdGFzZXQueCkgPT09IHggJiZcbiAgICAgICAgcGFyc2VJbnQoc2VsZWN0Q2VsbC5kYXRhc2V0LnkpID09PSB5XG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHNlbGVjdENlbGw7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyQm9hcmQsXG4gICAgYXR0ZW1wdCxcbiAgICBzdG9wQ2xpY2tzLFxuICAgIHN0YXJ0Q2xpY2tzLFxuICAgIHN0eWxlU3VuayxcbiAgICByZW5kZXJTdGFydCxcbiAgICB0b2dnbGVUdXJuQnRuLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgVUk7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL0dhbWVib2FyZFwiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcFwiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi9QbGF5ZXJcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9VSVwiO1xuXG5jb25zdCBnYW1lID0gKCgpID0+IHtcbiAgY29uc3QgY29tcHV0ZXJQbGF5ZXIgPSBQbGF5ZXIoXCJDb21wdXRlclwiKTtcbiAgY29uc3QgdXNlclBsYXllciA9IFBsYXllcihcIlVzZXJcIik7XG5cbiAgbGV0IGN1cnJlbnRQbGF5ZXIgPSB1c2VyUGxheWVyO1xuXG4gIGNvbnN0IGluaXRHYW1lID0gKCkgPT4ge1xuICAgIGNvbnN0IHVzZXJCb2FyZCA9IHVzZXJQbGF5ZXIuYm9hcmQ7XG4gICAgY29uc3QgY29tcHV0ZXJCb2FyZCA9IGNvbXB1dGVyUGxheWVyLmJvYXJkO1xuICAgIC8vIGNvbXB1dGVyQm9hcmQuaW5pdEJvYXJkKCk7XG4gICAgLy8gdXNlckJvYXJkLmluaXRCb2FyZCgpO1xuICB9O1xuXG4gIGNvbnN0IHN3aXRjaFR1cm4gPSAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJzdGFydCBzd2l0Y2hcIiwgZ2FtZS5jdXJyZW50UGxheWVyLnR5cGUpO1xuICAgIGlmIChnYW1lLmN1cnJlbnRQbGF5ZXIgPT09IHVzZXJQbGF5ZXIpIHtcbiAgICAgIGdhbWUuY3VycmVudFBsYXllciA9IGNvbXB1dGVyUGxheWVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBnYW1lLmN1cnJlbnRQbGF5ZXIgPSB1c2VyUGxheWVyO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwiZW5kIHN3aXRjaFwiLCBnYW1lLmN1cnJlbnRQbGF5ZXIudHlwZSk7XG4gIH07XG5cbiAgY29uc3QgY2hlY2tMb3NzID0gKHBsYXllcikgPT4ge1xuICAgIGNvbnN0IGFsbFN1bmsgPVxuICAgICAgcGxheWVyLmJvYXJkLnNoaXBzLmxlbmd0aCA+IDAgJiZcbiAgICAgIHBsYXllci5ib2FyZC5zaGlwcy5ldmVyeSgoc2hpcCkgPT4ge1xuICAgICAgICByZXR1cm4gc2hpcC5pc1N1bmsoKTtcbiAgICAgIH0pO1xuXG4gICAgaWYgKGFsbFN1bmspIGFsZXJ0KGAke2N1cnJlbnRQbGF5ZXIudHlwZX0gd2luc2ApO1xuICB9O1xuXG4gIGNvbnN0IG1vdmVFdmVudCA9IChjZWxsKSA9PiB7XG4gICAgVUkuc3RvcENsaWNrcygpO1xuICAgIGNvbnN0IGNlbGxCb2FyZCA9XG4gICAgICBjZWxsLmRhdGFzZXQuYm9hcmQgPT09IFwiQ29tcHV0ZXJcIlxuICAgICAgICA/IGNvbXB1dGVyUGxheWVyLmJvYXJkXG4gICAgICAgIDogdXNlclBsYXllci5ib2FyZDtcblxuICAgIGNlbGxCb2FyZC5yZWNlaXZlQXR0YWNrKFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldKTtcbiAgICBVSS5hdHRlbXB0KFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldLCBjZWxsQm9hcmQpO1xuICAgIFVJLnN0eWxlU3VuayhjZWxsQm9hcmQudHlwZSk7XG4gICAgY2hlY2tMb3NzKGN1cnJlbnRQbGF5ZXIpO1xuICAgIGdhbWUuc3dpdGNoVHVybigpO1xuICAgIFVJLnRvZ2dsZVR1cm5CdG4oKTtcbiAgfTtcblxuICBjb25zdCBjb21wdXRlck1vdmVFdmVudCA9IGFzeW5jICgpID0+IHtcbiAgICBVSS5zdG9wQ2xpY2tzKCk7XG5cbiAgICBjb25zdCBkZWxheSA9IChtaWxsaXNlY29uZHMpID0+IHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KHJlc29sdmUsIG1pbGxpc2Vjb25kcyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgYXdhaXQgZGVsYXkoNzUwKTtcblxuICAgIGNvbnNvbGUubG9nKFwiYWZ0ZXIgMSBzZWNcIik7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBnYW1lLmNvbXB1dGVyUGxheWVyLmdlbmVyYXRlTW92ZSgpO1xuXG4gICAgY29uc3QgY2VsbEJvYXJkID0gZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZDtcbiAgICBjZWxsQm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlcyk7XG4gICAgVUkuYXR0ZW1wdChjb29yZGluYXRlcywgY2VsbEJvYXJkKTtcbiAgICBVSS5zdHlsZVN1bmsoY2VsbEJvYXJkLnR5cGUpO1xuICAgIGdhbWUuY2hlY2tMb3NzKGdhbWUuY3VycmVudFBsYXllcik7XG4gICAgZ2FtZS5zd2l0Y2hUdXJuKCk7XG4gICAgVUkudG9nZ2xlVHVybkJ0bigpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdEdhbWUsXG4gICAgc3dpdGNoVHVybixcbiAgICBjb21wdXRlclBsYXllcixcbiAgICB1c2VyUGxheWVyLFxuICAgIGN1cnJlbnRQbGF5ZXIsXG4gICAgY2hlY2tMb3NzLFxuICAgIG1vdmVFdmVudCxcbiAgICBjb21wdXRlck1vdmVFdmVudCxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWU7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL21vZHVsZXMvR2FtZWJvYXJkLmpzXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9tb2R1bGVzL1NoaXAuanNcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL21vZHVsZXMvZ2FtZS5qc1wiO1xuaW1wb3J0IFVJIGZyb20gXCIuL21vZHVsZXMvVUkuanNcIjtcblxuZ2FtZS5pbml0R2FtZSgpO1xuY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcblVJLnJlbmRlckJvYXJkKGdhbWUuY3VycmVudFBsYXllci5ib2FyZCk7XG5VSS5yZW5kZXJTdGFydCgpO1xuXG5zd2l0Y2hUdXJuQnRuLm9uY2xpY2sgPSAoKSA9PiB7XG4gIFVJLnRvZ2dsZVR1cm5CdG4oKTtcblxuICBVSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xuXG4gIGlmIChnYW1lLmN1cnJlbnRQbGF5ZXIgPT09IGdhbWUuY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICBnYW1lLmNvbXB1dGVyTW92ZUV2ZW50KCk7XG4gIH0gZWxzZSB7XG4gICAgVUkuc3RhcnRDbGlja3MoKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6WyJwYXRoIiwiaGl0cyIsImdldExlbmd0aCIsImNvdW50IiwiZm9yRWFjaCIsImVsZW1lbnQiLCJpc1N1bmsiLCJoaXQiLCJnZXRIaXRzIiwiZ2V0UGF0aCIsInJlc2V0SGl0cyIsInR5cGUiLCJhdHRlbXB0cyIsImJvYXJkIiwiYm9hcmRBcnJheSIsIkFycmF5IiwibWFwIiwiZSIsImZpbGwiLCJtaXNzZXMiLCJzaGlwcyIsInBsYWNlU2hpcCIsInNoaXBPYmplY3QiLCJjb29yZGluYXRlcyIsIngiLCJ5IiwiYWRkU2hpcCIsInNoaXAiLCJwdXNoIiwicmVjZWl2ZUF0dGFjayIsImFscmVhZHlIaXQiLCJhbHJlYWR5TWlzcyIsInNvbWUiLCJpdGVtIiwieEl0ZW0iLCJ5SXRlbSIsInJlc2V0R2FtZWJvYXJkIiwiaW5pdEJvYXJkIiwiaXNTaGlwIiwiZ2V0U2hpcCIsImF0dGVtcHQiLCJnZW5lcmF0ZU1vdmUiLCJnZXRSYW5kb21JbnQiLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjaGVja0F0dGVtcHRlZCIsImNvb3JkaW5hdGUiLCJtb3ZlIiwiVUkiLCJnYW1lYm9hcmQiLCJ0YXJnZXRDZWxsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImdldFNlbGVjdENlbGwiLCJzZWxlY3RDZWxscyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzZWxlY3RDZWxsIiwicGFyc2VJbnQiLCJkYXRhc2V0IiwicmVuZGVyQm9hcmQiLCJwbGF5ZXJCb2FyZCIsInBsYXllclRpdGxlIiwiY3JlYXRlRWxlbWVudCIsImNvbnNvbGUiLCJsb2ciLCJhcHBlbmRDaGlsZCIsInJvdyIsInJvd0luZGV4Iiwicm93RGl2IiwiY2xhc3NMaXN0IiwiYWRkIiwiY2VsbEluZGV4IiwiY2VsbCIsImlkIiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcFByb3BhZ2F0aW9uIiwidGV4dENvbnRlbnQiLCJtb3ZlRXZlbnQiLCJzdG9wQ2xpY2tzIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q2xpY2tzIiwic3R5bGVTdW5rIiwiYm9hcmRUeXBlIiwidXNlclBsYXllciIsImNvbXB1dGVyUGxheWVyIiwicmVuZGVyU3RhcnQiLCJzdGFydFNjcmVlbiIsImRpc3BsYXkiLCJzdGFydEJ1dHRvbiIsImNob29zZVNoaXAiLCJpIiwiaiIsIm9ubW91c2VlbnRlciIsImsiLCJuZXdDZWxsIiwidW5kZWZpbmVkIiwib25tb3VzZW91dCIsIm9uY2xpY2siLCJzaGlwQ29vcmRpbmF0ZXMiLCJnZW5lcmF0ZUdyaWQiLCJ0b2dnbGVUdXJuQnRuIiwic3dpdGNoVHVybkJ0biIsImRpc2FibGVkIiwiZ2FtZSIsImN1cnJlbnRQbGF5ZXIiLCJjaGVja0xvc3MiLCJwbGF5ZXIiLCJsZW5ndGgiLCJldmVyeSIsImFsZXJ0IiwiaW5pdEdhbWUiLCJzd2l0Y2hUdXJuIiwiY2VsbEJvYXJkIiwiY29tcHV0ZXJNb3ZlRXZlbnQiLCJhc3luYyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCJdLCJzb3VyY2VSb290IjoiIn0=