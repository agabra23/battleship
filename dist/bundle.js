(()=>{"use strict";const e=function(e){let t=0;const r=()=>{let t=0;return e.forEach((e=>{t++})),t};return{getLength:r,isSunk:()=>t>=r(),hit:()=>{t++},getHits:()=>t,getPath:()=>e,resetHits:()=>{t=0},hits:t}},t=function(t){const r=[...Array(10)].map((e=>Array(10).fill("none"))),n=[],o=[];let s=[];const a=e=>{e.getPath().forEach((t=>{const[n,o]=t;r[n][o]=e})),c(e)},c=e=>{s.push(e)};return{placeShip:a,boardArray:r,receiveAttack:e=>{const[t,s]=e;let a,c=!1;a=n.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]})),c=o.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]})),"none"!==r[t][s]&&!1===a?(r[t][s].hit(),n.push(e)):"none"===r[t][s]&&!1===c&&o.push(e)},hits:n,misses:o,addShip:c,resetGameboard:()=>{n=[],o=[],s=[]},initBoard:()=>{a(e([[1,4],[1,5]])),a(e([[6,4],[6,5],[6,6]])),a(e([[4,2],[5,2],[6,2],[7,2]])),a(e([[8,3],[8,4],[8,5],[8,6],[8,7]])),a(e([[2,3],[2,4],[2,5],[2,6],[2,7]]))},isShip:e=>{const[t,n]=e;return"none"!==r[t][n]},getShip:e=>{const[t,n]=e;return r[t][n]},ships:s,type:t}},r=e=>{const r=[];return{attempt:e=>{r.push(e)},board:t(e),type:e,generateMove:()=>{const e=e=>Math.floor(Math.random()*e),t=e=>r.some((t=>{const[r,n]=t;return r===e[0]&&n===e[1]}));let n=[e(9),e(9)];for(;t(n);)n=[e(9),e(9)];return n}}},n=(()=>{const e=(e,t)=>{const[r,n]=e,o=document.getElementById(`${t.type} - ${r},${n}`),s=t.isShip(e);o.innerHTML=s?"Hit":"Miss"};return{renderBoard:t=>{const r=document.getElementById("board");r.innerHTML='<div id="overlay"></div>';const n=document.createElement("h3");console.log(t),n.innerHTML=`${t.type}'s Turn`,r.appendChild(n),t.boardArray.forEach(((e,n)=>{const o=document.createElement("div");o.classList.add("rowDiv"),e.forEach(((e,r)=>{const s=document.createElement("div");s.classList.add("boardCell"),s.id=`${t.type} - ${n},${r}`,s.dataset.board=t.type,s.dataset.x=n,s.dataset.y=r,"none"!==e&&(s.classList.add("shipCell"),e.isSunk()&&(s.style.backgroundColor="red")),s.addEventListener("click",(e=>{e.stopPropagation(),""===s.textContent&&a.moveEvent(s)})),o.appendChild(s)})),r.appendChild(o)})),t.misses.forEach((r=>{e(r,t)})),t.hits.forEach((r=>{e(r,t)}))},attempt:e,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"},styleSunk:e=>{document.querySelectorAll(".rowDiv").forEach((t=>{document.querySelectorAll(".boardCell").forEach((t=>{const[r,n]=[t.dataset.x,t.dataset.y];"User"===e?a.userPlayer.board.isShip([r,n])&&a.userPlayer.board.getShip([r,n]).isSunk()&&(t.style.backgroundColor="red"):a.computerPlayer.board.isShip([r,n])&&a.computerPlayer.board.getShip([r,n]).isSunk()&&(t.style.backgroundColor="red")}))}))},renderStart:()=>{const e=document.getElementById("startScreen");e.style.display="flex";const t=document.createElement("button");t.id="startBtn",t.textContent="Start Game",e.appendChild(t),document.getElementById("board").style.display="none",document.getElementById("switchTurnBtn").style.display="none",t.onclick=()=>{e.style.display="",document.getElementById("board").style.display="",document.getElementById("switchTurnBtn").style.display="",t.style.display="none"}},toggleTurnBtn:()=>{const e=document.getElementById("switchTurnBtn");e.disabled=!e.disabled}}})(),o=n,s=(()=>{const e=r("Computer"),t=r("User");let n=t;const a=e=>{e.board.ships.every((e=>e.isSunk()))&&alert("win")};return{initGame:()=>{const r=t.board;e.board.initBoard(),r.initBoard()},switchTurn:()=>{console.log("start switch",s.currentPlayer.type),s.currentPlayer===t?s.currentPlayer=e:s.currentPlayer=t,console.log("end switch",s.currentPlayer.type)},computerPlayer:e,userPlayer:t,currentPlayer:n,checkLoss:a,moveEvent:r=>{o.stopClicks();const c="Computer"===r.dataset.board?e.board:t.board;c.receiveAttack([r.dataset.x,r.dataset.y]),o.attempt([r.dataset.x,r.dataset.y],c),o.styleSunk(c.type),a(n),s.switchTurn(),o.toggleTurnBtn()},computerMoveEvent:async()=>{o.stopClicks(),await(750,new Promise((e=>{setTimeout(e,750)}))),console.log("after 1 sec");const e=s.computerPlayer.generateMove(),t=s.computerPlayer.board;t.receiveAttack(e),o.attempt(e,t),o.styleSunk(t.type),s.checkLoss(s.currentPlayer),s.switchTurn(),o.toggleTurnBtn()}}})(),a=s;a.initGame();const c=document.getElementById("switchTurnBtn");o.renderBoard(a.currentPlayer.board),o.renderStart(),c.onclick=()=>{o.toggleTurnBtn(),o.renderBoard(a.currentPlayer.board),a.currentPlayer===a.computerPlayer?a.computerMoveEvent():o.startClicks()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eUIsRUFDbUIsYUFBdkJsQyxFQUFLRSxRQUFRL0IsTUFDVDZDLEVBQWU3QyxNQUNmNEMsRUFBVzVDLE1BRWpCK0QsRUFBVTVFLGNBQWMsQ0FBQzBDLEVBQUtFLFFBQVFqRCxFQUFHK0MsRUFBS0UsUUFBUWhELElBQ3RELEVBQUdnQixRQUFRLENBQUM4QixFQUFLRSxRQUFRakQsRUFBRytDLEVBQUtFLFFBQVFoRCxHQUFJZ0YsR0FDN0MsRUFBR3RCLFVBQVVzQixFQUFVNUYsTUFDdkJxRixFQUFVRCxHQUNWRCxFQUFLUSxhQUNMLEVBQUdYLGVBQWUsRUFrQ2xCYSxrQkEvQndCQyxVQUN4QixFQUFHM0IsbUJBUVMsSUFMSCxJQUFJNEIsU0FBU0MsSUFDbEJDLFdBQVdELEVBSUgsSUFKeUIsS0FNckMvQyxRQUFRQyxJQUFJLGVBQ1osTUFBTXhDLEVBQWN5RSxFQUFLVCxlQUFlNUMsZUFFbEM4RCxFQUFZVCxFQUFLVCxlQUFlN0MsTUFDdEMrRCxFQUFVNUUsY0FBY04sR0FDeEIsRUFBR2tCLFFBQVFsQixFQUFha0YsR0FDeEIsRUFBR3RCLFVBQVVzQixFQUFVNUYsTUFDdkJtRixFQUFLRSxVQUFVRixFQUFLQyxlQUNwQkQsRUFBS1EsYUFDTCxFQUFHWCxlQUFlLEVBYXJCLEVBaEZZLEdBa0ZiLElDbEZBLEVBQUtTLFdBQ0wsTUFBTVIsRUFBZ0J2QyxTQUFTQyxlQUFlLGlCQUM5QyxFQUFHRSxZQUFZLEVBQUt1QyxjQUFjdkQsT0FDbEMsRUFBRzhDLGNBRUhNLEVBQWNGLFFBQVUsS0FDdEIsRUFBR0MsZ0JBRUgsRUFBR25DLFlBQVksRUFBS3VDLGNBQWN2RCxPQUU5QixFQUFLdUQsZ0JBQWtCLEVBQUtWLGVBQzlCLEVBQUttQixvQkFFTCxFQUFHeEIsYUFDTCxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL0dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9VSS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSBmdW5jdGlvbiAocGF0aCkge1xuICBsZXQgaGl0cyA9IDA7XG5cbiAgY29uc3QgZ2V0SGl0cyA9ICgpID0+IHtcbiAgICByZXR1cm4gaGl0cztcbiAgfTtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgaGl0cysrO1xuICB9O1xuXG4gIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHtcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIHBhdGguZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgY291bnQrKztcbiAgICB9KTtcbiAgICByZXR1cm4gY291bnQ7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4ge1xuICAgIHJldHVybiBoaXRzID49IGdldExlbmd0aCgpO1xuICB9O1xuXG4gIGNvbnN0IGdldFBhdGggPSAoKSA9PiB7XG4gICAgcmV0dXJuIHBhdGg7XG4gIH07XG5cbiAgY29uc3QgcmVzZXRIaXRzID0gKCkgPT4ge1xuICAgIGhpdHMgPSAwO1xuICB9O1xuXG4gIHJldHVybiB7IGdldExlbmd0aCwgaXNTdW5rLCBoaXQsIGdldEhpdHMsIGdldFBhdGgsIHJlc2V0SGl0cywgaGl0cyB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IFNoaXA7XG4iLCJpbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwLmpzXCI7XG5cbmNvbnN0IEdhbWVib2FyZCA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gIGNvbnN0IGJvYXJkQXJyYXkgPSBbLi4uQXJyYXkoMTApXS5tYXAoKGUpID0+IEFycmF5KDEwKS5maWxsKFwibm9uZVwiKSk7XG4gIGNvbnN0IGhpdHMgPSBbXTtcbiAgY29uc3QgbWlzc2VzID0gW107XG4gIGxldCBzaGlwcyA9IFtdO1xuXG4gIGNvbnN0IGluaXRCb2FyZCA9ICgpID0+IHtcbiAgICBwbGFjZVNoaXAoXG4gICAgICBTaGlwKFtcbiAgICAgICAgWzEsIDRdLFxuICAgICAgICBbMSwgNV0sXG4gICAgICBdKVxuICAgICk7XG4gICAgcGxhY2VTaGlwKFxuICAgICAgU2hpcChbXG4gICAgICAgIFs2LCA0XSxcbiAgICAgICAgWzYsIDVdLFxuICAgICAgICBbNiwgNl0sXG4gICAgICBdKVxuICAgICk7XG4gICAgcGxhY2VTaGlwKFxuICAgICAgU2hpcChbXG4gICAgICAgIFs0LCAyXSxcbiAgICAgICAgWzUsIDJdLFxuICAgICAgICBbNiwgMl0sXG4gICAgICAgIFs3LCAyXSxcbiAgICAgIF0pXG4gICAgKTtcblxuICAgIHBsYWNlU2hpcChcbiAgICAgIFNoaXAoW1xuICAgICAgICBbOCwgM10sXG4gICAgICAgIFs4LCA0XSxcbiAgICAgICAgWzgsIDVdLFxuICAgICAgICBbOCwgNl0sXG4gICAgICAgIFs4LCA3XSxcbiAgICAgIF0pXG4gICAgKTtcbiAgICBwbGFjZVNoaXAoXG4gICAgICBTaGlwKFtcbiAgICAgICAgWzIsIDNdLFxuICAgICAgICBbMiwgNF0sXG4gICAgICAgIFsyLCA1XSxcbiAgICAgICAgWzIsIDZdLFxuICAgICAgICBbMiwgN10sXG4gICAgICBdKVxuICAgICk7XG4gIH07XG5cbiAgY29uc3QgcmVzZXRHYW1lYm9hcmQgPSAoKSA9PiB7XG4gICAgaGl0cyA9IFtdO1xuICAgIG1pc3NlcyA9IFtdO1xuICAgIHNoaXBzID0gW107XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXBPYmplY3QpID0+IHtcbiAgICBjb25zdCBwYXRoID0gc2hpcE9iamVjdC5nZXRQYXRoKCk7XG4gICAgcGF0aC5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG4gICAgICBib2FyZEFycmF5W3hdW3ldID0gc2hpcE9iamVjdDtcbiAgICB9KTtcbiAgICBhZGRTaGlwKHNoaXBPYmplY3QpO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIGxldCBhbHJlYWR5SGl0LFxuICAgICAgYWxyZWFkeU1pc3MgPSBmYWxzZTtcblxuICAgIGFscmVhZHlIaXQgPSBoaXRzLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IFt4SXRlbSwgeUl0ZW1dID0gaXRlbTtcbiAgICAgIHJldHVybiB4SXRlbSA9PT0gY29vcmRpbmF0ZXNbMF0gJiYgeUl0ZW0gPT09IGNvb3JkaW5hdGVzWzFdO1xuICAgIH0pO1xuICAgIGFscmVhZHlNaXNzID0gbWlzc2VzLnNvbWUoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IFt4SXRlbSwgeUl0ZW1dID0gaXRlbTtcbiAgICAgIHJldHVybiB4SXRlbSA9PT0gY29vcmRpbmF0ZXNbMF0gJiYgeUl0ZW0gPT09IGNvb3JkaW5hdGVzWzFdO1xuICAgIH0pO1xuXG4gICAgaWYgKGJvYXJkQXJyYXlbeF1beV0gIT09IFwibm9uZVwiICYmIGFscmVhZHlIaXQgPT09IGZhbHNlKSB7XG4gICAgICBib2FyZEFycmF5W3hdW3ldLmhpdCgpO1xuICAgICAgaGl0cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICB9IGVsc2UgaWYgKGJvYXJkQXJyYXlbeF1beV0gPT09IFwibm9uZVwiICYmIGFscmVhZHlNaXNzID09PSBmYWxzZSkge1xuICAgICAgbWlzc2VzLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBhZGRTaGlwID0gKHNoaXApID0+IHtcbiAgICBzaGlwcy5wdXNoKHNoaXApO1xuICB9O1xuXG4gIGNvbnN0IGlzU2hpcCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgcmV0dXJuIGJvYXJkQXJyYXlbeF1beV0gIT09IFwibm9uZVwiO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXAgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcblxuICAgIHJldHVybiBib2FyZEFycmF5W3hdW3ldO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcGxhY2VTaGlwLFxuICAgIGJvYXJkQXJyYXksXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBoaXRzLFxuICAgIG1pc3NlcyxcbiAgICBhZGRTaGlwLFxuICAgIHJlc2V0R2FtZWJvYXJkLFxuICAgIGluaXRCb2FyZCxcbiAgICBpc1NoaXAsXG4gICAgZ2V0U2hpcCxcbiAgICBzaGlwcyxcbiAgICB0eXBlLFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgR2FtZWJvYXJkO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcblxuY29uc3QgUGxheWVyID0gKHR5cGUpID0+IHtcbiAgY29uc3QgYXR0ZW1wdHMgPSBbXTtcbiAgY29uc3QgdHVybiA9IGZhbHNlO1xuICBjb25zdCBib2FyZCA9IEdhbWVib2FyZCh0eXBlKTtcblxuICBjb25zdCBhdHRlbXB0ID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgYXR0ZW1wdHMucHVzaChjb29yZGluYXRlcyk7XG4gIH07XG5cbiAgY29uc3QgZ2VuZXJhdGVNb3ZlID0gKCkgPT4ge1xuICAgIGNvbnN0IGdldFJhbmRvbUludCA9IChtYXgpID0+IHtcbiAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXgpO1xuICAgIH07XG5cbiAgICBjb25zdCBjaGVja0F0dGVtcHRlZCA9IChhdHRlbXB0KSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhdHRlbXB0cy5zb21lKChjb29yZGluYXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGU7XG5cbiAgICAgICAgcmV0dXJuIHggPT09IGF0dGVtcHRbMF0gJiYgeSA9PT0gYXR0ZW1wdFsxXTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICBsZXQgbW92ZSA9IFtnZXRSYW5kb21JbnQoOSksIGdldFJhbmRvbUludCg5KV07XG5cbiAgICB3aGlsZSAoY2hlY2tBdHRlbXB0ZWQobW92ZSkpIHtcbiAgICAgIG1vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuICAgIH1cblxuICAgIHJldHVybiBtb3ZlO1xuICB9O1xuXG4gIHJldHVybiB7IGF0dGVtcHQsIGJvYXJkLCB0eXBlLCBnZW5lcmF0ZU1vdmUgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFBsYXllcjtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL1BsYXllclwiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcFwiO1xuaW1wb3J0IGdhbWUgZnJvbSBcIi4vZ2FtZVwiO1xuXG5jb25zdCBVSSA9ICgoKSA9PiB7XG4gIGNvbnN0IHJlbmRlclN0YXJ0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHN0YXJ0U2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGFydFNjcmVlblwiKTtcbiAgICBzdGFydFNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cbiAgICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgc3RhcnRCdXR0b24uaWQgPSBcInN0YXJ0QnRuXCI7XG4gICAgc3RhcnRCdXR0b24udGV4dENvbnRlbnQgPSBcIlN0YXJ0IEdhbWVcIjtcblxuICAgIHN0YXJ0U2NyZWVuLmFwcGVuZENoaWxkKHN0YXJ0QnV0dG9uKTtcblxuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcbiAgICBib2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBuZXh0VHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcbiAgICBuZXh0VHVybkJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBzdGFydEJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgc3RhcnRFdmVudChzdGFydFNjcmVlbik7XG4gICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfTtcbiAgfTtcblxuICBjb25zdCBzdGFydEV2ZW50ID0gKGVsZW1lbnQpID0+IHtcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgbmV4dFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgbmV4dFR1cm5CdG4uc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyQm9hcmQpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XG4gICAgYm9hcmQuaW5uZXJIVE1MID0gYDxkaXYgaWQ9XCJvdmVybGF5XCI+PC9kaXY+YDtcblxuICAgIGNvbnN0IHBsYXllclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIGNvbnNvbGUubG9nKHBsYXllckJvYXJkKTtcbiAgICBwbGF5ZXJUaXRsZS5pbm5lckhUTUwgPSBgJHtwbGF5ZXJCb2FyZC50eXBlfSdzIFR1cm5gO1xuXG4gICAgYm9hcmQuYXBwZW5kQ2hpbGQocGxheWVyVGl0bGUpO1xuXG4gICAgcGxheWVyQm9hcmQuYm9hcmRBcnJheS5mb3JFYWNoKChyb3csIHJvd0luZGV4KSA9PiB7XG4gICAgICBjb25zdCByb3dEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcm93RGl2LmNsYXNzTGlzdC5hZGQoXCJyb3dEaXZcIik7XG5cbiAgICAgIHJvdy5mb3JFYWNoKChpdGVtLCBjZWxsSW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImJvYXJkQ2VsbFwiKTtcbiAgICAgICAgY2VsbC5pZCA9IGAke3BsYXllckJvYXJkLnR5cGV9IC0gJHtyb3dJbmRleH0sJHtjZWxsSW5kZXh9YDtcbiAgICAgICAgY2VsbC5kYXRhc2V0LmJvYXJkID0gcGxheWVyQm9hcmQudHlwZTtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnggPSByb3dJbmRleDtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnkgPSBjZWxsSW5kZXg7XG4gICAgICAgIGlmIChpdGVtICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNoaXBDZWxsXCIpO1xuXG4gICAgICAgICAgaWYgKGl0ZW0uaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICAgIC8vIGFkanVzdCB0aGlzLiBNYXliZSBtYWtlIGl0IGEgcGxheVJvdW5kIHRoaW5nIHRvIGtpY2sgb2ZmIGEgcm91bmQgYW5kIGVuZCBpdCB3aXRoIGEgdHVybiBzd2l0Y2guXG4gICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBpZiAoY2VsbC50ZXh0Q29udGVudCA9PT0gXCJcIikgZ2FtZS5tb3ZlRXZlbnQoY2VsbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcbiAgICAgIH0pO1xuXG4gICAgICBib2FyZC5hcHBlbmRDaGlsZChyb3dEaXYpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmQubWlzc2VzLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBhdHRlbXB0KGNvb3JkaW5hdGVzLCBwbGF5ZXJCb2FyZCk7XG4gICAgfSk7XG4gICAgcGxheWVyQm9hcmQuaGl0cy5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgYXR0ZW1wdChjb29yZGluYXRlcywgcGxheWVyQm9hcmQpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGF0dGVtcHQgPSAoY29vcmRpbmF0ZXMsIGdhbWVib2FyZCkgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuICAgIGNvbnN0IHRhcmdldENlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtnYW1lYm9hcmQudHlwZX0gLSAke3h9LCR7eX1gKTtcbiAgICBjb25zdCBpc1NoaXAgPSBnYW1lYm9hcmQuaXNTaGlwKGNvb3JkaW5hdGVzKTtcblxuICAgIGlmIChpc1NoaXApIHtcbiAgICAgIHRhcmdldENlbGwuaW5uZXJIVE1MID0gXCJIaXRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFyZ2V0Q2VsbC5pbm5lckhUTUwgPSBcIk1pc3NcIjtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgc3RvcENsaWNrcyA9ICgpID0+IHtcbiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdmVybGF5XCIpO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJhbGxcIjtcbiAgfTtcblxuICBjb25zdCBzdGFydENsaWNrcyA9ICgpID0+IHtcbiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdmVybGF5XCIpO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gIH07XG5cbiAgY29uc3Qgc3R5bGVTdW5rID0gKGJvYXJkVHlwZSkgPT4ge1xuICAgIGNvbnN0IHJvd3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJvd0RpdlwiKTtcbiAgICByb3dzLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgY29uc3QgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmJvYXJkQ2VsbFwiKTtcbiAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY29uc3QgW3gsIHldID0gW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV07XG5cbiAgICAgICAgaWYgKGJvYXJkVHlwZSA9PT0gXCJVc2VyXCIpIHtcbiAgICAgICAgICBpZiAoZ2FtZS51c2VyUGxheWVyLmJvYXJkLmlzU2hpcChbeCwgeV0pKSB7XG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZ2FtZS51c2VyUGxheWVyLmJvYXJkLmdldFNoaXAoW3gsIHldKTtcbiAgICAgICAgICAgIGlmIChzaGlwLmlzU3VuaygpKSBjZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLmlzU2hpcChbeCwgeV0pKSB7XG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5nZXRTaGlwKFt4LCB5XSk7XG4gICAgICAgICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgdG9nZ2xlVHVybkJ0biA9ICgpID0+IHtcbiAgICBjb25zdCBzd2l0Y2hUdXJuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hUdXJuQnRuXCIpO1xuICAgIHN3aXRjaFR1cm5CdG4uZGlzYWJsZWQgPSAhc3dpdGNoVHVybkJ0bi5kaXNhYmxlZDtcbiAgfTtcblxuICAvLyBDaG9vc2UgU2hpcCBMb2NhdGlvbnNcblxuICBjb25zdCBnZW5lcmF0ZUdyaWQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImJvYXJkQ2VsbFwiKTtcbiAgICAgICAgcm93RGl2LmFwcGVuZENoaWxkKGNlbGwpO1xuXG4gICAgICAgIGNlbGwuZGF0YXNldC54ID0gaTtcbiAgICAgICAgY2VsbC5kYXRhc2V0LnkgPSBqO1xuICAgICAgfVxuXG4gICAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChyb3dEaXYpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckJvYXJkLFxuICAgIGF0dGVtcHQsXG4gICAgc3RvcENsaWNrcyxcbiAgICBzdGFydENsaWNrcyxcbiAgICBzdHlsZVN1bmssXG4gICAgcmVuZGVyU3RhcnQsXG4gICAgdG9nZ2xlVHVybkJ0bixcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFVJO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuL1NoaXBcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vUGxheWVyXCI7XG5pbXBvcnQgVUkgZnJvbSBcIi4vVUlcIjtcblxuY29uc3QgZ2FtZSA9ICgoKSA9PiB7XG4gIGNvbnN0IGNvbXB1dGVyUGxheWVyID0gUGxheWVyKFwiQ29tcHV0ZXJcIik7XG4gIGNvbnN0IHVzZXJQbGF5ZXIgPSBQbGF5ZXIoXCJVc2VyXCIpO1xuXG4gIGxldCBjdXJyZW50UGxheWVyID0gdXNlclBsYXllcjtcblxuICBjb25zdCBpbml0R2FtZSA9ICgpID0+IHtcbiAgICBjb25zdCB1c2VyQm9hcmQgPSB1c2VyUGxheWVyLmJvYXJkO1xuICAgIGNvbnN0IGNvbXB1dGVyQm9hcmQgPSBjb21wdXRlclBsYXllci5ib2FyZDtcbiAgICBjb21wdXRlckJvYXJkLmluaXRCb2FyZCgpO1xuICAgIHVzZXJCb2FyZC5pbml0Qm9hcmQoKTtcbiAgfTtcblxuICBjb25zdCBzd2l0Y2hUdXJuID0gKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwic3RhcnQgc3dpdGNoXCIsIGdhbWUuY3VycmVudFBsYXllci50eXBlKTtcbiAgICBpZiAoZ2FtZS5jdXJyZW50UGxheWVyID09PSB1c2VyUGxheWVyKSB7XG4gICAgICBnYW1lLmN1cnJlbnRQbGF5ZXIgPSBjb21wdXRlclBsYXllcjtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2FtZS5jdXJyZW50UGxheWVyID0gdXNlclBsYXllcjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcImVuZCBzd2l0Y2hcIiwgZ2FtZS5jdXJyZW50UGxheWVyLnR5cGUpO1xuICB9O1xuXG4gIGNvbnN0IGNoZWNrTG9zcyA9IChwbGF5ZXIpID0+IHtcbiAgICBjb25zdCBhbGxTdW5rID0gcGxheWVyLmJvYXJkLnNoaXBzLmV2ZXJ5KChzaGlwKSA9PiB7XG4gICAgICByZXR1cm4gc2hpcC5pc1N1bmsoKTtcbiAgICB9KTtcblxuICAgIGlmIChhbGxTdW5rKSBhbGVydChcIndpblwiKTtcbiAgfTtcblxuICBjb25zdCBtb3ZlRXZlbnQgPSAoY2VsbCkgPT4ge1xuICAgIFVJLnN0b3BDbGlja3MoKTtcbiAgICBjb25zdCBjZWxsQm9hcmQgPVxuICAgICAgY2VsbC5kYXRhc2V0LmJvYXJkID09PSBcIkNvbXB1dGVyXCJcbiAgICAgICAgPyBjb21wdXRlclBsYXllci5ib2FyZFxuICAgICAgICA6IHVzZXJQbGF5ZXIuYm9hcmQ7XG5cbiAgICBjZWxsQm9hcmQucmVjZWl2ZUF0dGFjayhbY2VsbC5kYXRhc2V0LngsIGNlbGwuZGF0YXNldC55XSk7XG4gICAgVUkuYXR0ZW1wdChbY2VsbC5kYXRhc2V0LngsIGNlbGwuZGF0YXNldC55XSwgY2VsbEJvYXJkKTtcbiAgICBVSS5zdHlsZVN1bmsoY2VsbEJvYXJkLnR5cGUpO1xuICAgIGNoZWNrTG9zcyhjdXJyZW50UGxheWVyKTtcbiAgICBnYW1lLnN3aXRjaFR1cm4oKTtcbiAgICBVSS50b2dnbGVUdXJuQnRuKCk7XG4gIH07XG5cbiAgY29uc3QgY29tcHV0ZXJNb3ZlRXZlbnQgPSBhc3luYyAoKSA9PiB7XG4gICAgVUkuc3RvcENsaWNrcygpO1xuXG4gICAgY29uc3QgZGVsYXkgPSAobWlsbGlzZWNvbmRzKSA9PiB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCBtaWxsaXNlY29uZHMpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGF3YWl0IGRlbGF5KDc1MCk7XG5cbiAgICBjb25zb2xlLmxvZyhcImFmdGVyIDEgc2VjXCIpO1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gZ2FtZS5jb21wdXRlclBsYXllci5nZW5lcmF0ZU1vdmUoKTtcblxuICAgIGNvbnN0IGNlbGxCb2FyZCA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQ7XG4gICAgY2VsbEJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMpO1xuICAgIFVJLmF0dGVtcHQoY29vcmRpbmF0ZXMsIGNlbGxCb2FyZCk7XG4gICAgVUkuc3R5bGVTdW5rKGNlbGxCb2FyZC50eXBlKTtcbiAgICBnYW1lLmNoZWNrTG9zcyhnYW1lLmN1cnJlbnRQbGF5ZXIpO1xuICAgIGdhbWUuc3dpdGNoVHVybigpO1xuICAgIFVJLnRvZ2dsZVR1cm5CdG4oKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXRHYW1lLFxuICAgIHN3aXRjaFR1cm4sXG4gICAgY29tcHV0ZXJQbGF5ZXIsXG4gICAgdXNlclBsYXllcixcbiAgICBjdXJyZW50UGxheWVyLFxuICAgIGNoZWNrTG9zcyxcbiAgICBtb3ZlRXZlbnQsXG4gICAgY29tcHV0ZXJNb3ZlRXZlbnQsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9tb2R1bGVzL0dhbWVib2FyZC5qc1wiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vbW9kdWxlcy9TaGlwLmpzXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9tb2R1bGVzL2dhbWUuanNcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9tb2R1bGVzL1VJLmpzXCI7XG5cbmdhbWUuaW5pdEdhbWUoKTtcbmNvbnN0IHN3aXRjaFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG5VSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xuVUkucmVuZGVyU3RhcnQoKTtcblxuc3dpdGNoVHVybkJ0bi5vbmNsaWNrID0gKCkgPT4ge1xuICBVSS50b2dnbGVUdXJuQnRuKCk7XG5cbiAgVUkucmVuZGVyQm9hcmQoZ2FtZS5jdXJyZW50UGxheWVyLmJvYXJkKTtcblxuICBpZiAoZ2FtZS5jdXJyZW50UGxheWVyID09PSBnYW1lLmNvbXB1dGVyUGxheWVyKSB7XG4gICAgZ2FtZS5jb21wdXRlck1vdmVFdmVudCgpO1xuICB9IGVsc2Uge1xuICAgIFVJLnN0YXJ0Q2xpY2tzKCk7XG4gIH1cbn07XG4iXSwibmFtZXMiOlsicGF0aCIsImhpdHMiLCJnZXRMZW5ndGgiLCJjb3VudCIsImZvckVhY2giLCJlbGVtZW50IiwiaXNTdW5rIiwiaGl0IiwiZ2V0SGl0cyIsImdldFBhdGgiLCJyZXNldEhpdHMiLCJ0eXBlIiwiYm9hcmRBcnJheSIsIkFycmF5IiwibWFwIiwiZSIsImZpbGwiLCJtaXNzZXMiLCJzaGlwcyIsInBsYWNlU2hpcCIsInNoaXBPYmplY3QiLCJjb29yZGluYXRlcyIsIngiLCJ5IiwiYWRkU2hpcCIsInNoaXAiLCJwdXNoIiwicmVjZWl2ZUF0dGFjayIsImFscmVhZHlIaXQiLCJhbHJlYWR5TWlzcyIsInNvbWUiLCJpdGVtIiwieEl0ZW0iLCJ5SXRlbSIsInJlc2V0R2FtZWJvYXJkIiwiaW5pdEJvYXJkIiwiaXNTaGlwIiwiZ2V0U2hpcCIsImF0dGVtcHRzIiwiYXR0ZW1wdCIsImJvYXJkIiwiZ2VuZXJhdGVNb3ZlIiwiZ2V0UmFuZG9tSW50IiwibWF4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiY2hlY2tBdHRlbXB0ZWQiLCJjb29yZGluYXRlIiwibW92ZSIsIlVJIiwiZ2FtZWJvYXJkIiwidGFyZ2V0Q2VsbCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJyZW5kZXJCb2FyZCIsInBsYXllckJvYXJkIiwicGxheWVyVGl0bGUiLCJjcmVhdGVFbGVtZW50IiwiY29uc29sZSIsImxvZyIsImFwcGVuZENoaWxkIiwicm93Iiwicm93SW5kZXgiLCJyb3dEaXYiLCJjbGFzc0xpc3QiLCJhZGQiLCJjZWxsSW5kZXgiLCJjZWxsIiwiaWQiLCJkYXRhc2V0Iiwic3R5bGUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcFByb3BhZ2F0aW9uIiwidGV4dENvbnRlbnQiLCJtb3ZlRXZlbnQiLCJzdG9wQ2xpY2tzIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q2xpY2tzIiwic3R5bGVTdW5rIiwiYm9hcmRUeXBlIiwicXVlcnlTZWxlY3RvckFsbCIsInVzZXJQbGF5ZXIiLCJjb21wdXRlclBsYXllciIsInJlbmRlclN0YXJ0Iiwic3RhcnRTY3JlZW4iLCJkaXNwbGF5Iiwic3RhcnRCdXR0b24iLCJvbmNsaWNrIiwidG9nZ2xlVHVybkJ0biIsInN3aXRjaFR1cm5CdG4iLCJkaXNhYmxlZCIsImdhbWUiLCJjdXJyZW50UGxheWVyIiwiY2hlY2tMb3NzIiwicGxheWVyIiwiZXZlcnkiLCJhbGVydCIsImluaXRHYW1lIiwidXNlckJvYXJkIiwic3dpdGNoVHVybiIsImNlbGxCb2FyZCIsImNvbXB1dGVyTW92ZUV2ZW50IiwiYXN5bmMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiXSwic291cmNlUm9vdCI6IiJ9