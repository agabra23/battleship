(()=>{"use strict";const e=function(e){let t=0;const o=()=>{let t=0;return e.forEach((e=>{t++})),t};return{getLength:o,isSunk:()=>t>=o(),hit:()=>{t++},getHits:()=>t,getPath:()=>e,resetHits:()=>{t=0},hits:t}},t=e=>{const t=[],o=function(e){const t=[...Array(10)].map((e=>Array(10).fill("none"))),o=[],r=[];let n=[],a=[];const s=e=>{n.push(e)},l=e=>{a=e};return{placeShip:e=>{e.getPath().forEach((o=>{const[r,n]=o;t[r][n]=e})),s(e)},boardArray:t,receiveAttack:e=>{const[n,s]=e;let d,c=!1;d=o.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),c=r.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]})),"none"!==t[n][s]&&!1===d?(t[n][s].hit(),l([n,s]),console.log("Hit!",a),o.push(e)):"none"===t[n][s]&&!1===c&&r.push(e)},hits:o,misses:r,addShip:s,resetGameboard:()=>{o=[],r=[],n=[]},isShip:e=>{const[o,r]=e;return"none"!==t[o][r]},getShip:e=>{const[o,r]=e;return t[o][r]},ships:n,type:e,getLastHit:()=>a,setLastHit:l}}(e),r=e=>{t.push(e)};return{attempt:r,board:o,type:e,generateMove:()=>{const e=e=>Math.floor(Math.random()*e),n=e=>t.some((t=>{const[o,r]=t;return o===e[0]&&r===e[1]}));let a=[e(9),e(9)];for(;n(a);)a=[e(9),e(9)];return 0!==o.getLastHit().length&&(a=(t=>{const r=[[0,1],[0,-1],[1,0],[-1,0]];for(let e of r){const[t,r]=o.getLastHit(),a=t+e[0],s=r+e[1];if(!n([a,s])&&a>=0&&s>=0)return[a,s]}o.setLastHit([]);let a=[e(9),e(9)];for(;n(a);)a=[e(9),e(9)];return a})(o.getLastHit()),console.log("should be next move",a)),r(a),a},generateRandomPath:e=>{const t=Math.random()<.5;let o,r;t?(o=Math.floor(Math.random()*(10-e+1)),r=Math.floor(10*Math.random())):(o=Math.floor(10*Math.random()),r=Math.floor(Math.random()*(10-e+1)));const n=[];for(let a=0;a<e;a++)t?n.push([o+a,r]):n.push([o,r+a]);return n}}},o=(()=>{const t=(e,t)=>{const[o,r]=e,n=document.getElementById(`${t.type} - ${o},${r}`),a=t.isShip(e);n.innerHTML=a?"Hit":"Miss"};let o=!0;const r=[2,3,4,5];let n=5;const s=()=>{const e=document.getElementById("chooseShip");r.find((e=>e===n-1))?(n--,e.textContent=`Choose ${n} Coordinates`):(document.querySelectorAll(".selectCell").forEach((e=>{e.style.pointerEvents="none"})),e.textContent='Click "Start Game" to Begin.')},l=e=>{const[t,o]=e,r=document.querySelectorAll(".selectCell");for(const e of r)if(parseInt(e.dataset.x)===t&&parseInt(e.dataset.y)===o)return e},d=()=>{o=!o};return{renderBoard:e=>{const o=document.getElementById("board");o.innerHTML='<div id="overlay"></div>';const r=document.createElement("h3");r.innerHTML=`${e.type}'s Turn`,o.appendChild(r),e.boardArray.forEach(((t,r)=>{const n=document.createElement("div");n.classList.add("rowDiv"),t.forEach(((t,o)=>{const s=document.createElement("div");s.classList.add("boardCell"),s.id=`${e.type} - ${r},${o}`,s.dataset.board=e.type,s.dataset.x=r,s.dataset.y=o,e===a.computerPlayer.board&&"none"!==t&&s.classList.add("selected"),"none"!==t&&(s.classList.add("shipCell"),t.isSunk()&&(s.style.backgroundColor="red")),s.addEventListener("click",(e=>{e.stopPropagation(),""===s.textContent&&a.moveEvent(s)})),n.appendChild(s)})),o.appendChild(n)})),e.misses.forEach((o=>{t(o,e)})),e.hits.forEach((o=>{t(o,e)}))},attempt:t,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"},styleSunk:e=>{document.querySelectorAll(".rowDiv").forEach((t=>{document.querySelectorAll(".boardCell").forEach((t=>{const[o,r]=[t.dataset.x,t.dataset.y];"User"===e?a.userPlayer.board.isShip([o,r])&&a.userPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red"):a.computerPlayer.board.isShip([o,r])&&a.computerPlayer.board.getShip([o,r]).isSunk()&&(t.style.backgroundColor="red")}))}))},renderStart:()=>{document.getElementById("startScreen").style.display="flex",document.getElementById("board").style.display="none",document.getElementById("switchTurnBtn").style.display="none",(()=>{const t=document.getElementById("startScreen");t.style.display="flex";const r=document.createElement("button");r.textContent="Flip Ship Direction",r.id="flipBtn";const c=document.createElement("button");c.id="startBtn",c.textContent="Start Game";const i=document.createElement("h3");i.textContent=`Choose ${n} Coordinates`,i.id="chooseShip";for(let u=0;u<10;u++){const p=document.createElement("div");p.classList.add("rowDiv");for(let t=0;t<10;t++){const r=document.createElement("div");r.classList.add("selectCell"),p.appendChild(r),r.dataset.x=u,r.dataset.y=t;let d=!1;const c=e=>void 0===e||a.computerPlayer.board.isShip([e.dataset.x,e.dataset.y]);r.onmouseenter=e=>{r.style.backgroundColor="yellow",c(r)&&void 0!==r&&(r.style.backgroundColor="black",d=!0);for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="yellow"),c(r)&&void 0!==r?(r.style.backgroundColor="black",d=!0):void 0===r&&(d=!0)}},r.onmouseout=e=>{d=!1,r.style.backgroundColor="";for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.style.backgroundColor="")}},r.onclick=c=>{if(!d){let d=[[parseInt(r.dataset.x),parseInt(r.dataset.y)]];void 0!==r&&r.classList.add("selected");for(let e=1;e<n;e++){let r=l([u,t+e]);o&&(r=l([u+e,t])),void 0!==r&&(r.classList.add("selected"),d.push([parseInt(r.dataset.x),parseInt(r.dataset.y)]))}a.computerPlayer.board.placeShip(e(d)),s()}}}t.appendChild(p),t.appendChild(i),t.appendChild(r),t.appendChild(c),c.onclick=()=>{t.style.display="",document.getElementById("board").style.display="",document.getElementById("switchTurnBtn").style.display="",c.style.display="none"},r.onclick=d}})()},toggleTurnBtn:()=>{const e=document.getElementById("switchTurnBtn");e.disabled=!e.disabled}}})(),r=o,n=(()=>{const o=t("Computer"),a=t("User");let s=a;const l=e=>{e.board.ships.length>0&&e.board.ships.every((e=>e.isSunk()))&&alert(`${s.type} wins`)};return{switchTurn:()=>{n.currentPlayer===a?n.currentPlayer=o:n.currentPlayer=a},computerPlayer:o,userPlayer:a,currentPlayer:s,checkLoss:l,moveEvent:e=>{r.stopClicks();const t="Computer"===e.dataset.board?o.board:a.board;t.receiveAttack([e.dataset.x,e.dataset.y],s),r.attempt([e.dataset.x,e.dataset.y],t),r.styleSunk(t.type),l(s),n.switchTurn(),r.toggleTurnBtn()},computerMoveEvent:async()=>{r.stopClicks(),console.log(o.board.getLastHit()),await(750,new Promise((e=>{setTimeout(e,750)})));const e=n.computerPlayer.generateMove(),t=n.computerPlayer.board;t.receiveAttack(e,n.computerPlayer),r.attempt(e,t),r.styleSunk(t.type),n.checkLoss(n.currentPlayer),n.switchTurn(),r.toggleTurnBtn()},setComputerShips:()=>{n.userPlayer.board.placeShip(e(o.generateRandomPath(2))),n.userPlayer.board.placeShip(e(o.generateRandomPath(3))),n.userPlayer.board.placeShip(e(o.generateRandomPath(4))),n.userPlayer.board.placeShip(e(o.generateRandomPath(5)))}}})(),a=n,s=document.getElementById("switchTurnBtn");r.renderBoard(a.currentPlayer.board),r.renderStart(),a.setComputerShips(),s.onclick=()=>{r.toggleTurnBtn(),r.renderBoard(a.currentPlayer.board),a.currentPlayer===a.computerPlayer?a.computerMoveEvent():r.startClicks()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QW1CLEtBQ3ZFcUUsRUFBS3JCLFdBQVdsRyxNQUFNYyxVQUFVLEVBQUsyRSxFQUFldkMsbUJBQW1CLEtBQ3ZFcUUsRUFBS3JCLFdBQVdsRyxNQUFNYyxVQUFVLEVBQUsyRSxFQUFldkMsbUJBQW1CLElBQUksRUFjOUUsRUFqRlksR0FtRmIsSUNsRk1tRSxFQUFnQjVELFNBQVNDLGVBQWUsaUJBQzlDLEVBQUdtQixZQUFZLEVBQUsyQyxjQUFjeEgsT0FDbEMsRUFBR21HLGNBQ0gsRUFBS2lDLG1CQUVMZixFQUFjSixRQUFVLEtBQ3RCLEVBQUdHLGdCQUVILEVBQUd2QyxZQUFZLEVBQUsyQyxjQUFjeEgsT0FFOUIsRUFBS3dILGdCQUFrQixFQUFLL0IsZUFDOUIsRUFBS3NDLG9CQUVMLEVBQUdoQyxhQUNMLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1VJLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gIGxldCBoaXRzID0gMDtcblxuICBjb25zdCBnZXRIaXRzID0gKCkgPT4ge1xuICAgIHJldHVybiBoaXRzO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzKys7XG4gIH07XG5cbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgcGF0aC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBjb3VudCsrO1xuICAgIH0pO1xuICAgIHJldHVybiBjb3VudDtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGhpdHMgPj0gZ2V0TGVuZ3RoKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGF0aCA9ICgpID0+IHtcbiAgICByZXR1cm4gcGF0aDtcbiAgfTtcblxuICBjb25zdCByZXNldEhpdHMgPSAoKSA9PiB7XG4gICAgaGl0cyA9IDA7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TGVuZ3RoLCBpc1N1bmssIGhpdCwgZ2V0SGl0cywgZ2V0UGF0aCwgcmVzZXRIaXRzLCBoaXRzIH07XG59O1xuZXhwb3J0IGRlZmF1bHQgU2hpcDtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5cbmNvbnN0IFBsYXllciA9ICh0eXBlKSA9PiB7XG4gIGNvbnN0IGF0dGVtcHRzID0gW107XG4gIGNvbnN0IGJvYXJkID0gR2FtZWJvYXJkKHR5cGUpO1xuXG4gIGNvbnN0IGF0dGVtcHQgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBhdHRlbXB0cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgfTtcblxuICBjb25zdCBnZW5lcmF0ZU1vdmUgPSAoKSA9PiB7XG4gICAgY29uc3QgZ2V0UmFuZG9tSW50ID0gKG1heCkgPT4ge1xuICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heCk7XG4gICAgfTtcblxuICAgIGNvbnN0IGNoZWNrQXR0ZW1wdGVkID0gKGF0dGVtcHQpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF0dGVtcHRzLnNvbWUoKGNvb3JkaW5hdGUpID0+IHtcbiAgICAgICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZTtcblxuICAgICAgICByZXR1cm4geCA9PT0gYXR0ZW1wdFswXSAmJiB5ID09PSBhdHRlbXB0WzFdO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIGNvbnN0IGdldEVtcHR5QWRqYWNlbnQgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBbXG4gICAgICAgIFswLCAxXSxcbiAgICAgICAgWzAsIC0xXSxcbiAgICAgICAgWzEsIDBdLFxuICAgICAgICBbLTEsIDBdLFxuICAgICAgXTtcblxuICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgW3hMYXN0LCB5TGFzdF0gPSBib2FyZC5nZXRMYXN0SGl0KCk7XG4gICAgICAgIGNvbnN0IG5ld1ggPSB4TGFzdCArIG9wdGlvblswXTtcbiAgICAgICAgY29uc3QgbmV3WSA9IHlMYXN0ICsgb3B0aW9uWzFdO1xuXG4gICAgICAgIGlmICghY2hlY2tBdHRlbXB0ZWQoW25ld1gsIG5ld1ldKSAmJiBuZXdYID49IDAgJiYgbmV3WSA+PSAwKVxuICAgICAgICAgIHJldHVybiBbbmV3WCwgbmV3WV07XG4gICAgICB9XG4gICAgICBib2FyZC5zZXRMYXN0SGl0KFtdKTtcblxuICAgICAgbGV0IG5ld01vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuICAgICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG5ld01vdmUpKSB7XG4gICAgICAgIG5ld01vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3TW92ZTtcbiAgICB9O1xuXG4gICAgbGV0IG1vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuXG4gICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG1vdmUpKSB7XG4gICAgICBtb3ZlID0gW2dldFJhbmRvbUludCg5KSwgZ2V0UmFuZG9tSW50KDkpXTtcbiAgICB9XG5cbiAgICBpZiAoYm9hcmQuZ2V0TGFzdEhpdCgpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgbW92ZSA9IGdldEVtcHR5QWRqYWNlbnQoYm9hcmQuZ2V0TGFzdEhpdCgpKTtcbiAgICAgIGNvbnNvbGUubG9nKFwic2hvdWxkIGJlIG5leHQgbW92ZVwiLCBtb3ZlKTtcbiAgICB9XG5cbiAgICBhdHRlbXB0KG1vdmUpO1xuXG4gICAgcmV0dXJuIG1vdmU7XG4gIH07XG5cbiAgY29uc3QgZ2VuZXJhdGVSYW5kb21QYXRoID0gKHNoaXBMZW5ndGgpID0+IHtcbiAgICBjb25zdCBob3Jpem9udGFsID0gTWF0aC5yYW5kb20oKSA8IDAuNTsgLy8gUmFuZG9tbHkgY2hvb3NlIGhvcml6b250YWwgb3IgdmVydGljYWwgcGxhY2VtZW50XG4gICAgbGV0IHgsIHk7XG5cbiAgICBpZiAoaG9yaXpvbnRhbCkge1xuICAgICAgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMCAtIHNoaXBMZW5ndGggKyAxKSk7XG4gICAgICB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIH0gZWxzZSB7XG4gICAgICB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMCAtIHNoaXBMZW5ndGggKyAxKSk7XG4gICAgfVxuXG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGhvcml6b250YWwpIHtcbiAgICAgICAgY29vcmRpbmF0ZXMucHVzaChbeCArIGksIHldKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvb3JkaW5hdGVzLnB1c2goW3gsIHkgKyBpXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7IGF0dGVtcHQsIGJvYXJkLCB0eXBlLCBnZW5lcmF0ZU1vdmUsIGdlbmVyYXRlUmFuZG9tUGF0aCB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyO1xuIiwiaW1wb3J0IFNoaXAgZnJvbSBcIi4vU2hpcC5qc1wiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSBmdW5jdGlvbiAodHlwZSkge1xuICBjb25zdCBib2FyZEFycmF5ID0gWy4uLkFycmF5KDEwKV0ubWFwKChlKSA9PiBBcnJheSgxMCkuZmlsbChcIm5vbmVcIikpO1xuICBjb25zdCBoaXRzID0gW107XG4gIGNvbnN0IG1pc3NlcyA9IFtdO1xuICBsZXQgc2hpcHMgPSBbXTtcbiAgbGV0IGxhc3RIaXQgPSBbXTtcblxuICBjb25zdCByZXNldEdhbWVib2FyZCA9ICgpID0+IHtcbiAgICBoaXRzID0gW107XG4gICAgbWlzc2VzID0gW107XG4gICAgc2hpcHMgPSBbXTtcbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcE9iamVjdCkgPT4ge1xuICAgIGNvbnN0IHBhdGggPSBzaGlwT2JqZWN0LmdldFBhdGgoKTtcbiAgICBwYXRoLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcbiAgICAgIGJvYXJkQXJyYXlbeF1beV0gPSBzaGlwT2JqZWN0O1xuICAgIH0pO1xuICAgIGFkZFNoaXAoc2hpcE9iamVjdCk7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgbGV0IGFscmVhZHlIaXQsXG4gICAgICBhbHJlYWR5TWlzcyA9IGZhbHNlO1xuXG4gICAgYWxyZWFkeUhpdCA9IGhpdHMuc29tZSgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgW3hJdGVtLCB5SXRlbV0gPSBpdGVtO1xuICAgICAgcmV0dXJuIHhJdGVtID09PSBjb29yZGluYXRlc1swXSAmJiB5SXRlbSA9PT0gY29vcmRpbmF0ZXNbMV07XG4gICAgfSk7XG4gICAgYWxyZWFkeU1pc3MgPSBtaXNzZXMuc29tZSgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgW3hJdGVtLCB5SXRlbV0gPSBpdGVtO1xuICAgICAgcmV0dXJuIHhJdGVtID09PSBjb29yZGluYXRlc1swXSAmJiB5SXRlbSA9PT0gY29vcmRpbmF0ZXNbMV07XG4gICAgfSk7XG5cbiAgICBpZiAoYm9hcmRBcnJheVt4XVt5XSAhPT0gXCJub25lXCIgJiYgYWxyZWFkeUhpdCA9PT0gZmFsc2UpIHtcbiAgICAgIGJvYXJkQXJyYXlbeF1beV0uaGl0KCk7XG4gICAgICBzZXRMYXN0SGl0KFt4LCB5XSk7XG4gICAgICBjb25zb2xlLmxvZyhcIkhpdCFcIiwgbGFzdEhpdCk7XG4gICAgICBoaXRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgIH0gZWxzZSBpZiAoYm9hcmRBcnJheVt4XVt5XSA9PT0gXCJub25lXCIgJiYgYWxyZWFkeU1pc3MgPT09IGZhbHNlKSB7XG4gICAgICBtaXNzZXMucHVzaChjb29yZGluYXRlcyk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGFkZFNoaXAgPSAoc2hpcCkgPT4ge1xuICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gIH07XG5cbiAgY29uc3QgaXNTaGlwID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICByZXR1cm4gYm9hcmRBcnJheVt4XVt5XSAhPT0gXCJub25lXCI7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgcmV0dXJuIGJvYXJkQXJyYXlbeF1beV07XG4gIH07XG5cbiAgY29uc3QgZ2V0TGFzdEhpdCA9ICgpID0+IHtcbiAgICByZXR1cm4gbGFzdEhpdDtcbiAgfTtcblxuICBjb25zdCBzZXRMYXN0SGl0ID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgbGFzdEhpdCA9IGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcGxhY2VTaGlwLFxuICAgIGJvYXJkQXJyYXksXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBoaXRzLFxuICAgIG1pc3NlcyxcbiAgICBhZGRTaGlwLFxuICAgIHJlc2V0R2FtZWJvYXJkLFxuICAgIGlzU2hpcCxcbiAgICBnZXRTaGlwLFxuICAgIHNoaXBzLFxuICAgIHR5cGUsXG4gICAgZ2V0TGFzdEhpdCxcbiAgICBzZXRMYXN0SGl0LFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgR2FtZWJvYXJkO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vUGxheWVyXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5cbmNvbnN0IFVJID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyU3RhcnQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcbiAgICBib2FyZC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBjb25zdCBuZXh0VHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcbiAgICBuZXh0VHVybkJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICBnZW5lcmF0ZUdyaWQoKTtcbiAgfTtcblxuICBjb25zdCBzdGFydEV2ZW50ID0gKGVsZW1lbnQpID0+IHtcbiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJvYXJkXCIpO1xuICAgIGJvYXJkLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXG4gICAgY29uc3QgbmV4dFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG4gICAgbmV4dFR1cm5CdG4uc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQm9hcmQgPSAocGxheWVyQm9hcmQpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYm9hcmRcIik7XG4gICAgYm9hcmQuaW5uZXJIVE1MID0gYDxkaXYgaWQ9XCJvdmVybGF5XCI+PC9kaXY+YDtcblxuICAgIGNvbnN0IHBsYXllclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgzXCIpO1xuICAgIHBsYXllclRpdGxlLmlubmVySFRNTCA9IGAke3BsYXllckJvYXJkLnR5cGV9J3MgVHVybmA7XG5cbiAgICBib2FyZC5hcHBlbmRDaGlsZChwbGF5ZXJUaXRsZSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5ib2FyZEFycmF5LmZvckVhY2goKHJvdywgcm93SW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHJvd0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICByb3dEaXYuY2xhc3NMaXN0LmFkZChcInJvd0RpdlwiKTtcblxuICAgICAgcm93LmZvckVhY2goKGl0ZW0sIGNlbGxJbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiYm9hcmRDZWxsXCIpO1xuICAgICAgICBjZWxsLmlkID0gYCR7cGxheWVyQm9hcmQudHlwZX0gLSAke3Jvd0luZGV4fSwke2NlbGxJbmRleH1gO1xuICAgICAgICBjZWxsLmRhdGFzZXQuYm9hcmQgPSBwbGF5ZXJCb2FyZC50eXBlO1xuICAgICAgICBjZWxsLmRhdGFzZXQueCA9IHJvd0luZGV4O1xuICAgICAgICBjZWxsLmRhdGFzZXQueSA9IGNlbGxJbmRleDtcblxuICAgICAgICBpZiAocGxheWVyQm9hcmQgPT09IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQgJiYgaXRlbSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpdGVtICE9PSBcIm5vbmVcIikge1xuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNoaXBDZWxsXCIpO1xuXG4gICAgICAgICAgaWYgKGl0ZW0uaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgaWYgKGNlbGwudGV4dENvbnRlbnQgPT09IFwiXCIpIGdhbWUubW92ZUV2ZW50KGNlbGwpO1xuICAgICAgICB9KTtcblxuICAgICAgICByb3dEaXYuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICB9KTtcblxuICAgICAgYm9hcmQuYXBwZW5kQ2hpbGQocm93RGl2KTtcbiAgICB9KTtcblxuICAgIHBsYXllckJvYXJkLm1pc3Nlcy5mb3JFYWNoKChjb29yZGluYXRlcykgPT4ge1xuICAgICAgYXR0ZW1wdChjb29yZGluYXRlcywgcGxheWVyQm9hcmQpO1xuICAgIH0pO1xuICAgIHBsYXllckJvYXJkLmhpdHMuZm9yRWFjaCgoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGF0dGVtcHQoY29vcmRpbmF0ZXMsIHBsYXllckJvYXJkKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBhdHRlbXB0ID0gKGNvb3JkaW5hdGVzLCBnYW1lYm9hcmQpID0+IHtcbiAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcbiAgICBjb25zdCB0YXJnZXRDZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7Z2FtZWJvYXJkLnR5cGV9IC0gJHt4fSwke3l9YCk7XG4gICAgY29uc3QgaXNTaGlwID0gZ2FtZWJvYXJkLmlzU2hpcChjb29yZGluYXRlcyk7XG5cbiAgICBpZiAoaXNTaGlwKSB7XG4gICAgICB0YXJnZXRDZWxsLmlubmVySFRNTCA9IFwiSGl0XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldENlbGwuaW5uZXJIVE1MID0gXCJNaXNzXCI7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHN0b3BDbGlja3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheVwiKTtcblxuICAgIG92ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiYWxsXCI7XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRDbGlja3MgPSAoKSA9PiB7XG4gICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheVwiKTtcblxuICAgIG92ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICB9O1xuXG4gIGNvbnN0IHN0eWxlU3VuayA9IChib2FyZFR5cGUpID0+IHtcbiAgICBjb25zdCByb3dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yb3dEaXZcIik7XG4gICAgcm93cy5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIGNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5ib2FyZENlbGxcIik7XG4gICAgICBjZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgIGNvbnN0IFt4LCB5XSA9IFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldO1xuXG4gICAgICAgIGlmIChib2FyZFR5cGUgPT09IFwiVXNlclwiKSB7XG4gICAgICAgICAgaWYgKGdhbWUudXNlclBsYXllci5ib2FyZC5pc1NoaXAoW3gsIHldKSkge1xuICAgICAgICAgICAgY29uc3Qgc2hpcCA9IGdhbWUudXNlclBsYXllci5ib2FyZC5nZXRTaGlwKFt4LCB5XSk7XG4gICAgICAgICAgICBpZiAoc2hpcC5pc1N1bmsoKSkgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5pc1NoaXAoW3gsIHldKSkge1xuICAgICAgICAgICAgY29uc3Qgc2hpcCA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQuZ2V0U2hpcChbeCwgeV0pO1xuICAgICAgICAgICAgaWYgKHNoaXAuaXNTdW5rKCkpIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHRvZ2dsZVR1cm5CdG4gPSAoKSA9PiB7XG4gICAgY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcbiAgICBzd2l0Y2hUdXJuQnRuLmRpc2FibGVkID0gIXN3aXRjaFR1cm5CdG4uZGlzYWJsZWQ7XG4gIH07XG5cbiAgLy8gQ2hvb3NlIFNoaXAgTG9jYXRpb25zXG5cbiAgbGV0IGlzVmVydGljYWwgPSB0cnVlO1xuICBjb25zdCBzaGlwTGVuZ3RocyA9IFsyLCAzLCA0LCA1XTtcbiAgbGV0IGN1cnJlbnRTaGlwTGVuZ3RoID0gNTtcblxuICBjb25zdCBnZW5lcmF0ZUdyaWQgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRTY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0U2NyZWVuXCIpO1xuICAgIHN0YXJ0U2NyZWVuLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgIGNvbnN0IGZsaXBCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIGZsaXBCdXR0b24udGV4dENvbnRlbnQgPSBcIkZsaXAgU2hpcCBEaXJlY3Rpb25cIjtcbiAgICBmbGlwQnV0dG9uLmlkID0gXCJmbGlwQnRuXCI7XG5cbiAgICBjb25zdCBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgc3RhcnRCdXR0b24uaWQgPSBcInN0YXJ0QnRuXCI7XG4gICAgc3RhcnRCdXR0b24udGV4dENvbnRlbnQgPSBcIlN0YXJ0IEdhbWVcIjtcblxuICAgIGNvbnN0IGNob29zZVNoaXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDNcIik7XG4gICAgY2hvb3NlU2hpcC50ZXh0Q29udGVudCA9IGBDaG9vc2UgJHtjdXJyZW50U2hpcExlbmd0aH0gQ29vcmRpbmF0ZXNgO1xuICAgIGNob29zZVNoaXAuaWQgPSBcImNob29zZVNoaXBcIjtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdENlbGxcIik7XG4gICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcblxuICAgICAgICBjZWxsLmRhdGFzZXQueCA9IGk7XG4gICAgICAgIGNlbGwuZGF0YXNldC55ID0gajtcblxuICAgICAgICAvLyBjb25zdCBjb25mbGljdGluZyA9IChjaGVja0NlbGwpID0+IHtcbiAgICAgICAgLy8gICBmb3IgKHNoaXAgb2YgZ2FtZS5jb21wdXRlclBsYXllci5ib2FyZC5zaGlwcykge1xuICAgICAgICAvLyAgICAgZm9yIChjb29yZGluYXRlcyBvZiBzaGlwLnBhdGgpIHtcbiAgICAgICAgLy8gICAgICAgaWYgKFxuICAgICAgICAvLyAgICAgICAgIGNvb3JkaW5hdGVzWzBdID09PSBwYXJzZUludChjaGVja0NlbGwuZGF0YXNldC54KSAmJlxuICAgICAgICAvLyAgICAgICAgIGNvb3JkaW5hdGVzWzFdID09PSBwYXJzZUludChjaGVja0NlbGwuZGF0YXNldC55KVxuICAgICAgICAvLyAgICAgICApIHtcbiAgICAgICAgLy8gICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgLy8gICAgICAgfVxuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyAgIH1cbiAgICAgICAgLy8gICByZXR1cm4gZmFsc2U7XG4gICAgICAgIC8vIH07XG5cbiAgICAgICAgbGV0IGlzQ29uZmxpY3RlZCA9IGZhbHNlO1xuXG4gICAgICAgIGNvbnN0IGNvbmZsaWN0aW5nID0gKGNoZWNrQ2VsbCkgPT4ge1xuICAgICAgICAgIGlmIChjaGVja0NlbGwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdhbWUuY29tcHV0ZXJQbGF5ZXIuYm9hcmQuaXNTaGlwKFtcbiAgICAgICAgICAgICAgY2hlY2tDZWxsLmRhdGFzZXQueCxcbiAgICAgICAgICAgICAgY2hlY2tDZWxsLmRhdGFzZXQueSxcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcblxuICAgICAgICBjZWxsLm9ubW91c2VlbnRlciA9IChlKSA9PiB7XG4gICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInllbGxvd1wiO1xuICAgICAgICAgIGlmIChjb25mbGljdGluZyhjZWxsKSAmJiBjZWxsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJibGFja1wiO1xuICAgICAgICAgICAgaXNDb25mbGljdGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmb3IgKGxldCBrID0gMTsgayA8IGN1cnJlbnRTaGlwTGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgIGxldCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSwgaiArIGtdKTtcblxuICAgICAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2kgKyBrLCBqXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuZXdDZWxsICE9PSB1bmRlZmluZWQpIG5ld0NlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ5ZWxsb3dcIjtcbiAgICAgICAgICAgIGlmIChjb25mbGljdGluZyhuZXdDZWxsKSAmJiBuZXdDZWxsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbmV3Q2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImJsYWNrXCI7XG4gICAgICAgICAgICAgIGlzQ29uZmxpY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld0NlbGwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBpc0NvbmZsaWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjZWxsLm9ubW91c2VvdXQgPSAoZSkgPT4ge1xuICAgICAgICAgIGlzQ29uZmxpY3RlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgY2VsbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIlwiO1xuXG4gICAgICAgICAgZm9yIChsZXQgayA9IDE7IGsgPCBjdXJyZW50U2hpcExlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICBsZXQgbmV3Q2VsbCA9IGdldFNlbGVjdENlbGwoW2ksIGogKyBrXSk7XG5cbiAgICAgICAgICAgIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgIG5ld0NlbGwgPSBnZXRTZWxlY3RDZWxsKFtpICsgaywgal0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobmV3Q2VsbCAhPT0gdW5kZWZpbmVkKSBuZXdDZWxsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNlbGwub25jbGljayA9IChlKSA9PiB7XG4gICAgICAgICAgaWYgKCFpc0NvbmZsaWN0ZWQpIHtcbiAgICAgICAgICAgIGxldCBzaGlwQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAgICAgICAgIFtwYXJzZUludChjZWxsLmRhdGFzZXQueCksIHBhcnNlSW50KGNlbGwuZGF0YXNldC55KV0sXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBpZiAoY2VsbCAhPT0gdW5kZWZpbmVkKSBjZWxsLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RlZFwiKTtcblxuICAgICAgICAgICAgZm9yIChsZXQgayA9IDE7IGsgPCBjdXJyZW50U2hpcExlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgIGxldCBuZXdDZWxsID0gZ2V0U2VsZWN0Q2VsbChbaSwgaiArIGtdKTtcblxuICAgICAgICAgICAgICBpZiAoaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgIG5ld0NlbGwgPSBnZXRTZWxlY3RDZWxsKFtpICsgaywgal0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKG5ld0NlbGwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG5ld0NlbGwuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIHNoaXBDb29yZGluYXRlcy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgIHBhcnNlSW50KG5ld0NlbGwuZGF0YXNldC54KSxcbiAgICAgICAgICAgICAgICAgIHBhcnNlSW50KG5ld0NlbGwuZGF0YXNldC55KSxcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkLnBsYWNlU2hpcChTaGlwKHNoaXBDb29yZGluYXRlcykpO1xuXG4gICAgICAgICAgICBuZXh0U2hpcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQocm93RGl2KTtcbiAgICAgIHN0YXJ0U2NyZWVuLmFwcGVuZENoaWxkKGNob29zZVNoaXApO1xuICAgICAgc3RhcnRTY3JlZW4uYXBwZW5kQ2hpbGQoZmxpcEJ1dHRvbik7XG4gICAgICBzdGFydFNjcmVlbi5hcHBlbmRDaGlsZChzdGFydEJ1dHRvbik7XG5cbiAgICAgIHN0YXJ0QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHN0YXJ0RXZlbnQoc3RhcnRTY3JlZW4pO1xuICAgICAgICBzdGFydEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB9O1xuXG4gICAgICBmbGlwQnV0dG9uLm9uY2xpY2sgPSBmbGlwO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBuZXh0U2hpcCA9ICgpID0+IHtcbiAgICBjb25zdCBjaG9vc2VTaGlwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjaG9vc2VTaGlwXCIpO1xuXG4gICAgaWYgKFxuICAgICAgc2hpcExlbmd0aHMuZmluZCgobGVuZ3RoKSA9PiB7XG4gICAgICAgIHJldHVybiBsZW5ndGggPT09IGN1cnJlbnRTaGlwTGVuZ3RoIC0gMTtcbiAgICAgIH0pXG4gICAgKSB7XG4gICAgICBjdXJyZW50U2hpcExlbmd0aC0tO1xuICAgICAgY2hvb3NlU2hpcC50ZXh0Q29udGVudCA9IGBDaG9vc2UgJHtjdXJyZW50U2hpcExlbmd0aH0gQ29vcmRpbmF0ZXNgO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2VsZWN0Q2VsbFwiKTtcbiAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY2VsbC5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgICB9KTtcbiAgICAgIGNob29zZVNoaXAudGV4dENvbnRlbnQgPSBgQ2xpY2sgXCJTdGFydCBHYW1lXCIgdG8gQmVnaW4uYDtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0U2VsZWN0Q2VsbCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgY29uc3Qgc2VsZWN0Q2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNlbGVjdENlbGxcIik7XG4gICAgZm9yIChjb25zdCBzZWxlY3RDZWxsIG9mIHNlbGVjdENlbGxzKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHBhcnNlSW50KHNlbGVjdENlbGwuZGF0YXNldC54KSA9PT0geCAmJlxuICAgICAgICBwYXJzZUludChzZWxlY3RDZWxsLmRhdGFzZXQueSkgPT09IHlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gc2VsZWN0Q2VsbDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZmxpcCA9ICgpID0+IHtcbiAgICBpc1ZlcnRpY2FsID0gIWlzVmVydGljYWw7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJCb2FyZCxcbiAgICBhdHRlbXB0LFxuICAgIHN0b3BDbGlja3MsXG4gICAgc3RhcnRDbGlja3MsXG4gICAgc3R5bGVTdW5rLFxuICAgIHJlbmRlclN0YXJ0LFxuICAgIHRvZ2dsZVR1cm5CdG4sXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBVSTtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9TaGlwXCI7XG5pbXBvcnQgUGxheWVyIGZyb20gXCIuL1BsYXllclwiO1xuaW1wb3J0IFVJIGZyb20gXCIuL1VJXCI7XG5cbmNvbnN0IGdhbWUgPSAoKCkgPT4ge1xuICBjb25zdCBjb21wdXRlclBsYXllciA9IFBsYXllcihcIkNvbXB1dGVyXCIpO1xuICBjb25zdCB1c2VyUGxheWVyID0gUGxheWVyKFwiVXNlclwiKTtcblxuICBsZXQgY3VycmVudFBsYXllciA9IHVzZXJQbGF5ZXI7XG5cbiAgY29uc3Qgc3dpdGNoVHVybiA9ICgpID0+IHtcbiAgICBpZiAoZ2FtZS5jdXJyZW50UGxheWVyID09PSB1c2VyUGxheWVyKSB7XG4gICAgICBnYW1lLmN1cnJlbnRQbGF5ZXIgPSBjb21wdXRlclBsYXllcjtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2FtZS5jdXJyZW50UGxheWVyID0gdXNlclBsYXllcjtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgY2hlY2tMb3NzID0gKHBsYXllcikgPT4ge1xuICAgIGNvbnN0IGFsbFN1bmsgPVxuICAgICAgcGxheWVyLmJvYXJkLnNoaXBzLmxlbmd0aCA+IDAgJiZcbiAgICAgIHBsYXllci5ib2FyZC5zaGlwcy5ldmVyeSgoc2hpcCkgPT4ge1xuICAgICAgICByZXR1cm4gc2hpcC5pc1N1bmsoKTtcbiAgICAgIH0pO1xuXG4gICAgaWYgKGFsbFN1bmspIGFsZXJ0KGAke2N1cnJlbnRQbGF5ZXIudHlwZX0gd2luc2ApO1xuICB9O1xuXG4gIGNvbnN0IG1vdmVFdmVudCA9IChjZWxsKSA9PiB7XG4gICAgVUkuc3RvcENsaWNrcygpO1xuICAgIGNvbnN0IGNlbGxCb2FyZCA9XG4gICAgICBjZWxsLmRhdGFzZXQuYm9hcmQgPT09IFwiQ29tcHV0ZXJcIlxuICAgICAgICA/IGNvbXB1dGVyUGxheWVyLmJvYXJkXG4gICAgICAgIDogdXNlclBsYXllci5ib2FyZDtcblxuICAgIGNlbGxCb2FyZC5yZWNlaXZlQXR0YWNrKFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldLCBjdXJyZW50UGxheWVyKTtcbiAgICBVSS5hdHRlbXB0KFtjZWxsLmRhdGFzZXQueCwgY2VsbC5kYXRhc2V0LnldLCBjZWxsQm9hcmQpO1xuICAgIFVJLnN0eWxlU3VuayhjZWxsQm9hcmQudHlwZSk7XG4gICAgY2hlY2tMb3NzKGN1cnJlbnRQbGF5ZXIpO1xuICAgIGdhbWUuc3dpdGNoVHVybigpO1xuICAgIFVJLnRvZ2dsZVR1cm5CdG4oKTtcbiAgfTtcblxuICBjb25zdCBjb21wdXRlck1vdmVFdmVudCA9IGFzeW5jICgpID0+IHtcbiAgICBVSS5zdG9wQ2xpY2tzKCk7XG5cbiAgICBjb25zb2xlLmxvZyhjb21wdXRlclBsYXllci5ib2FyZC5nZXRMYXN0SGl0KCkpO1xuXG4gICAgY29uc3QgZGVsYXkgPSAobWlsbGlzZWNvbmRzKSA9PiB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCBtaWxsaXNlY29uZHMpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGF3YWl0IGRlbGF5KDc1MCk7XG5cbiAgICBjb25zdCBjb29yZGluYXRlcyA9IGdhbWUuY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVNb3ZlKCk7XG5cbiAgICBjb25zdCBjZWxsQm9hcmQgPSBnYW1lLmNvbXB1dGVyUGxheWVyLmJvYXJkO1xuICAgIGNlbGxCb2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGVzLCBnYW1lLmNvbXB1dGVyUGxheWVyKTtcbiAgICBVSS5hdHRlbXB0KGNvb3JkaW5hdGVzLCBjZWxsQm9hcmQpO1xuICAgIFVJLnN0eWxlU3VuayhjZWxsQm9hcmQudHlwZSk7XG4gICAgZ2FtZS5jaGVja0xvc3MoZ2FtZS5jdXJyZW50UGxheWVyKTtcbiAgICBnYW1lLnN3aXRjaFR1cm4oKTtcbiAgICBVSS50b2dnbGVUdXJuQnRuKCk7XG4gIH07XG5cbiAgY29uc3Qgc2V0Q29tcHV0ZXJTaGlwcyA9ICgpID0+IHtcbiAgICBnYW1lLnVzZXJQbGF5ZXIuYm9hcmQucGxhY2VTaGlwKFNoaXAoY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVSYW5kb21QYXRoKDIpKSk7XG4gICAgZ2FtZS51c2VyUGxheWVyLmJvYXJkLnBsYWNlU2hpcChTaGlwKGNvbXB1dGVyUGxheWVyLmdlbmVyYXRlUmFuZG9tUGF0aCgzKSkpO1xuICAgIGdhbWUudXNlclBsYXllci5ib2FyZC5wbGFjZVNoaXAoU2hpcChjb21wdXRlclBsYXllci5nZW5lcmF0ZVJhbmRvbVBhdGgoNCkpKTtcbiAgICBnYW1lLnVzZXJQbGF5ZXIuYm9hcmQucGxhY2VTaGlwKFNoaXAoY29tcHV0ZXJQbGF5ZXIuZ2VuZXJhdGVSYW5kb21QYXRoKDUpKSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICAvLyBpbml0R2FtZSxcbiAgICBzd2l0Y2hUdXJuLFxuICAgIGNvbXB1dGVyUGxheWVyLFxuICAgIHVzZXJQbGF5ZXIsXG4gICAgY3VycmVudFBsYXllcixcbiAgICBjaGVja0xvc3MsXG4gICAgbW92ZUV2ZW50LFxuICAgIGNvbXB1dGVyTW92ZUV2ZW50LFxuICAgIHNldENvbXB1dGVyU2hpcHMsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9tb2R1bGVzL0dhbWVib2FyZC5qc1wiO1xuaW1wb3J0IFNoaXAgZnJvbSBcIi4vbW9kdWxlcy9TaGlwLmpzXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9tb2R1bGVzL2dhbWUuanNcIjtcbmltcG9ydCBVSSBmcm9tIFwiLi9tb2R1bGVzL1VJLmpzXCI7XG5cbi8vIGdhbWUuaW5pdEdhbWUoKTtcbmNvbnN0IHN3aXRjaFR1cm5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN3aXRjaFR1cm5CdG5cIik7XG5VSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xuVUkucmVuZGVyU3RhcnQoKTtcbmdhbWUuc2V0Q29tcHV0ZXJTaGlwcygpO1xuXG5zd2l0Y2hUdXJuQnRuLm9uY2xpY2sgPSAoKSA9PiB7XG4gIFVJLnRvZ2dsZVR1cm5CdG4oKTtcblxuICBVSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xuXG4gIGlmIChnYW1lLmN1cnJlbnRQbGF5ZXIgPT09IGdhbWUuY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICBnYW1lLmNvbXB1dGVyTW92ZUV2ZW50KCk7XG4gIH0gZWxzZSB7XG4gICAgVUkuc3RhcnRDbGlja3MoKTtcbiAgfVxufTtcbiJdLCJuYW1lcyI6WyJwYXRoIiwiaGl0cyIsImdldExlbmd0aCIsImNvdW50IiwiZm9yRWFjaCIsImVsZW1lbnQiLCJpc1N1bmsiLCJoaXQiLCJnZXRIaXRzIiwiZ2V0UGF0aCIsInJlc2V0SGl0cyIsInR5cGUiLCJhdHRlbXB0cyIsImJvYXJkIiwiYm9hcmRBcnJheSIsIkFycmF5IiwibWFwIiwiZSIsImZpbGwiLCJtaXNzZXMiLCJzaGlwcyIsImxhc3RIaXQiLCJhZGRTaGlwIiwic2hpcCIsInB1c2giLCJzZXRMYXN0SGl0IiwiY29vcmRpbmF0ZXMiLCJwbGFjZVNoaXAiLCJzaGlwT2JqZWN0IiwieCIsInkiLCJyZWNlaXZlQXR0YWNrIiwiYWxyZWFkeUhpdCIsImFscmVhZHlNaXNzIiwic29tZSIsIml0ZW0iLCJ4SXRlbSIsInlJdGVtIiwiY29uc29sZSIsImxvZyIsInJlc2V0R2FtZWJvYXJkIiwiaXNTaGlwIiwiZ2V0U2hpcCIsImdldExhc3RIaXQiLCJhdHRlbXB0IiwiZ2VuZXJhdGVNb3ZlIiwiZ2V0UmFuZG9tSW50IiwibWF4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiY2hlY2tBdHRlbXB0ZWQiLCJjb29yZGluYXRlIiwibW92ZSIsImxlbmd0aCIsIm9wdGlvbnMiLCJvcHRpb24iLCJ4TGFzdCIsInlMYXN0IiwibmV3WCIsIm5ld1kiLCJuZXdNb3ZlIiwiZ2V0RW1wdHlBZGphY2VudCIsImdlbmVyYXRlUmFuZG9tUGF0aCIsInNoaXBMZW5ndGgiLCJob3Jpem9udGFsIiwiaSIsIlVJIiwiZ2FtZWJvYXJkIiwidGFyZ2V0Q2VsbCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJpc1ZlcnRpY2FsIiwic2hpcExlbmd0aHMiLCJjdXJyZW50U2hpcExlbmd0aCIsIm5leHRTaGlwIiwiY2hvb3NlU2hpcCIsImZpbmQiLCJ0ZXh0Q29udGVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjZWxsIiwic3R5bGUiLCJwb2ludGVyRXZlbnRzIiwiZ2V0U2VsZWN0Q2VsbCIsInNlbGVjdENlbGxzIiwic2VsZWN0Q2VsbCIsInBhcnNlSW50IiwiZGF0YXNldCIsImZsaXAiLCJyZW5kZXJCb2FyZCIsInBsYXllckJvYXJkIiwicGxheWVyVGl0bGUiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJyb3ciLCJyb3dJbmRleCIsInJvd0RpdiIsImNsYXNzTGlzdCIsImFkZCIsImNlbGxJbmRleCIsImlkIiwiY29tcHV0ZXJQbGF5ZXIiLCJiYWNrZ3JvdW5kQ29sb3IiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcFByb3BhZ2F0aW9uIiwibW92ZUV2ZW50Iiwic3RvcENsaWNrcyIsInN0YXJ0Q2xpY2tzIiwic3R5bGVTdW5rIiwiYm9hcmRUeXBlIiwidXNlclBsYXllciIsInJlbmRlclN0YXJ0IiwiZGlzcGxheSIsInN0YXJ0U2NyZWVuIiwiZmxpcEJ1dHRvbiIsInN0YXJ0QnV0dG9uIiwiaiIsImlzQ29uZmxpY3RlZCIsImNvbmZsaWN0aW5nIiwiY2hlY2tDZWxsIiwidW5kZWZpbmVkIiwib25tb3VzZWVudGVyIiwiayIsIm5ld0NlbGwiLCJvbm1vdXNlb3V0Iiwib25jbGljayIsInNoaXBDb29yZGluYXRlcyIsImdlbmVyYXRlR3JpZCIsInRvZ2dsZVR1cm5CdG4iLCJzd2l0Y2hUdXJuQnRuIiwiZGlzYWJsZWQiLCJnYW1lIiwiY3VycmVudFBsYXllciIsImNoZWNrTG9zcyIsInBsYXllciIsImV2ZXJ5IiwiYWxlcnQiLCJzd2l0Y2hUdXJuIiwiY2VsbEJvYXJkIiwiY29tcHV0ZXJNb3ZlRXZlbnQiLCJhc3luYyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInNldENvbXB1dGVyU2hpcHMiXSwic291cmNlUm9vdCI6IiJ9