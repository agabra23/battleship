(()=>{"use strict";const t=function(t){let e=0;const r=()=>{let e=0;return t.forEach((t=>{e++})),e};return{getLength:r,isSunk:()=>e>=r(),hit:()=>{e++},getHits:()=>e,getPath:()=>t,resetHits:()=>{e=0},hits:e}},e=e=>{const r=[],n=function(e){const r=[...Array(10)].map((t=>Array(10).fill("none"))),n=[],o=[];let s=[];const a=t=>{t.getPath().forEach((e=>{const[n,o]=e;r[n][o]=t})),c(t)},c=t=>{s.push(t)};return{placeShip:a,boardArray:r,receiveAttack:t=>{const[e,s]=t;let a,c=!1;a=n.some((e=>{const[r,n]=e;return r===t[0]&&n===t[1]})),c=o.some((e=>{const[r,n]=e;return r===t[0]&&n===t[1]})),"none"!==r[e][s]&&!1===a?(r[e][s].hit(),n.push(t)):"none"===r[e][s]&&!1===c&&o.push(t)},hits:n,misses:o,addShip:c,resetGameboard:()=>{n=[],o=[],s=[]},initBoard:()=>{a(t([[1,4],[1,5]])),a(t([[6,4],[6,5],[6,6]])),a(t([[4,2],[5,2],[6,2],[7,2]])),a(t([[8,3],[8,4],[8,5],[8,6],[8,7]])),a(t([[2,3],[2,4],[2,5],[2,6],[2,7]]))},isShip:t=>{const[e,n]=t;return"none"!==r[e][n]},getShip:t=>{const[e,n]=t;return r[e][n]},ships:s,type:e}}(e),o=t=>{r.push(t)};return"computer"===e?{attempt:o,generateMove:()=>{const t=t=>Math.floor(Math.random()*t),e=t=>r.some((e=>{const[r,n]=e;return r===t[0]&&n===t[1]}));let n=[t(9),t(9)];for(;e(n);)n=[t(9),t(9)];return n},board:n,type:e}:{attempt:o,board:n,type:e}},r=(()=>{const t=(t,e)=>{const[r,n]=t,o=document.getElementById(`${e.type} - ${r},${n}`),s=e.isShip(t);o.innerHTML=s?"Hit":"Miss"};return{renderBoard:e=>{const r=document.getElementById("board");r.innerHTML='<div id="overlay"></div>';const n=document.createElement("h3");console.log(e),n.innerHTML=`${e.type}`,r.appendChild(n),e.boardArray.forEach(((t,n)=>{const s=document.createElement("div");s.classList.add("rowDiv"),t.forEach(((t,r)=>{const a=document.createElement("div");a.classList.add("boardCell"),a.id=`${e.type} - ${n},${r}`,a.dataset.board=e.type,a.dataset.x=n,a.dataset.y=r,"none"!==t&&a.classList.add("shipCell"),a.addEventListener("click",(t=>{t.stopPropagation(),""===a.textContent&&o.moveEvent(a)})),s.appendChild(a)})),r.appendChild(s)})),e.misses.forEach((r=>{t(r,e)})),e.hits.forEach((r=>{t(r,e)}))},attempt:t,stopClicks:()=>{document.getElementById("overlay").style.pointerEvents="all"},startClicks:()=>{document.getElementById("overlay").style.pointerEvents="none"}}})(),n=(()=>{const t=e("computer"),o=e("user");let s=t;const a=t=>{t.board.ships.every((t=>t.isSunk()))&&alert("win")};return{initGame:()=>{const e=o.board;t.board.initBoard(),e.initBoard()},switchTurn:()=>{console.log("start switch",n.currentPlayer.type),n.currentPlayer===o?n.currentPlayer=t:n.currentPlayer=o,console.log("end switch",n.currentPlayer.type)},computerPlayer:t,userPlayer:o,currentPlayer:s,checkLoss:a,moveEvent:e=>{r.stopClicks();const c="computer"===e.dataset.board?t.board:o.board;c.receiveAttack([e.dataset.x,e.dataset.y]),r.attempt([e.dataset.x,e.dataset.y],c),a(s),n.switchTurn()}}})(),o=n;o.initGame();const s=document.getElementById("switchTurnBtn");r.renderBoard(o.currentPlayer.board),s.onclick=()=>{r.startClicks(),r.renderBoard(o.currentPlayer.board)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNZSxFQUNtQixhQUF2QnRCLEVBQUtFLFFBQVF6RCxNQUNUbUUsRUFBZW5FLE1BQ2ZvRSxFQUFXcEUsTUFFakI2RSxFQUFVN0QsY0FBYyxDQUFDdUMsRUFBS0UsUUFBUTlDLEVBQUc0QyxFQUFLRSxRQUFRN0MsSUFDdEQsRUFBR2UsUUFBUSxDQUFDNEIsRUFBS0UsUUFBUTlDLEVBQUc0QyxFQUFLRSxRQUFRN0MsR0FBSWlFLEdBQzdDUCxFQUFVRCxHQUNWSCxFQUFLVSxZQUFZLEVBWXBCLEVBdERZLEdBd0RiLElDeERBLEVBQUtGLFdBQ0wsTUFBTUksRUFBZ0J2QyxTQUFTQyxlQUFlLGlCQUM5QyxFQUFHRSxZQUFZLEVBQUsyQixjQUFjckUsT0FFbEM4RSxFQUFjQyxRQUFVLEtBQ3RCLEVBQUdkLGNBRUgsRUFBR3ZCLFlBQVksRUFBSzJCLGNBQWNyRSxNQUFNLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1VJLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gIGxldCBoaXRzID0gMDtcblxuICBjb25zdCBnZXRIaXRzID0gKCkgPT4ge1xuICAgIHJldHVybiBoaXRzO1xuICB9O1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzKys7XG4gIH07XG5cbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4ge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgcGF0aC5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBjb3VudCsrO1xuICAgIH0pO1xuICAgIHJldHVybiBjb3VudDtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGhpdHMgPj0gZ2V0TGVuZ3RoKCk7XG4gIH07XG5cbiAgY29uc3QgZ2V0UGF0aCA9ICgpID0+IHtcbiAgICByZXR1cm4gcGF0aDtcbiAgfTtcblxuICBjb25zdCByZXNldEhpdHMgPSAoKSA9PiB7XG4gICAgaGl0cyA9IDA7XG4gIH07XG5cbiAgcmV0dXJuIHsgZ2V0TGVuZ3RoLCBpc1N1bmssIGhpdCwgZ2V0SGl0cywgZ2V0UGF0aCwgcmVzZXRIaXRzLCBoaXRzIH07XG59O1xuZXhwb3J0IGRlZmF1bHQgU2hpcDtcbiIsImltcG9ydCBHYW1lYm9hcmQgZnJvbSBcIi4vR2FtZWJvYXJkXCI7XG5cbmNvbnN0IFBsYXllciA9ICh0eXBlKSA9PiB7XG4gIGNvbnN0IGF0dGVtcHRzID0gW107XG4gIGNvbnN0IHR1cm4gPSBmYWxzZTtcbiAgY29uc3QgYm9hcmQgPSBHYW1lYm9hcmQodHlwZSk7XG5cbiAgY29uc3QgYXR0ZW1wdCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGF0dGVtcHRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICB9O1xuXG4gIGNvbnN0IGdlbmVyYXRlTW92ZSA9ICgpID0+IHtcbiAgICBjb25zdCBnZXRSYW5kb21JbnQgPSAobWF4KSA9PiB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KTtcbiAgICB9O1xuXG4gICAgY29uc3QgY2hlY2tBdHRlbXB0ZWQgPSAoYXR0ZW1wdCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXR0ZW1wdHMuc29tZSgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlO1xuXG4gICAgICAgIHJldHVybiB4ID09PSBhdHRlbXB0WzBdICYmIHkgPT09IGF0dGVtcHRbMV07XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgbGV0IG1vdmUgPSBbZ2V0UmFuZG9tSW50KDkpLCBnZXRSYW5kb21JbnQoOSldO1xuXG4gICAgd2hpbGUgKGNoZWNrQXR0ZW1wdGVkKG1vdmUpKSB7XG4gICAgICBtb3ZlID0gW2dldFJhbmRvbUludCg5KSwgZ2V0UmFuZG9tSW50KDkpXTtcbiAgICB9XG5cbiAgICByZXR1cm4gbW92ZTtcbiAgfTtcblxuICBpZiAodHlwZSA9PT0gXCJjb21wdXRlclwiKSByZXR1cm4geyBhdHRlbXB0LCBnZW5lcmF0ZU1vdmUsIGJvYXJkLCB0eXBlIH07XG5cbiAgcmV0dXJuIHsgYXR0ZW1wdCwgYm9hcmQsIHR5cGUgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFBsYXllcjtcbiIsImltcG9ydCBTaGlwIGZyb20gXCIuL1NoaXAuanNcIjtcblxuY29uc3QgR2FtZWJvYXJkID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgY29uc3QgYm9hcmRBcnJheSA9IFsuLi5BcnJheSgxMCldLm1hcCgoZSkgPT4gQXJyYXkoMTApLmZpbGwoXCJub25lXCIpKTtcbiAgY29uc3QgaGl0cyA9IFtdO1xuICBjb25zdCBtaXNzZXMgPSBbXTtcbiAgbGV0IHNoaXBzID0gW107XG5cbiAgY29uc3QgaW5pdEJvYXJkID0gKCkgPT4ge1xuICAgIHBsYWNlU2hpcChcbiAgICAgIFNoaXAoW1xuICAgICAgICBbMSwgNF0sXG4gICAgICAgIFsxLCA1XSxcbiAgICAgIF0pXG4gICAgKTtcbiAgICBwbGFjZVNoaXAoXG4gICAgICBTaGlwKFtcbiAgICAgICAgWzYsIDRdLFxuICAgICAgICBbNiwgNV0sXG4gICAgICAgIFs2LCA2XSxcbiAgICAgIF0pXG4gICAgKTtcbiAgICBwbGFjZVNoaXAoXG4gICAgICBTaGlwKFtcbiAgICAgICAgWzQsIDJdLFxuICAgICAgICBbNSwgMl0sXG4gICAgICAgIFs2LCAyXSxcbiAgICAgICAgWzcsIDJdLFxuICAgICAgXSlcbiAgICApO1xuXG4gICAgcGxhY2VTaGlwKFxuICAgICAgU2hpcChbXG4gICAgICAgIFs4LCAzXSxcbiAgICAgICAgWzgsIDRdLFxuICAgICAgICBbOCwgNV0sXG4gICAgICAgIFs4LCA2XSxcbiAgICAgICAgWzgsIDddLFxuICAgICAgXSlcbiAgICApO1xuICAgIHBsYWNlU2hpcChcbiAgICAgIFNoaXAoW1xuICAgICAgICBbMiwgM10sXG4gICAgICAgIFsyLCA0XSxcbiAgICAgICAgWzIsIDVdLFxuICAgICAgICBbMiwgNl0sXG4gICAgICAgIFsyLCA3XSxcbiAgICAgIF0pXG4gICAgKTtcbiAgfTtcblxuICBjb25zdCByZXNldEdhbWVib2FyZCA9ICgpID0+IHtcbiAgICBoaXRzID0gW107XG4gICAgbWlzc2VzID0gW107XG4gICAgc2hpcHMgPSBbXTtcbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcE9iamVjdCkgPT4ge1xuICAgIGNvbnN0IHBhdGggPSBzaGlwT2JqZWN0LmdldFBhdGgoKTtcbiAgICBwYXRoLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBjb25zdCBbeCwgeV0gPSBjb29yZGluYXRlcztcbiAgICAgIGJvYXJkQXJyYXlbeF1beV0gPSBzaGlwT2JqZWN0O1xuICAgIH0pO1xuICAgIGFkZFNoaXAoc2hpcE9iamVjdCk7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgbGV0IGFscmVhZHlIaXQsXG4gICAgICBhbHJlYWR5TWlzcyA9IGZhbHNlO1xuXG4gICAgYWxyZWFkeUhpdCA9IGhpdHMuc29tZSgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgW3hJdGVtLCB5SXRlbV0gPSBpdGVtO1xuICAgICAgcmV0dXJuIHhJdGVtID09PSBjb29yZGluYXRlc1swXSAmJiB5SXRlbSA9PT0gY29vcmRpbmF0ZXNbMV07XG4gICAgfSk7XG4gICAgYWxyZWFkeU1pc3MgPSBtaXNzZXMuc29tZSgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgW3hJdGVtLCB5SXRlbV0gPSBpdGVtO1xuICAgICAgcmV0dXJuIHhJdGVtID09PSBjb29yZGluYXRlc1swXSAmJiB5SXRlbSA9PT0gY29vcmRpbmF0ZXNbMV07XG4gICAgfSk7XG5cbiAgICBpZiAoYm9hcmRBcnJheVt4XVt5XSAhPT0gXCJub25lXCIgJiYgYWxyZWFkeUhpdCA9PT0gZmFsc2UpIHtcbiAgICAgIGJvYXJkQXJyYXlbeF1beV0uaGl0KCk7XG4gICAgICBoaXRzLnB1c2goY29vcmRpbmF0ZXMpO1xuICAgIH0gZWxzZSBpZiAoYm9hcmRBcnJheVt4XVt5XSA9PT0gXCJub25lXCIgJiYgYWxyZWFkeU1pc3MgPT09IGZhbHNlKSB7XG4gICAgICBtaXNzZXMucHVzaChjb29yZGluYXRlcyk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGFkZFNoaXAgPSAoc2hpcCkgPT4ge1xuICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gIH07XG5cbiAgY29uc3QgaXNTaGlwID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG5cbiAgICByZXR1cm4gYm9hcmRBcnJheVt4XVt5XSAhPT0gXCJub25lXCI7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IFt4LCB5XSA9IGNvb3JkaW5hdGVzO1xuXG4gICAgcmV0dXJuIGJvYXJkQXJyYXlbeF1beV07XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBwbGFjZVNoaXAsXG4gICAgYm9hcmRBcnJheSxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGhpdHMsXG4gICAgbWlzc2VzLFxuICAgIGFkZFNoaXAsXG4gICAgcmVzZXRHYW1lYm9hcmQsXG4gICAgaW5pdEJvYXJkLFxuICAgIGlzU2hpcCxcbiAgICBnZXRTaGlwLFxuICAgIHNoaXBzLFxuICAgIHR5cGUsXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBHYW1lYm9hcmQ7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL0dhbWVib2FyZFwiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi9QbGF5ZXJcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuL1NoaXBcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL2dhbWVcIjtcblxuY29uc3QgVUkgPSAoKCkgPT4ge1xuICBjb25zdCByZW5kZXJCb2FyZCA9IChwbGF5ZXJCb2FyZCkgPT4ge1xuICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJib2FyZFwiKTtcbiAgICBib2FyZC5pbm5lckhUTUwgPSBgPGRpdiBpZD1cIm92ZXJsYXlcIj48L2Rpdj5gO1xuXG4gICAgY29uc3QgcGxheWVyVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDNcIik7XG4gICAgY29uc29sZS5sb2cocGxheWVyQm9hcmQpO1xuICAgIHBsYXllclRpdGxlLmlubmVySFRNTCA9IGAke3BsYXllckJvYXJkLnR5cGV9YDtcblxuICAgIGJvYXJkLmFwcGVuZENoaWxkKHBsYXllclRpdGxlKTtcblxuICAgIHBsYXllckJvYXJkLmJvYXJkQXJyYXkuZm9yRWFjaCgocm93LCByb3dJbmRleCkgPT4ge1xuICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHJvd0Rpdi5jbGFzc0xpc3QuYWRkKFwicm93RGl2XCIpO1xuXG4gICAgICByb3cuZm9yRWFjaCgoaXRlbSwgY2VsbEluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJib2FyZENlbGxcIik7XG4gICAgICAgIGNlbGwuaWQgPSBgJHtwbGF5ZXJCb2FyZC50eXBlfSAtICR7cm93SW5kZXh9LCR7Y2VsbEluZGV4fWA7XG4gICAgICAgIGNlbGwuZGF0YXNldC5ib2FyZCA9IHBsYXllckJvYXJkLnR5cGU7XG4gICAgICAgIGNlbGwuZGF0YXNldC54ID0gcm93SW5kZXg7XG4gICAgICAgIGNlbGwuZGF0YXNldC55ID0gY2VsbEluZGV4O1xuICAgICAgICBpZiAoaXRlbSAhPT0gXCJub25lXCIpIGNlbGwuY2xhc3NMaXN0LmFkZChcInNoaXBDZWxsXCIpO1xuXG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgLy8gYWRqdXN0IHRoaXMuIE1heWJlIG1ha2UgaXQgYSBwbGF5Um91bmQgdGhpbmcgdG8ga2ljayBvZmYgYSByb3VuZCBhbmQgZW5kIGl0IHdpdGggYSB0dXJuIHN3aXRjaC5cbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIGlmIChjZWxsLnRleHRDb250ZW50ID09PSBcIlwiKSBnYW1lLm1vdmVFdmVudChjZWxsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcm93RGl2LmFwcGVuZENoaWxkKGNlbGwpO1xuICAgICAgfSk7XG5cbiAgICAgIGJvYXJkLmFwcGVuZENoaWxkKHJvd0Rpdik7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXJCb2FyZC5taXNzZXMuZm9yRWFjaCgoY29vcmRpbmF0ZXMpID0+IHtcbiAgICAgIGF0dGVtcHQoY29vcmRpbmF0ZXMsIHBsYXllckJvYXJkKTtcbiAgICB9KTtcbiAgICBwbGF5ZXJCb2FyZC5oaXRzLmZvckVhY2goKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgICBhdHRlbXB0KGNvb3JkaW5hdGVzLCBwbGF5ZXJCb2FyZCk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgYXR0ZW1wdCA9IChjb29yZGluYXRlcywgZ2FtZWJvYXJkKSA9PiB7XG4gICAgY29uc3QgW3gsIHldID0gY29vcmRpbmF0ZXM7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2dhbWVib2FyZC50eXBlfSAtICR7eH0sJHt5fWApO1xuICAgIGNvbnN0IGlzU2hpcCA9IGdhbWVib2FyZC5pc1NoaXAoY29vcmRpbmF0ZXMpO1xuXG4gICAgaWYgKGlzU2hpcCkge1xuICAgICAgdGFyZ2V0Q2VsbC5pbm5lckhUTUwgPSBcIkhpdFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0YXJnZXRDZWxsLmlubmVySFRNTCA9IFwiTWlzc1wiO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzdG9wQ2xpY2tzID0gKCkgPT4ge1xuICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm92ZXJsYXlcIik7XG5cbiAgICBvdmVybGF5LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImFsbFwiO1xuICB9O1xuXG4gIGNvbnN0IHN0YXJ0Q2xpY2tzID0gKCkgPT4ge1xuICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm92ZXJsYXlcIik7XG5cbiAgICBvdmVybGF5LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcbiAgfTtcblxuICByZXR1cm4geyByZW5kZXJCb2FyZCwgYXR0ZW1wdCwgc3RvcENsaWNrcywgc3RhcnRDbGlja3MgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFVJO1xuIiwiaW1wb3J0IEdhbWVib2FyZCBmcm9tIFwiLi9HYW1lYm9hcmRcIjtcbmltcG9ydCBTaGlwIGZyb20gXCIuL1NoaXBcIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vUGxheWVyXCI7XG5pbXBvcnQgVUkgZnJvbSBcIi4vVUlcIjtcblxuY29uc3QgZ2FtZSA9ICgoKSA9PiB7XG4gIGNvbnN0IGNvbXB1dGVyUGxheWVyID0gUGxheWVyKFwiY29tcHV0ZXJcIik7XG4gIGNvbnN0IHVzZXJQbGF5ZXIgPSBQbGF5ZXIoXCJ1c2VyXCIpO1xuXG4gIGxldCBjdXJyZW50UGxheWVyID0gY29tcHV0ZXJQbGF5ZXI7XG5cbiAgY29uc3QgaW5pdEdhbWUgPSAoKSA9PiB7XG4gICAgY29uc3QgdXNlckJvYXJkID0gdXNlclBsYXllci5ib2FyZDtcbiAgICBjb25zdCBjb21wdXRlckJvYXJkID0gY29tcHV0ZXJQbGF5ZXIuYm9hcmQ7XG4gICAgY29tcHV0ZXJCb2FyZC5pbml0Qm9hcmQoKTtcbiAgICB1c2VyQm9hcmQuaW5pdEJvYXJkKCk7XG4gIH07XG5cbiAgY29uc3Qgc3dpdGNoVHVybiA9ICgpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcInN0YXJ0IHN3aXRjaFwiLCBnYW1lLmN1cnJlbnRQbGF5ZXIudHlwZSk7XG4gICAgaWYgKGdhbWUuY3VycmVudFBsYXllciA9PT0gdXNlclBsYXllcikge1xuICAgICAgZ2FtZS5jdXJyZW50UGxheWVyID0gY29tcHV0ZXJQbGF5ZXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdhbWUuY3VycmVudFBsYXllciA9IHVzZXJQbGF5ZXI7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCJlbmQgc3dpdGNoXCIsIGdhbWUuY3VycmVudFBsYXllci50eXBlKTtcbiAgfTtcblxuICBjb25zdCBjaGVja0xvc3MgPSAocGxheWVyKSA9PiB7XG4gICAgY29uc3QgYWxsU3VuayA9IHBsYXllci5ib2FyZC5zaGlwcy5ldmVyeSgoc2hpcCkgPT4ge1xuICAgICAgcmV0dXJuIHNoaXAuaXNTdW5rKCk7XG4gICAgfSk7XG5cbiAgICBpZiAoYWxsU3VuaykgYWxlcnQoXCJ3aW5cIik7XG4gIH07XG5cbiAgY29uc3QgbW92ZUV2ZW50ID0gKGNlbGwpID0+IHtcbiAgICBVSS5zdG9wQ2xpY2tzKCk7XG4gICAgY29uc3QgY2VsbEJvYXJkID1cbiAgICAgIGNlbGwuZGF0YXNldC5ib2FyZCA9PT0gXCJjb21wdXRlclwiXG4gICAgICAgID8gY29tcHV0ZXJQbGF5ZXIuYm9hcmRcbiAgICAgICAgOiB1c2VyUGxheWVyLmJvYXJkO1xuXG4gICAgY2VsbEJvYXJkLnJlY2VpdmVBdHRhY2soW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV0pO1xuICAgIFVJLmF0dGVtcHQoW2NlbGwuZGF0YXNldC54LCBjZWxsLmRhdGFzZXQueV0sIGNlbGxCb2FyZCk7XG4gICAgY2hlY2tMb3NzKGN1cnJlbnRQbGF5ZXIpO1xuICAgIGdhbWUuc3dpdGNoVHVybigpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdEdhbWUsXG4gICAgc3dpdGNoVHVybixcbiAgICBjb21wdXRlclBsYXllcixcbiAgICB1c2VyUGxheWVyLFxuICAgIGN1cnJlbnRQbGF5ZXIsXG4gICAgY2hlY2tMb3NzLFxuICAgIG1vdmVFdmVudCxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWU7XG4iLCJpbXBvcnQgR2FtZWJvYXJkIGZyb20gXCIuL21vZHVsZXMvR2FtZWJvYXJkLmpzXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9tb2R1bGVzL1NoaXAuanNcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL21vZHVsZXMvZ2FtZS5qc1wiO1xuaW1wb3J0IFVJIGZyb20gXCIuL21vZHVsZXMvVUkuanNcIjtcblxuZ2FtZS5pbml0R2FtZSgpO1xuY29uc3Qgc3dpdGNoVHVybkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3dpdGNoVHVybkJ0blwiKTtcblVJLnJlbmRlckJvYXJkKGdhbWUuY3VycmVudFBsYXllci5ib2FyZCk7XG5cbnN3aXRjaFR1cm5CdG4ub25jbGljayA9ICgpID0+IHtcbiAgVUkuc3RhcnRDbGlja3MoKTtcblxuICBVSS5yZW5kZXJCb2FyZChnYW1lLmN1cnJlbnRQbGF5ZXIuYm9hcmQpO1xufTtcbiJdLCJuYW1lcyI6WyJwYXRoIiwiaGl0cyIsImdldExlbmd0aCIsImNvdW50IiwiZm9yRWFjaCIsImVsZW1lbnQiLCJpc1N1bmsiLCJoaXQiLCJnZXRIaXRzIiwiZ2V0UGF0aCIsInJlc2V0SGl0cyIsInR5cGUiLCJhdHRlbXB0cyIsImJvYXJkIiwiYm9hcmRBcnJheSIsIkFycmF5IiwibWFwIiwiZSIsImZpbGwiLCJtaXNzZXMiLCJzaGlwcyIsInBsYWNlU2hpcCIsInNoaXBPYmplY3QiLCJjb29yZGluYXRlcyIsIngiLCJ5IiwiYWRkU2hpcCIsInNoaXAiLCJwdXNoIiwicmVjZWl2ZUF0dGFjayIsImFscmVhZHlIaXQiLCJhbHJlYWR5TWlzcyIsInNvbWUiLCJpdGVtIiwieEl0ZW0iLCJ5SXRlbSIsInJlc2V0R2FtZWJvYXJkIiwiaW5pdEJvYXJkIiwiaXNTaGlwIiwiZ2V0U2hpcCIsImF0dGVtcHQiLCJnZW5lcmF0ZU1vdmUiLCJnZXRSYW5kb21JbnQiLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjaGVja0F0dGVtcHRlZCIsImNvb3JkaW5hdGUiLCJtb3ZlIiwiZ2FtZWJvYXJkIiwidGFyZ2V0Q2VsbCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJyZW5kZXJCb2FyZCIsInBsYXllckJvYXJkIiwicGxheWVyVGl0bGUiLCJjcmVhdGVFbGVtZW50IiwiY29uc29sZSIsImxvZyIsImFwcGVuZENoaWxkIiwicm93Iiwicm93SW5kZXgiLCJyb3dEaXYiLCJjbGFzc0xpc3QiLCJhZGQiLCJjZWxsSW5kZXgiLCJjZWxsIiwiaWQiLCJkYXRhc2V0IiwiYWRkRXZlbnRMaXN0ZW5lciIsInN0b3BQcm9wYWdhdGlvbiIsInRleHRDb250ZW50IiwibW92ZUV2ZW50Iiwic3RvcENsaWNrcyIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInN0YXJ0Q2xpY2tzIiwiZ2FtZSIsImNvbXB1dGVyUGxheWVyIiwidXNlclBsYXllciIsImN1cnJlbnRQbGF5ZXIiLCJjaGVja0xvc3MiLCJwbGF5ZXIiLCJldmVyeSIsImFsZXJ0IiwiaW5pdEdhbWUiLCJ1c2VyQm9hcmQiLCJzd2l0Y2hUdXJuIiwiY2VsbEJvYXJkIiwic3dpdGNoVHVybkJ0biIsIm9uY2xpY2siXSwic291cmNlUm9vdCI6IiJ9